<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,IE=9,chrome=1"><meta name="generator" content="MATLAB R2019b"><title>3D, 4D, ND Arrays Reshape and Rearrange Dimensions</title><style type="text/css">.rtcContent { padding: 30px; } .S0 { margin: 3px 10px 5px 4px; padding: 0px; line-height: 28.8px; min-height: 0px; white-space: pre-wrap; color: rgb(213, 80, 0); font-family: Helvetica, Arial, sans-serif; font-style: normal; font-size: 24px; font-weight: 400; text-align: left;  }
.S1 { margin: 2px 10px 9px 4px; padding: 0px; line-height: 21px; min-height: 0px; white-space: pre-wrap; color: rgb(0, 0, 0); font-family: Helvetica, Arial, sans-serif; font-style: normal; font-size: 14px; font-weight: 400; text-align: left;  }
.S2 { margin: 3px 10px 5px 4px; padding: 0px; line-height: 20px; min-height: 0px; white-space: pre-wrap; color: rgb(60, 60, 60); font-family: Helvetica, Arial, sans-serif; font-style: normal; font-size: 20px; font-weight: 700; text-align: left;  }
.CodeBlock { background-color: #F7F7F7; margin: 10px 0 10px 0;}
.S3 { border-left: 1px solid rgb(233, 233, 233); border-right: 1px solid rgb(233, 233, 233); border-top: 1px solid rgb(233, 233, 233); border-bottom: 0px none rgb(0, 0, 0); border-radius: 4px 4px 0px 0px; padding: 6px 45px 0px 13px; line-height: 16.996px; min-height: 18px; white-space: nowrap; color: rgb(0, 0, 0); font-family: Menlo, Monaco, Consolas, "Courier New", monospace; font-size: 14px;  }
.S4 { border-left: 1px solid rgb(233, 233, 233); border-right: 1px solid rgb(233, 233, 233); border-top: 0px none rgb(0, 0, 0); border-bottom: 0px none rgb(0, 0, 0); border-radius: 0px; padding: 0px 45px 0px 13px; line-height: 16.996px; min-height: 18px; white-space: nowrap; color: rgb(0, 0, 0); font-family: Menlo, Monaco, Consolas, "Courier New", monospace; font-size: 14px;  }
.S5 { border-left: 1px solid rgb(233, 233, 233); border-right: 1px solid rgb(233, 233, 233); border-top: 0px none rgb(0, 0, 0); border-bottom: 1px solid rgb(233, 233, 233); border-radius: 0px; padding: 0px 45px 4px 13px; line-height: 16.996px; min-height: 18px; white-space: nowrap; color: rgb(0, 0, 0); font-family: Menlo, Monaco, Consolas, "Courier New", monospace; font-size: 14px;  }
.S6 { color: rgb(64, 64, 64); padding: 10px 0px 6px 17px; background: rgb(255, 255, 255) none repeat scroll 0% 0% / auto padding-box border-box; font-family: Menlo, Monaco, Consolas, "Courier New", monospace; font-size: 14px; overflow-x: hidden; line-height: 16.996px;  }
.embeddedOutputsErrorElement {min-height: 18px; max-height: 250px; overflow: auto;}
.embeddedOutputsErrorElement.inlineElement {}
.embeddedOutputsErrorElement.rightPaneElement {}
.embeddedOutputsWarningElement{min-height: 18px; max-height: 250px; overflow: auto;}
.embeddedOutputsWarningElement.inlineElement {}
.embeddedOutputsWarningElement.rightPaneElement {}
.diagnosticMessage-wrapper {font-family: Menlo, Monaco, Consolas, "Courier New", monospace; font-size: 12px;}
.diagnosticMessage-wrapper.diagnosticMessage-warningType {color: rgb(255,100,0);}
.diagnosticMessage-wrapper.diagnosticMessage-warningType a {color: rgb(255,100,0); text-decoration: underline;}
.diagnosticMessage-wrapper.diagnosticMessage-errorType {color: rgb(230,0,0);}
.diagnosticMessage-wrapper.diagnosticMessage-errorType a {color: rgb(230,0,0); text-decoration: underline;}
.diagnosticMessage-wrapper .diagnosticMessage-messagePart,.diagnosticMessage-wrapper .diagnosticMessage-causePart {white-space: pre-wrap;}
.diagnosticMessage-wrapper .diagnosticMessage-stackPart {white-space: pre;}
.embeddedOutputsTextElement,.embeddedOutputsVariableStringElement {white-space: pre; word-wrap: initial; min-height: 18px; max-height: 250px; overflow: auto;}
.textElement,.rtcDataTipElement .textElement {padding-top: 3px;}
.embeddedOutputsTextElement.inlineElement,.embeddedOutputsVariableStringElement.inlineElement {}
.inlineElement .textElement {}
.embeddedOutputsTextElement.rightPaneElement,.embeddedOutputsVariableStringElement.rightPaneElement {min-height: 16px;}
.rightPaneElement .textElement {padding-top: 2px; padding-left: 9px;}
.S7 { margin: 10px 10px 9px 4px; padding: 0px; line-height: 21px; min-height: 0px; white-space: pre-wrap; color: rgb(0, 0, 0); font-family: Helvetica, Arial, sans-serif; font-style: normal; font-size: 14px; font-weight: 400; text-align: left;  }
.S8 { border-left: 1px solid rgb(233, 233, 233); border-right: 1px solid rgb(233, 233, 233); border-top: 0px none rgb(0, 0, 0); border-bottom: 1px solid rgb(233, 233, 233); border-radius: 0px 0px 4px 4px; padding: 0px 45px 4px 13px; line-height: 16.996px; min-height: 18px; white-space: nowrap; color: rgb(0, 0, 0); font-family: Menlo, Monaco, Consolas, "Courier New", monospace; font-size: 14px;  }</style></head><body><div class = rtcContent><h1  class = 'S0'><span>3D, 4D, ND Arrays Reshape and Rearrange Dimensions</span></h1><div  class = 'S1'><span style=' font-weight: bold;'>back to </span><a href = "https://fanwangecon.github.io"><span style=' font-weight: bold;'>Fan</span></a><span style=' font-weight: bold;'>'s </span><a href = "https://fanwangecon.github.io/Math4Econ/"><span style=' font-weight: bold;'>Intro Math for Econ</span></a><span style=' font-weight: bold;'>,  </span><a href = "https://fanwangecon.github.io/M4Econ/"><span style=' font-weight: bold;'>Matlab Examples</span></a><span style=' font-weight: bold;'>, or </span><a href = "https://fanwangecon.github.io/CodeDynaAsset/"><span style=' font-weight: bold;'>Dynamic Asset</span></a><span style=' font-weight: bold;'> Repositories</span></div><h2  class = 'S2'><span>3D Array to Cell Array of Matrix Split by Last Dimension</span></h2><div  class = 'S1'><span>Convert Multi-dimensional arrays to a cell array consistent of two dimensional arrays. In this example, we split by the 3rd dimension, so the number of output matrixes is equal to the length of the 3rd dimension. </span></div><div  class = 'S1'><span>First create a three dimensional array, two matrixes that are 4 by 3 each:</span></div><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre;"><span style="color: rgb(60, 118, 61);">% Create a 3D Array</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>rng(123);</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>mn_rand = rand(4,3,2);</span></span></div></div><div class="inlineWrapper outputs"><div  class = 'S5'><span style="white-space: pre;"><span>disp(mn_rand);</span></span></div><div  class = 'S6'><div class="inlineElement eoOutputWrapper embeddedOutputsTextElement" uid="3085C57D" data-testid="output_0" data-width="428" data-height="199" data-hashorizontaloverflow="false" style="width: 458px; max-height: 261px;"><div class="textElement">(:,:,1) =

    0.6965    0.7195    0.4809
    0.2861    0.4231    0.3921
    0.2269    0.9808    0.3432
    0.5513    0.6848    0.7290


(:,:,2) =

    0.4386    0.1825    0.6344
    0.0597    0.1755    0.8494
    0.3980    0.5316    0.7245
    0.7380    0.5318    0.6110</div></div></div></div></div><div  class = 'S7'><span>Now convert the 3 dimensional array to a 2 by 1 cell array that contains matrixes in each cell:</span></div><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre;"><span style="color: rgb(60, 118, 61);">% Squeece 3D array to a Cell array of matrixes</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>cl_mn_rand = squeeze(num2cell(mn_rand, [1,2]));</span></span></div></div><div class="inlineWrapper outputs"><div  class = 'S5'><span style="white-space: pre;"><span>celldisp(cl_mn_rand);</span></span></div><div  class = 'S6'><div class="inlineElement eoOutputWrapper embeddedOutputsTextElement" uid="4A0B87CB" data-testid="output_1" data-width="428" data-height="255" data-hashorizontaloverflow="false" style="width: 458px; max-height: 266px;"><div class="textElement"> 
cl_mn_rand{1} =
 
    0.6965    0.7195    0.4809
    0.2861    0.4231    0.3921
    0.2269    0.9808    0.3432
    0.5513    0.6848    0.7290

 
 
cl_mn_rand{2} =
 
    0.4386    0.1825    0.6344
    0.0597    0.1755    0.8494
    0.3980    0.5316    0.7245
    0.7380    0.5318    0.6110

 </div></div></div></div></div><h2  class = 'S2'><span>4D Array to Cell Array of Matrix Split by Last Two Dimensions</span></h2><div  class = 'S1'><span>Convert 4D Multi-dimensional arrays to a cell array consistent of two dimensional arrays. In this example, the first two dimensions determine the resulting matrix size, the the 3rd and the 4th dimensions are categorical. </span></div><div  class = 'S1'><span>First create a four dimensional array, four matrixes stored each matrix is 2 by 2:</span></div><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre;"><span style="color: rgb(60, 118, 61);">% Create a 3D Array</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>rng(123);</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>mn_rand = rand(2,2,2,2);</span></span></div></div><div class="inlineWrapper outputs"><div  class = 'S5'><span style="white-space: pre;"><span>disp(mn_rand);</span></span></div><div  class = 'S6'><div class="inlineElement eoOutputWrapper embeddedOutputsTextElement" uid="8CAAB655" data-testid="output_2" data-width="428" data-height="311" data-hashorizontaloverflow="false" style="width: 458px; max-height: 322px;"><div class="textElement">(:,:,1,1) =

    0.6965    0.2269
    0.2861    0.5513


(:,:,2,1) =

    0.7195    0.9808
    0.4231    0.6848


(:,:,1,2) =

    0.4809    0.3432
    0.3921    0.7290


(:,:,2,2) =

    0.4386    0.3980
    0.0597    0.7380</div></div></div></div></div><div  class = 'S7'><span>Now convert the 4 dimensional array to a 2 by 2 cell array that contains matrixes in each cell:</span></div><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre;"><span style="color: rgb(60, 118, 61);">% Squeece 3D array to a Cell array of matrixes</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>cl_mn_rand = squeeze(num2cell(mn_rand, [1,2]));</span></span></div></div><div class="inlineWrapper outputs"><div  class = 'S5'><span style="white-space: pre;"><span>celldisp(cl_mn_rand);</span></span></div><div  class = 'S6'><div class="inlineElement eoOutputWrapper embeddedOutputsTextElement" uid="CC298AFC" data-testid="output_3" data-width="428" data-height="395" data-hashorizontaloverflow="false" style="width: 458px; max-height: 406px;"><div class="textElement"> 
cl_mn_rand{1,1} =
 
    0.6965    0.2269
    0.2861    0.5513

 
 
cl_mn_rand{2,1} =
 
    0.7195    0.9808
    0.4231    0.6848

 
 
cl_mn_rand{1,2} =
 
    0.4809    0.3432
    0.3921    0.7290

 
 
cl_mn_rand{2,2} =
 
    0.4386    0.3980
    0.0597    0.7380

 </div></div></div></div></div><h2  class = 'S2'><span>4D Array to Cell Array of Matrix Split by First and Fourth Dimensions Rearrange Dimensions</span></h2><div  class = 'S1'><span>Suppose we store policy and value function given four state variables. The first one is age, the second one is asset, the third one is shock, and the fourth one is the number of kids. We start out with a four dimensional matrix. The objective is to create a two dimensional cell array as output where indexed by the 1st and 4th dimension of the underlying numeric array, and the elements of the 2D cell array are matrixes.</span></div><div  class = 'S1'><span>This is achieved by the </span><a href = "https://www.mathworks.com/help/matlab/ref/permute.html"><span>permute</span></a><span> function. We first rearrange the matrix, so that the 2nd and 3rd dimensions become the 1st and 2nd, then we use the technique used above to squeeze out the first two dimensions as matrixes with the last two as categories.</span></div><div  class = 'S1'><span>First, generate the 2 by 2 by 2 by 2, (Age, A, Z, Kids Count), matrix:</span></div><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre;"><span style="color: rgb(60, 118, 61);">% Create a 3D Array</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>rng(123);</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span style="color: rgb(60, 118, 61);">% (Age, A, Z, Kids Count)</span></span></div></div><div class="inlineWrapper"><div  class = 'S8'><span style="white-space: pre;"><span>mn_rand = rand(2,2,2,2);</span></span></div></div></div><div  class = 'S7'><span>Second, loop out the (A,Z) matrix by Age and Kids Count, this shows us what we want to achieve. Note that each row is Age, each column is A, each submatrix is z, and each super-matrix is kid-count. So from slicing, each column printed out are different value of A, the two submatrixes printed out are for each z. For the output structure where we want a (A,Z) matrix, the columns need to become rows, and the submatrix need to become columns.</span></div><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre;"><span style="color: rgb(60, 118, 61);">% Show Matrix by Age and Kids</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span style="color: rgb(0, 0, 255);">for </span><span>it_age = 1:size(mn_rand,1)</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>    </span><span style="color: rgb(0, 0, 255);">for </span><span>it_kids = 1:size(mn_rand,4)</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>        disp(strcat([</span><span style="color: rgb(160, 32, 240);">'it_age:' </span><span>num2str(it_age) </span><span style="color: rgb(160, 32, 240);">', it_kids:' </span><span>num2str(it_kids)]))</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>        disp(mn_rand(it_age,:,:,it_kids));</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>    </span><span style="color: rgb(0, 0, 255);">end</span></span></div></div><div class="inlineWrapper outputs"><div  class = 'S5'><span style="white-space: pre;"><span style="color: rgb(0, 0, 255);">end</span></span></div><div  class = 'S6'><div class="inlineElement eoOutputWrapper embeddedOutputsTextElement" uid="8CBA29C5" data-testid="output_4" data-width="428" data-height="18" data-hashorizontaloverflow="false" style="width: 458px; max-height: 261px;"><div class="textElement">it_age:1, it_kids:1</div></div><div class="inlineElement eoOutputWrapper embeddedOutputsTextElement" uid="7BA069E5" data-testid="output_5" data-width="428" data-height="115" data-hashorizontaloverflow="false" style="width: 458px; max-height: 261px;"><div class="textElement">(:,:,1) =

    0.6965    0.2269


(:,:,2) =

    0.7195    0.9808</div></div><div class="inlineElement eoOutputWrapper embeddedOutputsTextElement" uid="DD09BE6A" data-testid="output_6" data-width="428" data-height="18" data-hashorizontaloverflow="false" style="width: 458px; max-height: 261px;"><div class="textElement">it_age:1, it_kids:2</div></div><div class="inlineElement eoOutputWrapper embeddedOutputsTextElement" uid="67132E7A" data-testid="output_7" data-width="428" data-height="115" data-hashorizontaloverflow="false" style="width: 458px; max-height: 261px;"><div class="textElement">(:,:,1) =

    0.4809    0.3432


(:,:,2) =

    0.4386    0.3980</div></div><div class="inlineElement eoOutputWrapper embeddedOutputsTextElement" uid="99C8F41D" data-testid="output_8" data-width="428" data-height="18" data-hashorizontaloverflow="false" style="width: 458px; max-height: 261px;"><div class="textElement">it_age:2, it_kids:1</div></div><div class="inlineElement eoOutputWrapper embeddedOutputsTextElement" uid="757114AA" data-testid="output_9" data-width="428" data-height="115" data-hashorizontaloverflow="false" style="width: 458px; max-height: 261px;"><div class="textElement">(:,:,1) =

    0.2861    0.5513


(:,:,2) =

    0.4231    0.6848</div></div><div class="inlineElement eoOutputWrapper embeddedOutputsTextElement" uid="90EA8FD9" data-testid="output_10" data-width="428" data-height="18" data-hashorizontaloverflow="false" style="width: 458px; max-height: 261px;"><div class="textElement">it_age:2, it_kids:2</div></div><div class="inlineElement eoOutputWrapper embeddedOutputsTextElement" uid="C48F3849" data-testid="output_11" data-width="428" data-height="115" data-hashorizontaloverflow="false" style="width: 458px; max-height: 261px;"><div class="textElement">(:,:,1) =

    0.3921    0.7290


(:,:,2) =

    0.0597    0.7380</div></div></div></div></div><div  class = 'S7'><span>Third, we permutate the matrix and squeeze to arrive at the 2 by 2 cell, note that step two is just to show via loop what we should get:</span></div><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre;"><span style="color: rgb(60, 118, 61);">% Rearrange dimensions</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>mn_rand_2314 = permute(mn_rand, [2,3,1,4]);</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span style="color: rgb(60, 118, 61);">% Squeeze the first two dimensiosn as before</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>cl_mn_rand = squeeze(num2cell(mn_rand_2314, [1,2]));</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span style="color: rgb(60, 118, 61);">% show</span></span></div></div><div class="inlineWrapper outputs"><div  class = 'S5'><span style="white-space: pre;"><span>celldisp(cl_mn_rand);</span></span></div><div  class = 'S6'><div class="inlineElement eoOutputWrapper embeddedOutputsTextElement" uid="1D932DCF" data-testid="output_12" data-width="428" data-height="395" data-hashorizontaloverflow="false" style="width: 458px; max-height: 406px;"><div class="textElement"> 
cl_mn_rand{1,1} =
 
    0.6965    0.7195
    0.2269    0.9808

 
 
cl_mn_rand{2,1} =
 
    0.2861    0.4231
    0.5513    0.6848

 
 
cl_mn_rand{1,2} =
 
    0.4809    0.4386
    0.3432    0.3980

 
 
cl_mn_rand{2,2} =
 
    0.3921    0.0597
    0.7290    0.7380

 </div></div></div></div></div><h2  class = 'S2'><span>ND Array Summarize in Table</span></h2><div  class = 'S1'><span>Given an ND dataframe, summarize the first two dimensions. For each possible combination of the 3rd and 4th dimension, generate mean, sd, min and max over the matrix of the first two dimensions. This is similar to a tabulation function.</span></div><div  class = 'S1'><span>First, we generate several array of information:</span></div><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre;"><span style="color: rgb(60, 118, 61);">% Initialize and Squeeze</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>rng(123);</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>mn_rand = rand(2,2,2,2);</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>cln_mt_rand = squeeze(num2cell(mn_rand, [1,2]));</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>cl_mt_rand = cln_mt_rand(:);</span></span></div></div><div class="inlineWrapper outputs"><div  class = 'S5'><span style="white-space: pre;"><span>celldisp(cl_mt_rand);</span></span></div><div  class = 'S6'><div class="inlineElement eoOutputWrapper embeddedOutputsTextElement" uid="61739CC6" data-testid="output_13" data-width="428" data-height="395" data-hashorizontaloverflow="false" style="width: 458px; max-height: 406px;"><div class="textElement"> 
cl_mt_rand{1} =
 
    0.6965    0.2269
    0.2861    0.5513

 
 
cl_mt_rand{2} =
 
    0.7195    0.9808
    0.4231    0.6848

 
 
cl_mt_rand{3} =
 
    0.4809    0.3432
    0.3921    0.7290

 
 
cl_mt_rand{4} =
 
    0.4386    0.3980
    0.0597    0.7380

 </div></div></div></div></div><div  class = 'S7'><span>Second, create two arrays that tracks for each element of cl_mt_rand, which one of the 3rd and 4th dimensions they correspond to:</span></div><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre;"><span>ar_dim_3 = [31,32]';</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>ar_dim_4 = [41,42]';</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>[mt_dim_3, mt_dim_4] = ndgrid(ar_dim_3, ar_dim_4);</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>ar_dim_3 = mt_dim_3(:);</span></span></div></div><div class="inlineWrapper"><div  class = 'S8'><span style="white-space: pre;"><span>ar_dim_4 = mt_dim_4(:);</span></span></div></div></div><div  class = 'S7'><span>Third, summarize each matrix:</span></div><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre;"><span style="color: rgb(60, 118, 61);">% Over of matrix and summarize</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>ar_mean = zeros(size(cl_mt_rand));</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>ar_std = zeros(size(cl_mt_rand));</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span style="color: rgb(0, 0, 255);">for </span><span>it_mt=1:length(cl_mt_rand)</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>    mt_cur = cl_mt_rand{it_mt};</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>    ar_mean(it_mt) = mean(mt_cur, </span><span style="color: rgb(160, 32, 240);">'all'</span><span>);</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>    ar_std(it_mt) = std(mt_cur, [], </span><span style="color: rgb(160, 32, 240);">'all'</span><span>);</span></span></div></div><div class="inlineWrapper"><div  class = 'S8'><span style="white-space: pre;"><span style="color: rgb(0, 0, 255);">end</span></span></div></div></div><div  class = 'S7'><span>Fourth Construct a Table</span></div><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre;"><span style="color: rgb(60, 118, 61);">% Constructe Table</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>tb_rowcols_tab = array2table([(1:length(cl_mt_rand))', </span><span style="color: rgb(0, 0, 255);">...</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>    ar_dim_3, ar_dim_4, ar_mean, ar_std]);</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>tb_rowcols_tab.Properties.VariableNames = </span><span style="color: rgb(0, 0, 255);">...</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>    matlab.lang.makeValidName([</span><span style="color: rgb(160, 32, 240);">"i"</span><span>, </span><span style="color: rgb(160, 32, 240);">"dim3"</span><span>, </span><span style="color: rgb(160, 32, 240);">"dim4"</span><span>,  </span><span style="color: rgb(160, 32, 240);">"mean"</span><span>, </span><span style="color: rgb(160, 32, 240);">"std"</span><span>]);</span></span></div></div><div class="inlineWrapper outputs"><div  class = 'S5'><span style="white-space: pre;"><span>disp(tb_rowcols_tab);</span></span></div><div  class = 'S6'><div class="inlineElement eoOutputWrapper embeddedOutputsTextElement" uid="460EC9A9" data-testid="output_14" data-width="428" data-height="101" data-hashorizontaloverflow="false" style="width: 458px; max-height: 261px;"><div class="textElement">    <strong>i</strong>    <strong>dim3</strong>    <strong>dim4</strong>     <strong>mean</strong>        <strong>std</strong>  
    <strong>_</strong>    <strong>____</strong>    <strong>____</strong>    <strong>_______</strong>    <strong>_______</strong>

    1     31      41     0.44019    0.22156
    2     32      41     0.70204     0.2281
    3     31      42     0.48632    0.17157
    4     32      42     0.40857    0.27764</div></div></div></div></div><h2  class = 'S2'><span>ND Array Two-Way Summarize in Table</span></h2><div  class = 'S1'><span>Given dataframe as above, but we now want to add to the resulting summary table additional columns, rather than taking the means of the entire matrix in the first two dimensions, we only take average with respect to the rows, the first dimension, the second dimension show up as coumn statistics names, still multiple stats. </span></div><div  class = 'S1'><span>First, we generate several array of information:</span></div><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre;"><span style="color: rgb(60, 118, 61);">% dimension names</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>st_title = </span><span style="color: rgb(160, 32, 240);">'Summarize values over a conditional on z (columns) and kids and marriage (rows)'</span><span>;</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>st_dim_1 = </span><span style="color: rgb(160, 32, 240);">'a'</span><span>;</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>st_dim_2 = </span><span style="color: rgb(160, 32, 240);">'z'</span><span>;</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>st_dim_3 = </span><span style="color: rgb(160, 32, 240);">'kid'</span><span>;</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>st_dim_4 = </span><span style="color: rgb(160, 32, 240);">'marriage'</span><span>;</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span style="color: rgb(60, 118, 61);">% 3rd and fourth dimension values</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>ar_dim_2 = [-3, -1, 1, 3];</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>ar_dim_3 = [1,2,3];</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>ar_dim_4 = [0,1];</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span style="color: rgb(60, 118, 61);">% Initialize and Squeeze</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>rng(123);</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>mn_rand = rand(10,4,3,2);</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>cln_mt_rand = squeeze(num2cell(mn_rand, [1,2]));</span></span></div></div><div class="inlineWrapper"><div  class = 'S8'><span style="white-space: pre;"><span>cl_mt_rand = cln_mt_rand(:);</span></span></div></div></div><div  class = 'S7'><span>Second, create two arrays that tracks for each element of cl_mt_rand, which one of the 3rd and 4th dimensions they correspond to:</span></div><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre;"><span>[mt_dim_3, mt_dim_4] = ndgrid(ar_dim_3', ar_dim_4');</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>ar_dim_3 = mt_dim_3(:);</span></span></div></div><div class="inlineWrapper"><div  class = 'S8'><span style="white-space: pre;"><span>ar_dim_4 = mt_dim_4(:);</span></span></div></div></div><div  class = 'S7'><span>Third, summarize each matrix:</span></div><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre;"><span style="color: rgb(60, 118, 61);">% Over of matrix and summarize</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>mt_mean = zeros(length(cl_mt_rand), size(mn_rand,2));</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>mt_std = zeros(length(cl_mt_rand), size(mn_rand,2));</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span style="color: rgb(0, 0, 255);">for </span><span>it_mt=1:length(cl_mt_rand)</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>    mt_cur = cl_mt_rand{it_mt};</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>    mt_mean(it_mt,:) = mean(mt_cur, 1);</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>    mt_std(it_mt,:) = std(mt_cur, [], 1);</span></span></div></div><div class="inlineWrapper"><div  class = 'S8'><span style="white-space: pre;"><span style="color: rgb(0, 0, 255);">end</span></span></div></div></div><div  class = 'S7'><span>Fourth Construct a Table</span></div><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre;"><span style="color: rgb(60, 118, 61);">% Constructe Table</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>tb_rowcols_tab = array2table([(1:length(cl_mt_rand))', </span><span style="color: rgb(0, 0, 255);">...</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>    ar_dim_3, ar_dim_4, mt_mean, mt_std]);</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span style="color: rgb(60, 118, 61);">% Column Names</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>cl_col_names_cate_dims = [string(st_dim_3), string(st_dim_4)];</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>cl_col_names_mn = strcat(</span><span style="color: rgb(160, 32, 240);">'mean_'</span><span>, st_dim_2, string(ar_dim_2));</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>cl_col_names_sd = strcat(</span><span style="color: rgb(160, 32, 240);">'sd_'</span><span>, st_dim_2, string(ar_dim_2));</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>tb_rowcols_tab.Properties.VariableNames = </span><span style="color: rgb(0, 0, 255);">...</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>    matlab.lang.makeValidName([</span><span style="color: rgb(160, 32, 240);">"group"</span><span>, cl_col_names_cate_dims, cl_col_names_mn, cl_col_names_sd]);</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span style="color: rgb(60, 118, 61);">% disp(['xxx ' st_title ' xxxxxxxxxxxxxxxxxxxxxxxxxxx']);</span></span></div></div><div class="inlineWrapper outputs"><div  class = 'S5'><span style="white-space: pre;"><span>disp(tb_rowcols_tab);</span></span></div><div  class = 'S6'><div class="inlineElement eoOutputWrapper embeddedOutputsTextElement scrollableOutput" uid="045CD696" data-testid="output_15" data-width="428" data-height="129" data-hashorizontaloverflow="true" style="width: 458px; max-height: 261px;"><div class="textElement">    <strong>group</strong>    <strong>kid</strong>    <strong>marriage</strong>    <strong>mean_z_3</strong>    <strong>mean_z_1</strong>    <strong>mean_z1</strong>    <strong>mean_z3</strong>    <strong>sd_z_3</strong>     <strong>sd_z_1</strong>      <strong>sd_z1</strong>      <strong>sd_z3</strong> 
    <strong>_____</strong>    <strong>___</strong>    <strong>________</strong>    <strong>________</strong>    <strong>________</strong>    <strong>_______</strong>    <strong>_______</strong>    <strong>_______</strong>    <strong>_______</strong>    <strong>_______</strong>    <strong>_______</strong>

      1       1        0         0.5442     0.41278     0.53795    0.49542    0.22935    0.22945    0.21653    0.25245
      2       2        0        0.51894     0.52262     0.52544    0.45066    0.26787    0.23615    0.25833    0.31178
      3       3        0        0.48248      0.5238     0.50392    0.46534    0.27009    0.26676    0.26644    0.29449
      4       1        1        0.58343     0.50529     0.54361     0.5006    0.29578    0.30182    0.30952    0.27317
      5       2        1        0.58408     0.45941     0.50466    0.40081    0.25026    0.34704    0.31039    0.28693
      6       3        1        0.51148     0.49531     0.48963    0.47698     0.3271    0.24336    0.34498    0.34004</div></div></div></div></div><div  class = 'S7'></div></div>
<br>
<!-- 
##### SOURCE BEGIN #####
%% 3D, 4D, ND Arrays Reshape and Rearrange Dimensions
% *back to* <https://fanwangecon.github.io *Fan*>*'s* <https://fanwangecon.github.io/Math4Econ/ 
% *Intro Math for Econ*>*,*  <https://fanwangecon.github.io/M4Econ/ *Matlab Examples*>*, 
% or* <https://fanwangecon.github.io/CodeDynaAsset/ *Dynamic Asset*> *Repositories*
%% 3D Array to Cell Array of Matrix Split by Last Dimension
% Convert Multi-dimensional arrays to a cell array consistent of two dimensional 
% arrays. In this example, we split by the 3rd dimension, so the number of output 
% matrixes is equal to the length of the 3rd dimension. 
% 
% First create a three dimensional array, two matrixes that are 4 by 3 each:

% Create a 3D Array
rng(123);
mn_rand = rand(4,3,2);
disp(mn_rand);
%% 
% Now convert the 3 dimensional array to a 2 by 1 cell array that contains matrixes 
% in each cell:

% Squeece 3D array to a Cell array of matrixes
cl_mn_rand = squeeze(num2cell(mn_rand, [1,2]));
celldisp(cl_mn_rand);
%% 4D Array to Cell Array of Matrix Split by Last Two Dimensions
% Convert 4D Multi-dimensional arrays to a cell array consistent of two dimensional 
% arrays. In this example, the first two dimensions determine the resulting matrix 
% size, the the 3rd and the 4th dimensions are categorical. 
% 
% First create a four dimensional array, four matrixes stored each matrix is 
% 2 by 2:

% Create a 3D Array
rng(123);
mn_rand = rand(2,2,2,2);
disp(mn_rand);
%% 
% Now convert the 4 dimensional array to a 2 by 2 cell array that contains matrixes 
% in each cell:

% Squeece 3D array to a Cell array of matrixes
cl_mn_rand = squeeze(num2cell(mn_rand, [1,2]));
celldisp(cl_mn_rand);
%% 4D Array to Cell Array of Matrix Split by First and Fourth Dimensions Rearrange Dimensions
% Suppose we store policy and value function given four state variables. The 
% first one is age, the second one is asset, the third one is shock, and the fourth 
% one is the number of kids. We start out with a four dimensional matrix. The 
% objective is to create a two dimensional cell array as output where indexed 
% by the 1st and 4th dimension of the underlying numeric array, and the elements 
% of the 2D cell array are matrixes.
% 
% This is achieved by the <https://www.mathworks.com/help/matlab/ref/permute.html 
% permute> function. We first rearrange the matrix, so that the 2nd and 3rd dimensions 
% become the 1st and 2nd, then we use the technique used above to squeeze out 
% the first two dimensions as matrixes with the last two as categories.
% 
% First, generate the 2 by 2 by 2 by 2, (Age, A, Z, Kids Count), matrix:

% Create a 3D Array
rng(123);
% (Age, A, Z, Kids Count)
mn_rand = rand(2,2,2,2);
%% 
% Second, loop out the (A,Z) matrix by Age and Kids Count, this shows us what 
% we want to achieve. Note that each row is Age, each column is A, each submatrix 
% is z, and each super-matrix is kid-count. So from slicing, each column printed 
% out are different value of A, the two submatrixes printed out are for each z. 
% For the output structure where we want a (A,Z) matrix, the columns need to become 
% rows, and the submatrix need to become columns.

% Show Matrix by Age and Kids
for it_age = 1:size(mn_rand,1)
    for it_kids = 1:size(mn_rand,4)
        disp(strcat(['it_age:' num2str(it_age) ', it_kids:' num2str(it_kids)]))
        disp(mn_rand(it_age,:,:,it_kids));
    end
end
%% 
% Third, we permutate the matrix and squeeze to arrive at the 2 by 2 cell, note 
% that step two is just to show via loop what we should get:

% Rearrange dimensions
mn_rand_2314 = permute(mn_rand, [2,3,1,4]);
% Squeeze the first two dimensiosn as before
cl_mn_rand = squeeze(num2cell(mn_rand_2314, [1,2]));
% show
celldisp(cl_mn_rand);
%% ND Array Summarize in Table
% Given an ND dataframe, summarize the first two dimensions. For each possible 
% combination of the 3rd and 4th dimension, generate mean, sd, min and max over 
% the matrix of the first two dimensions. This is similar to a tabulation function.
% 
% First, we generate several array of information:

% Initialize and Squeeze
rng(123);
mn_rand = rand(2,2,2,2);
cln_mt_rand = squeeze(num2cell(mn_rand, [1,2]));
cl_mt_rand = cln_mt_rand(:);
celldisp(cl_mt_rand);
%% 
% Second, create two arrays that tracks for each element of cl_mt_rand, which 
% one of the 3rd and 4th dimensions they correspond to:

ar_dim_3 = [31,32]';
ar_dim_4 = [41,42]';
[mt_dim_3, mt_dim_4] = ndgrid(ar_dim_3, ar_dim_4);
ar_dim_3 = mt_dim_3(:);
ar_dim_4 = mt_dim_4(:);
%% 
% Third, summarize each matrix:

% Over of matrix and summarize
ar_mean = zeros(size(cl_mt_rand));
ar_std = zeros(size(cl_mt_rand));
for it_mt=1:length(cl_mt_rand)
    mt_cur = cl_mt_rand{it_mt};
    ar_mean(it_mt) = mean(mt_cur, 'all');
    ar_std(it_mt) = std(mt_cur, [], 'all');
end
%% 
% Fourth Construct a Table

% Constructe Table
tb_rowcols_tab = array2table([(1:length(cl_mt_rand))', ...
    ar_dim_3, ar_dim_4, ar_mean, ar_std]);
tb_rowcols_tab.Properties.VariableNames = ...
    matlab.lang.makeValidName(["i", "dim3", "dim4",  "mean", "std"]);
disp(tb_rowcols_tab);
%% ND Array Two-Way Summarize in Table
% Given dataframe as above, but we now want to add to the resulting summary 
% table additional columns, rather than taking the means of the entire matrix 
% in the first two dimensions, we only take average with respect to the rows, 
% the first dimension, the second dimension show up as coumn statistics names, 
% still multiple stats. 
% 
% First, we generate several array of information:

% dimension names
st_title = 'Summarize values over a conditional on z (columns) and kids and marriage (rows)';
st_dim_1 = 'a';
st_dim_2 = 'z';
st_dim_3 = 'kid';
st_dim_4 = 'marriage';
% 3rd and fourth dimension values
ar_dim_2 = [-3, -1, 1, 3];
ar_dim_3 = [1,2,3];
ar_dim_4 = [0,1];
% Initialize and Squeeze
rng(123);
mn_rand = rand(10,4,3,2);
cln_mt_rand = squeeze(num2cell(mn_rand, [1,2]));
cl_mt_rand = cln_mt_rand(:);
%% 
% Second, create two arrays that tracks for each element of cl_mt_rand, which 
% one of the 3rd and 4th dimensions they correspond to:

[mt_dim_3, mt_dim_4] = ndgrid(ar_dim_3', ar_dim_4');
ar_dim_3 = mt_dim_3(:);
ar_dim_4 = mt_dim_4(:);
%% 
% Third, summarize each matrix:

% Over of matrix and summarize
mt_mean = zeros(length(cl_mt_rand), size(mn_rand,2));
mt_std = zeros(length(cl_mt_rand), size(mn_rand,2));
for it_mt=1:length(cl_mt_rand)
    mt_cur = cl_mt_rand{it_mt};
    mt_mean(it_mt,:) = mean(mt_cur, 1);
    mt_std(it_mt,:) = std(mt_cur, [], 1);
end
%% 
% Fourth Construct a Table

% Constructe Table
tb_rowcols_tab = array2table([(1:length(cl_mt_rand))', ...
    ar_dim_3, ar_dim_4, mt_mean, mt_std]);
% Column Names
cl_col_names_cate_dims = [string(st_dim_3), string(st_dim_4)];
cl_col_names_mn = strcat('mean_', st_dim_2, string(ar_dim_2));
cl_col_names_sd = strcat('sd_', st_dim_2, string(ar_dim_2));
tb_rowcols_tab.Properties.VariableNames = ...
    matlab.lang.makeValidName(["group", cl_col_names_cate_dims, cl_col_names_mn, cl_col_names_sd]);
% disp(['xxx ' st_title ' xxxxxxxxxxxxxxxxxxxxxxxxxxx']);
disp(tb_rowcols_tab);
%% 
%
##### SOURCE END #####
--></body></html>