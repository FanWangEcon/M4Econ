<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 3 Distributional Processes | Data Structures and Dynamic Optimization with Matlab</title>
  <meta name="description" content="<p>Stack different tables together with varying columns via outerjoin, store with parallel parfor.
Stack different estiamtion results together into a common table where columns show parameter names and other strings.
Simulate a model, column combine simulation parameters with multi-row simulation results. Then row stack results from multiple simulations together.</p>" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 3 Distributional Processes | Data Structures and Dynamic Optimization with Matlab" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="<p>Stack different tables together with varying columns via outerjoin, store with parallel parfor.
Stack different estiamtion results together into a common table where columns show parameter names and other strings.
Simulate a model, column combine simulation parameters with multi-row simulation results. Then row stack results from multiple simulations together.</p>" />
  <meta name="github-repo" content="fanwangecon/M4Econ" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 3 Distributional Processes | Data Structures and Dynamic Optimization with Matlab" />
  
  <meta name="twitter:description" content="<p>Stack different tables together with varying columns via outerjoin, store with parallel parfor.
Stack different estiamtion results together into a common table where columns show parameter names and other strings.
Simulate a model, column combine simulation parameters with multi-row simulation results. Then row stack results from multiple simulations together.</p>" />
  

<meta name="author" content="Fan Wang" />


<meta name="date" content="2021-05-11" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="functions.html"/>
<link rel="next" href="simulation.html"/>
<script src="libs/header-attrs-2.5/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.0/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0/anchor-sections.js"></script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-92953468-6"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-92953468-6');
</script>



<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Data Structures and Dynamic Optimization with Matlab</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="data-structures.html"><a href="data-structures.html"><i class="fa fa-check"></i><b>1</b> Data Structures</a>
<ul>
<li class="chapter" data-level="1.1" data-path="data-structures.html"><a href="data-structures.html#matrices-and-arrays"><i class="fa fa-check"></i><b>1.1</b> Matrices and Arrays</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="data-structures.html"><a href="data-structures.html#array-reshape-repeat-and-expand-examples"><i class="fa fa-check"></i><b>1.1.1</b> Array Reshape, Repeat and Expand Examples</a></li>
<li class="chapter" data-level="1.1.2" data-path="data-structures.html"><a href="data-structures.html#array-index-slicing-and-subsetting-to-replace-and-expand"><i class="fa fa-check"></i><b>1.1.2</b> Array Index Slicing and Subsetting to Replace and Expand</a></li>
<li class="chapter" data-level="1.1.3" data-path="data-structures.html"><a href="data-structures.html#maximum-of-matrix-columns-sort-matrix-columns"><i class="fa fa-check"></i><b>1.1.3</b> Maximum of Matrix Columns, Sort Matrix Columns</a></li>
<li class="chapter" data-level="1.1.4" data-path="data-structures.html"><a href="data-structures.html#array-broadcast-and-expansion-examples"><i class="fa fa-check"></i><b>1.1.4</b> Array Broadcast and Expansion Examples</a></li>
<li class="chapter" data-level="1.1.5" data-path="data-structures.html"><a href="data-structures.html#grid-states-choices-and-optimal-choices-example"><i class="fa fa-check"></i><b>1.1.5</b> Grid States, Choices and Optimal Choices Example</a></li>
<li class="chapter" data-level="1.1.6" data-path="data-structures.html"><a href="data-structures.html#accumarray-examples"><i class="fa fa-check"></i><b>1.1.6</b> Accumarray Examples</a></li>
<li class="chapter" data-level="1.1.7" data-path="data-structures.html"><a href="data-structures.html#matlab-array-basics-and-miscellaneous"><i class="fa fa-check"></i><b>1.1.7</b> Matlab Array Basics and Miscellaneous</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="data-structures.html"><a href="data-structures.html#nd-dimensional-arrays"><i class="fa fa-check"></i><b>1.2</b> ND Dimensional Arrays</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="data-structures.html"><a href="data-structures.html#joint-arrays-all-combinations-and-by-random-subset"><i class="fa fa-check"></i><b>1.2.1</b> Joint Arrays All Combinations and by Random Subset</a></li>
<li class="chapter" data-level="1.2.2" data-path="data-structures.html"><a href="data-structures.html#d-4d-nd-arrays-reshape-and-rearrange-dimensions"><i class="fa fa-check"></i><b>1.2.2</b> 3D, 4D, ND Arrays Reshape and Rearrange Dimensions</a></li>
<li class="chapter" data-level="1.2.3" data-path="data-structures.html"><a href="data-structures.html#multidimensional-nd-array-to-2d-matrix-with-wide-to-long"><i class="fa fa-check"></i><b>1.2.3</b> Multidimensional ND Array to 2D Matrix with Wide to Long</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="data-structures.html"><a href="data-structures.html#cells"><i class="fa fa-check"></i><b>1.3</b> Cells</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="data-structures.html"><a href="data-structures.html#matlab-cell-array-basic-operations"><i class="fa fa-check"></i><b>1.3.1</b> Matlab Cell Array Basic Operations</a></li>
<li class="chapter" data-level="1.3.2" data-path="data-structures.html"><a href="data-structures.html#matlab-list-comprehension-with-cells"><i class="fa fa-check"></i><b>1.3.2</b> Matlab List Comprehension with Cells</a></li>
<li class="chapter" data-level="1.3.3" data-path="data-structures.html"><a href="data-structures.html#all-possible-combinations-of-multiple-arrays"><i class="fa fa-check"></i><b>1.3.3</b> All Possible Combinations of Multiple Arrays</a></li>
<li class="chapter" data-level="1.3.4" data-path="data-structures.html"><a href="data-structures.html#nested-cells"><i class="fa fa-check"></i><b>1.3.4</b> Nested Cells</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="data-structures.html"><a href="data-structures.html#characters-and-strings"><i class="fa fa-check"></i><b>1.4</b> Characters and Strings</a>
<ul>
<li class="chapter" data-level="1.4.1" data-path="data-structures.html"><a href="data-structures.html#basic-string-operations"><i class="fa fa-check"></i><b>1.4.1</b> Basic String Operations</a></li>
<li class="chapter" data-level="1.4.2" data-path="data-structures.html"><a href="data-structures.html#string-manipulations-with-arrays"><i class="fa fa-check"></i><b>1.4.2</b> String Manipulations with Arrays</a></li>
<li class="chapter" data-level="1.4.3" data-path="data-structures.html"><a href="data-structures.html#convert-and-concatenate-strings-arrays-with-numbers-and-number-arrays-with-strings"><i class="fa fa-check"></i><b>1.4.3</b> Convert and Concatenate Strings Arrays with Numbers and Number Arrays with Strings</a></li>
</ul></li>
<li class="chapter" data-level="1.5" data-path="data-structures.html"><a href="data-structures.html#map-containers"><i class="fa fa-check"></i><b>1.5</b> Map Containers</a>
<ul>
<li class="chapter" data-level="1.5.1" data-path="data-structures.html"><a href="data-structures.html#container-map-basics"><i class="fa fa-check"></i><b>1.5.1</b> Container Map Basics</a></li>
<li class="chapter" data-level="1.5.2" data-path="data-structures.html"><a href="data-structures.html#container-map-display-swtich-key-and-values-and-subseting"><i class="fa fa-check"></i><b>1.5.2</b> Container Map Display Swtich Key and Values and Subseting</a></li>
<li class="chapter" data-level="1.5.3" data-path="data-structures.html"><a href="data-structures.html#container-map-example-overriding"><i class="fa fa-check"></i><b>1.5.3</b> Container Map Example Overriding</a></li>
</ul></li>
<li class="chapter" data-level="1.6" data-path="data-structures.html"><a href="data-structures.html#map-structure-array"><i class="fa fa-check"></i><b>1.6</b> Map Structure Array</a>
<ul>
<li class="chapter" data-level="1.6.1" data-path="data-structures.html"><a href="data-structures.html#maplab-nested-container-map-with-struct"><i class="fa fa-check"></i><b>1.6.1</b> Maplab Nested Container Map with Struct</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="functions.html"><a href="functions.html"><i class="fa fa-check"></i><b>2</b> Functions</a>
<ul>
<li class="chapter" data-level="2.1" data-path="functions.html"><a href="functions.html#varargin-default-parameters"><i class="fa fa-check"></i><b>2.1</b> varargin Default Parameters</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="functions.html"><a href="functions.html#varargin-as-a-function-parameter"><i class="fa fa-check"></i><b>2.1.1</b> varargin as a Function Parameter</a></li>
<li class="chapter" data-level="2.1.2" data-path="functions.html"><a href="functions.html#map-based-default-parameter-structure-with-varargin"><i class="fa fa-check"></i><b>2.1.2</b> Map Based Default Parameter Structure with varargin</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="functions.html"><a href="functions.html#dynamic-functions"><i class="fa fa-check"></i><b>2.2</b> Dynamic Functions</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="functions.html"><a href="functions.html#anonymous-function-in-matlab"><i class="fa fa-check"></i><b>2.2.1</b> Anonymous Function in Matlab</a></li>
<li class="chapter" data-level="2.2.2" data-path="functions.html"><a href="functions.html#dynamically-generate-m-files"><i class="fa fa-check"></i><b>2.2.2</b> Dynamically Generate M Files</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="distributional-processes.html"><a href="distributional-processes.html"><i class="fa fa-check"></i><b>3</b> Distributional Processes</a>
<ul>
<li class="chapter" data-level="3.1" data-path="distributional-processes.html"><a href="distributional-processes.html#time-series"><i class="fa fa-check"></i><b>3.1</b> Time Series</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="distributional-processes.html"><a href="distributional-processes.html#simulate-ar1-autoregressive-processes"><i class="fa fa-check"></i><b>3.1.1</b> Simulate AR(1) Autoregressive Processes</a></li>
<li class="chapter" data-level="3.1.2" data-path="distributional-processes.html"><a href="distributional-processes.html#matlab-moving-average-of-time-series"><i class="fa fa-check"></i><b>3.1.2</b> Matlab Moving Average of Time-series</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="distributional-processes.html"><a href="distributional-processes.html#cross-sectional-data"><i class="fa fa-check"></i><b>3.2</b> Cross-sectional Data</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="distributional-processes.html"><a href="distributional-processes.html#matlab-mincer-wage-earnings-equation-with-experience-education-and-gamma-shocks"><i class="fa fa-check"></i><b>3.2.1</b> Matlab Mincer Wage Earnings Equation with Experience, Education and Gamma Shocks</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="simulation.html"><a href="simulation.html"><i class="fa fa-check"></i><b>4</b> Simulation</a>
<ul>
<li class="chapter" data-level="4.1" data-path="simulation.html"><a href="simulation.html#normal-distribution"><i class="fa fa-check"></i><b>4.1</b> Normal Distribution</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="simulation.html"><a href="simulation.html#compute-cdf-for-normal-and-bivariate-normal-distributions"><i class="fa fa-check"></i><b>4.1.1</b> Compute CDF for Normal and Bivariate Normal Distributions</a></li>
<li class="chapter" data-level="4.1.2" data-path="simulation.html"><a href="simulation.html#cholesky-decomposition-correlated-bivariate-normal-from-iid-random-draws"><i class="fa fa-check"></i><b>4.1.2</b> Cholesky Decomposition Correlated Bivariate Normal from IID Random Draws</a></li>
<li class="chapter" data-level="4.1.3" data-path="simulation.html"><a href="simulation.html#cholesky-decomposition-correlated-five-dimensional-multivariate-normal-shock"><i class="fa fa-check"></i><b>4.1.3</b> Cholesky Decomposition Correlated Five Dimensional Multivariate Normal Shock</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="estimation.html"><a href="estimation.html"><i class="fa fa-check"></i><b>5</b> Estimation</a>
<ul>
<li class="chapter" data-level="5.1" data-path="estimation.html"><a href="estimation.html#linear-estimation"><i class="fa fa-check"></i><b>5.1</b> Linear Estimation</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="estimation.html"><a href="estimation.html#linear-ols-estimation"><i class="fa fa-check"></i><b>5.1.1</b> Linear OLS Estimation</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="estimation.html"><a href="estimation.html#nonlinear-estimation"><i class="fa fa-check"></i><b>5.2</b> Nonlinear Estimation</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="estimation.html"><a href="estimation.html#nonlinear-estimation-with-fminunc"><i class="fa fa-check"></i><b>5.2.1</b> Nonlinear Estimation with Fminunc</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="graphs.html"><a href="graphs.html"><i class="fa fa-check"></i><b>6</b> Graphs</a>
<ul>
<li class="chapter" data-level="6.1" data-path="graphs.html"><a href="graphs.html#figure-components"><i class="fa fa-check"></i><b>6.1</b> Figure Components</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="graphs.html"><a href="graphs.html#matlab-graph-safe-colors-for-web-presentation-and-publications-examples"><i class="fa fa-check"></i><b>6.1.1</b> Matlab Graph Safe Colors for Web, Presentation and Publications Examples</a></li>
<li class="chapter" data-level="6.1.2" data-path="graphs.html"><a href="graphs.html#matlab-graph-titling-labels-and-legends-examples"><i class="fa fa-check"></i><b>6.1.2</b> Matlab Graph Titling, Labels and Legends Examples</a></li>
<li class="chapter" data-level="6.1.3" data-path="graphs.html"><a href="graphs.html#matlab-graph-matrix-with-jet-spectrum-color-label-a-subset-examples"><i class="fa fa-check"></i><b>6.1.3</b> Matlab Graph Matrix with Jet Spectrum Color, Label a Subset Examples</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="graphs.html"><a href="graphs.html#basic-figure-types"><i class="fa fa-check"></i><b>6.2</b> Basic Figure Types</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="graphs.html"><a href="graphs.html#matlab-graph-scatter-plot-examples"><i class="fa fa-check"></i><b>6.2.1</b> Matlab Graph Scatter Plot Examples</a></li>
<li class="chapter" data-level="6.2.2" data-path="graphs.html"><a href="graphs.html#matlab-line-and-scatter-plot-with-multiple-lines-and-axis-lines"><i class="fa fa-check"></i><b>6.2.2</b> Matlab Line and Scatter Plot with Multiple Lines and Axis Lines</a></li>
<li class="chapter" data-level="6.2.3" data-path="graphs.html"><a href="graphs.html#matlab-graph-scatter-and-line-spectrum-with-three-variables"><i class="fa fa-check"></i><b>6.2.3</b> Matlab Graph Scatter and Line Spectrum with Three Variables</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="graphs.html"><a href="graphs.html#graph-functions"><i class="fa fa-check"></i><b>6.3</b> Graph Functions</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="graphs.html"><a href="graphs.html#matlab-graph-one-variable-function"><i class="fa fa-check"></i><b>6.3.1</b> Matlab Graph One Variable Function</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="graphs.html"><a href="graphs.html#write-and-read-plots"><i class="fa fa-check"></i><b>6.4</b> Write and Read Plots</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="graphs.html"><a href="graphs.html#matlab-graph-generate-eps-postscript-figures-in-matlab"><i class="fa fa-check"></i><b>6.4.1</b> Matlab Graph Generate EPS postscript figures in matlab</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="tables.html"><a href="tables.html"><i class="fa fa-check"></i><b>7</b> Tables</a>
<ul>
<li class="chapter" data-level="7.1" data-path="tables.html"><a href="tables.html#basic-table-generation"><i class="fa fa-check"></i><b>7.1</b> Basic Table Generation</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="tables.html"><a href="tables.html#named-tables-with-random-data"><i class="fa fa-check"></i><b>7.1.1</b> Named Tables with Random Data</a></li>
<li class="chapter" data-level="7.1.2" data-path="tables.html"><a href="tables.html#tables-order-sort-add-rename-and-drop-columns"><i class="fa fa-check"></i><b>7.1.2</b> Tables Order, Sort, Add, Rename and Drop Columns</a></li>
<li class="chapter" data-level="7.1.3" data-path="tables.html"><a href="tables.html#row-and-column-names-for-table-based-on-arrays"><i class="fa fa-check"></i><b>7.1.3</b> Row and Column Names for Table based on Arrays</a></li>
<li class="chapter" data-level="7.1.4" data-path="tables.html"><a href="tables.html#select-subset-of-rows-and-columns"><i class="fa fa-check"></i><b>7.1.4</b> Select Subset of Rows and Columns</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="tables.html"><a href="tables.html#table-joining"><i class="fa fa-check"></i><b>7.2</b> Table Joining</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="tables.html"><a href="tables.html#row-and-column-combine-stack-tables-and-matrices"><i class="fa fa-check"></i><b>7.2.1</b> Row and Column Combine Stack Tables and Matrices</a></li>
<li class="chapter" data-level="7.2.2" data-path="tables.html"><a href="tables.html#matlab-table-stack-and-join-estimation-and-simulation-results"><i class="fa fa-check"></i><b>7.2.2</b> Matlab Table Stack and Join Estimation and Simulation Results</a></li>
</ul></li>
</ul></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="index-and-code-links.html"><a href="index-and-code-links.html"><i class="fa fa-check"></i><b>A</b> Index and Code Links</a>
<ul>
<li class="chapter" data-level="A.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#data-structures-links"><i class="fa fa-check"></i><b>A.1</b> Data Structures links</a>
<ul>
<li class="chapter" data-level="A.1.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-1.1-matrices-and-arraysmatrices-and-arrays-links"><i class="fa fa-check"></i><b>A.1.1</b> <span>Section 1.1 Matrices and Arrays</span> links</a></li>
<li class="chapter" data-level="A.1.2" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-1.2-nd-dimensional-arraysnd-dimensional-arrays-links"><i class="fa fa-check"></i><b>A.1.2</b> <span>Section 1.2 ND Dimensional Arrays</span> links</a></li>
<li class="chapter" data-level="A.1.3" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-1.3-cellscells-links"><i class="fa fa-check"></i><b>A.1.3</b> <span>Section 1.3 Cells</span> links</a></li>
<li class="chapter" data-level="A.1.4" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-1.4-characters-and-stringscharacters-and-strings-links"><i class="fa fa-check"></i><b>A.1.4</b> <span>Section 1.4 Characters and Strings</span> links</a></li>
<li class="chapter" data-level="A.1.5" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-1.5-map-containersmap-containers-links"><i class="fa fa-check"></i><b>A.1.5</b> <span>Section 1.5 Map Containers</span> links</a></li>
<li class="chapter" data-level="A.1.6" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-1.6-map-structure-arraymap-structure-array-links"><i class="fa fa-check"></i><b>A.1.6</b> <span>Section 1.6 Map Structure Array</span> links</a></li>
</ul></li>
<li class="chapter" data-level="A.2" data-path="index-and-code-links.html"><a href="index-and-code-links.html#functions-links"><i class="fa fa-check"></i><b>A.2</b> Functions links</a>
<ul>
<li class="chapter" data-level="A.2.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-2.1-varargin-default-parametersvarargin-default-parameters-links"><i class="fa fa-check"></i><b>A.2.1</b> <span>Section 2.1 varargin Default Parameters</span> links</a></li>
<li class="chapter" data-level="A.2.2" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-2.2-dynamic-functionsdynamic-functions-links"><i class="fa fa-check"></i><b>A.2.2</b> <span>Section 2.2 Dynamic Functions</span> links</a></li>
</ul></li>
<li class="chapter" data-level="A.3" data-path="index-and-code-links.html"><a href="index-and-code-links.html#distributional-processes-links"><i class="fa fa-check"></i><b>A.3</b> Distributional Processes links</a>
<ul>
<li class="chapter" data-level="A.3.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-3.1-time-seriestime-series-links"><i class="fa fa-check"></i><b>A.3.1</b> <span>Section 3.1 Time Series</span> links</a></li>
<li class="chapter" data-level="A.3.2" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-3.2-cross-sectional-datacross-sectional-data-links"><i class="fa fa-check"></i><b>A.3.2</b> <span>Section 3.2 Cross-sectional Data</span> links</a></li>
</ul></li>
<li class="chapter" data-level="A.4" data-path="index-and-code-links.html"><a href="index-and-code-links.html#simulation-links"><i class="fa fa-check"></i><b>A.4</b> Simulation links</a>
<ul>
<li class="chapter" data-level="A.4.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-4.1-normal-distributionnormal-distribution-links"><i class="fa fa-check"></i><b>A.4.1</b> <span>Section 4.1 Normal Distribution</span> links</a></li>
</ul></li>
<li class="chapter" data-level="A.5" data-path="index-and-code-links.html"><a href="index-and-code-links.html#estimation-links"><i class="fa fa-check"></i><b>A.5</b> Estimation links</a>
<ul>
<li class="chapter" data-level="A.5.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-5.1-linear-estimationlinear-estimation-links"><i class="fa fa-check"></i><b>A.5.1</b> <span>Section 5.1 Linear Estimation</span> links</a></li>
<li class="chapter" data-level="A.5.2" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-5.2-nonlinear-estimationnonlinear-estimation-links"><i class="fa fa-check"></i><b>A.5.2</b> <span>Section 5.2 Nonlinear Estimation</span> links</a></li>
</ul></li>
<li class="chapter" data-level="A.6" data-path="index-and-code-links.html"><a href="index-and-code-links.html#graphs-links"><i class="fa fa-check"></i><b>A.6</b> Graphs links</a>
<ul>
<li class="chapter" data-level="A.6.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-6.1-figure-componentsfigure-components-links"><i class="fa fa-check"></i><b>A.6.1</b> <span>Section 6.1 Figure Components</span> links</a></li>
<li class="chapter" data-level="A.6.2" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-6.2-basic-figure-typesbasic-figure-types-links"><i class="fa fa-check"></i><b>A.6.2</b> <span>Section 6.2 Basic Figure Types</span> links</a></li>
<li class="chapter" data-level="A.6.3" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-6.3-graph-functionsgraph-functions-links"><i class="fa fa-check"></i><b>A.6.3</b> <span>Section 6.3 Graph Functions</span> links</a></li>
<li class="chapter" data-level="A.6.4" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-6.4-write-and-read-plotswrite-and-read-plots-links"><i class="fa fa-check"></i><b>A.6.4</b> <span>Section 6.4 Write and Read Plots</span> links</a></li>
</ul></li>
<li class="chapter" data-level="A.7" data-path="index-and-code-links.html"><a href="index-and-code-links.html#tables-links"><i class="fa fa-check"></i><b>A.7</b> Tables links</a>
<ul>
<li class="chapter" data-level="A.7.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-7.1-basic-table-generationbasic-table-generation-links"><i class="fa fa-check"></i><b>A.7.1</b> <span>Section 7.1 Basic Table Generation</span> links</a></li>
<li class="chapter" data-level="A.7.2" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-7.2-table-joiningtable-joining-links"><i class="fa fa-check"></i><b>A.7.2</b> <span>Section 7.2 Table Joining</span> links</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://fanwangecon.github.io/M4Econ/bookdown/index.html" target="blank">M4Econ Bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Data Structures and Dynamic Optimization with Matlab</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="distributional-processes" class="section level1" number="3">
<h1><span class="header-section-number">Chapter 3</span> Distributional Processes</h1>

<div id="time-series" class="section level2" number="3.1">
<h2><span class="header-section-number">3.1</span> Time Series</h2>

<div id="simulate-ar1-autoregressive-processes" class="section level3" number="3.1.1">
<h3><span class="header-section-number">3.1.1</span> Simulate AR(1) Autoregressive Processes</h3>
<blockquote>
<p>Go back to <a href="http://fanwangecon.github.io/">fan</a>’s <a href="https://fanwangecon.github.io/MEconTools/">MEconTools</a> Package, <a href="https://fanwangecon.github.io/M4Econ/">Matlab Code Examples</a> Repository (<a href="https://fanwangecon.github.io/M4Econ/bookdown">bookdown site</a>), or <a href="https://fanwangecon.github.io/Math4Econ/">Math for Econ with Matlab</a> Repository (<a href="https://fanwangecon.github.io/Math4Econ/bookdown">bookdown site</a>).</p>
</blockquote>
<div id="mean-and-standard-deviation-for-ar1-autoregressive-process" class="section level4" number="3.1.1.1">
<h4><span class="header-section-number">3.1.1.1</span> Mean and Standard Deviation for AR(1) Autoregressive Process</h4>
<p>A first-order autoregressive process can be written as:</p>
<ul>
<li><p>AR1:
<span class="math inline">\(X_t =\textrm{constant}+\textrm{persistence}\cdot x_{t-1} +\epsilon\)</span></p></li>
<li><p>AR1: <span class="math inline">\(X_t =C+\rho \cdot x_{t-1} +\epsilon\)</span></p></li>
</ul>
<p>Assume that <span class="math inline">\(\epsilon\)</span> is mean zero</p>
<p>Note that, we know the mean of <span class="math inline">\(X\)</span>:</p>
<ul>
<li><p><span class="math inline">\(\displaystyle \mu_X =C+\rho \cdot \mu_X +0\)</span></p></li>
<li><p><span class="math inline">\(\displaystyle \mu_x =\frac{C}{1-\rho }\)</span></p></li>
</ul>
<p>Note that, we also know the standard deviation of <span class="math inline">\(X\)</span>:</p>
<ul>
<li><p><span class="math inline">\(\displaystyle \textrm{var}\left(X\right)=\rho^2 \cdot \textrm{var}\left(X\right)+\textrm{var}\left(\epsilon \right)\)</span></p></li>
<li><p><span class="math inline">\(\displaystyle \sigma_x =\sqrt{\frac{\sigma_{\epsilon }^2 }{1-\rho^2 }}\)</span></p></li>
</ul>
<p>We will let the initial point of the time series follow the stationary
distribution of the AR(1) process, then we simulate the time series over
100 periods, in the example below, we use a highly persistent shock
process with <span class="math inline">\(\rho =0.98\)</span>, <span class="math inline">\(\sigma_{\epsilon } =0.02\)</span>, <span class="math inline">\(C=0.02\)</span>. Note
that for this process:</p>
<ul>
<li><p><span class="math inline">\(\displaystyle \mu_x^{\rho =0.98,\sigma_{\epsilon } =0.02,C=0.02} =\frac{0.02}{1-0.98}=1\)</span></p></li>
<li><p><span class="math inline">\(\displaystyle \sigma_x^{\rho =0.98,\sigma_{\epsilon } =0.02,C=0.02} =\sqrt{\frac{0.02^2 }{1-0.98^2 }}\approx 0.10\)</span></p></li>
</ul>
</div>
<div id="simulated-one-first-order-autoregressive-time-series" class="section level4" number="3.1.1.2">
<h4><span class="header-section-number">3.1.1.2</span> Simulated one First-Order Autoregressive Time-Series</h4>
<p>In the Example below, we simulate an individual for 1000 periods, given
<span class="math inline">\(\rho =0.98\)</span>, <span class="math inline">\(\sigma_{\epsilon } =0.02\)</span>, <span class="math inline">\(C=0.02\)</span>. Given that the
process is highly persistent, the individual stays rich or poor for
dozens of periods at a time. If each period is a year, look at the
results below, and suppose the simulated time series is income, what is
the process saying about this person’s income rise and fall. Note that
we have the same person through all 1000 periods, but if you only look
at 50 periods (years), you might this this person during one span is
really successful, anothe segment of 50 years, doing really bad, but
actually there is nothing changing in the person’s type, all that is
changing is the person’s luck.</p>
<p>First Set Parameters:</p>
<pre><code>% Number of Time Periods
it_T = 1000;
% Mean and SD of the Shock Process
fl_constant = 0.02;
fl_normal_sd = 0.02;
% Persistence
fl_persistence = 0.98;
% Bounds on Shocks
fl_shk_bnds = 3;
% Initialize with exo fed point or not, if false initialize at Random Point
% from the stationary distribution
bl_init = true;
fl_init = fl_constant/(1 - fl_persistence);</code></pre>
<p>Second, generate a vector of normal shocks:</p>
<pre><code>% Generate a normal shock vector (the first draw will be ignored)
it_draws = it_T;
rng(789);
ar_fl_shocks = normrnd(0, fl_normal_sd, 1, it_draws);
disp(ar_fl_shocks(1:20));

  Columns 1 through 15

   -0.0060   -0.0047    0.0168    0.0118    0.0380    0.0062   -0.0616   -0.0485   -0.0192    0.0023   -0.0197    0.0040    0.0156   -0.0089    0.0160

  Columns 16 through 20

    0.0099   -0.0200   -0.0206   -0.0090   -0.0069</code></pre>
<p>Third, replace any values exceeding bounds:</p>
<pre><code>% out of bounds indicators
fl_shk_bds_lower = 0 - fl_normal_sd*fl_shk_bnds;
fl_shk_bds_upper = 0 + fl_normal_sd*fl_shk_bnds;
ar_bl_outofbounds = (ar_fl_shocks &lt;= fl_shk_bds_lower | ar_fl_shocks &gt;= fl_shk_bds_upper);
% count out of bounds
disp(strcat(&#39;lower:&#39;, num2str(fl_shk_bds_lower), &#39;, upper:&#39;, num2str(fl_shk_bds_upper)));

lower:-0.06, upper:0.06

disp(sum(ar_bl_outofbounds));

     4

ar_fl_shocks(ar_fl_shocks &lt;= fl_shk_bds_lower) = fl_shk_bds_lower;
ar_fl_shocks(ar_fl_shocks &gt;= fl_shk_bds_upper) = fl_shk_bds_upper;</code></pre>
<p>Fourth, generate the AR(1) time series:</p>
<pre><code>% Initialize Output Array
ar_fl_time_series = zeros(size(ar_fl_shocks));
% Loop over time
for it_t=1:1:length(ar_fl_shocks)
    if (it_t == 1)
        % initialize using the ean of the process
        ar_fl_time_series(1) = fl_constant/(1 - fl_persistence);
        if (bl_init)
            ar_fl_time_series(1) = fl_init;            
        end
    else
        fl_ts_t = fl_constant + ar_fl_time_series(it_t-1)*fl_persistence + ar_fl_shocks(it_t);
        ar_fl_time_series(it_t) = fl_ts_t;
    end
end</code></pre>
<p>Fifth, show the mean and sd of the process (these are very close to the
analytical results):</p>
<pre><code>disp(mean(ar_fl_time_series));

    1.0104

disp(std(ar_fl_time_series));

    0.1000</code></pre>
<p>Sixth, plot the results:</p>
<pre><code>figure();
% x-axis
ar_it_time = 1:1:length(ar_fl_shocks);
% plot
plot(ar_it_time, ar_fl_time_series);
% Generate Title
ar_fl_params_values = [fl_constant, fl_normal_sd, fl_persistence, fl_shk_bnds];
ar_st_parms_names = [&quot;C&quot;, &quot;sd&quot;, &quot;persistence&quot;, &quot;sd-bounds&quot;];
st_rounding = &#39;.2f&#39;;
st_title_main = &quot;AR(1) &quot;;
ar_st_params = strcat(ar_st_parms_names, compose(strcat(&quot;=%&quot;, st_rounding), ar_fl_params_values));
st_param_pasted = strjoin(ar_st_params, &#39;, &#39;);
st_title_wth_params = strcat(st_title_main, &#39; (&#39;, st_param_pasted, &#39;)&#39;);
title({st_title_wth_params, &#39;Simulate One Individual for 1000 Periods&#39;});
% X and Y labels
ylabel({&#39;Time Series Values&#39;});
xlabel(&#39;Time Periods&#39;);
grid on;</code></pre>
<p><img src="img/fs_autoregressive_images/figure_0.png" width="500" /></p>
</div>
<div id="income-process-for-india" class="section level4" number="3.1.1.3">
<h4><span class="header-section-number">3.1.1.3</span> Income Process for India</h4>
<p>In the Example below, we simulate an individual for 1000 periods. In the
example below, the parameters are from estiamting an AR(1) process for
log of income in India, see Udupa and Wang (2020). We can use the
<a href="https://fanwangecon.github.io/MEconTools/MEconTools/doc/stats/htmlpdfm/fx_simu_stats.html">ff_simu_stats</a>
function from <a href="https://fanwangecon.github.io/MEconTools/">MEconTools</a> to
look at the distributional information from this time series, we care
about income, so we will exponentiate the log of income we obtained.</p>
<p>Note that for the distributional results, GINI, share of income held by
different percentiles of households, is invariant to the choice of the
<span class="math inline">\(C\)</span> constant term earlier. Try changing that number, the distributional
statistics that we obtain below will be the same. Also note that the
exponential of the mean of the log of income is not equal to the mean of
income.</p>
<pre><code>% Number of Time Periods
it_T = 1000;
% Mean and SD of the Shock Process
fl_constant = 3.024467;
fl_normal_sd = 0.45;
% Persistence
fl_persistence = 0.7468;
% Bounds on Shocks
fl_shk_bnds = 5;
% Initialize with exo fed point or not, if false initialize at Random Point
% from the stationary distribution
bl_init = true;
fl_init = fl_constant/(1 - fl_persistence);
% Generate a normal shock vector (the first draw will be ignored)
it_draws = it_T;
rng(789);
ar_fl_shocks = normrnd(0, fl_normal_sd, 1, it_draws);
% out of bounds indicators
fl_shk_bds_lower = 0 - fl_normal_sd*fl_shk_bnds;
fl_shk_bds_upper = 0 + fl_normal_sd*fl_shk_bnds;
ar_bl_outofbounds = (ar_fl_shocks &lt;= fl_shk_bds_lower | ar_fl_shocks &gt;= fl_shk_bds_upper);
ar_fl_shocks(ar_fl_shocks &lt;= fl_shk_bds_lower) = fl_shk_bds_lower;
ar_fl_shocks(ar_fl_shocks &gt;= fl_shk_bds_upper) = fl_shk_bds_upper;
% Initialize Output Array
ar_fl_time_series = zeros(size(ar_fl_shocks));
% Loop over time
for it_t=1:1:length(ar_fl_shocks)
    if (it_t == 1)
        % initialize using the ean of the process
        ar_fl_time_series(1) = fl_constant/(1 - fl_persistence);
        if (bl_init)
            ar_fl_time_series(1) = fl_init;            
        end
    else
        fl_ts_t = fl_constant + ar_fl_time_series(it_t-1)*fl_persistence + ar_fl_shocks(it_t);
        ar_fl_time_series(it_t) = fl_ts_t;
    end
end
ar_series = (ar_fl_time_series);
fl_mean = mean(ar_series);
fl_std = std(ar_series);
figure();
% x-axis
ar_it_time = 1:1:length(ar_fl_shocks);
% plot
plot(ar_it_time, (ar_fl_time_series));
% Generate Title
ar_fl_params_values = [fl_constant, fl_normal_sd, fl_persistence, fl_shk_bnds];
ar_st_parms_names = [&quot;C&quot;, &quot;sd&quot;, &quot;persistence&quot;, &quot;sd-bounds&quot;];
st_rounding = &#39;.2f&#39;;
st_title_main = &quot;AR(1) Log of Income in India&quot;;
ar_st_params = strcat(ar_st_parms_names, compose(strcat(&quot;=%&quot;, st_rounding), ar_fl_params_values));
st_param_pasted = strjoin(ar_st_params, &#39;, &#39;);
st_title_wth_params = strcat(st_title_main, &#39; (&#39;, st_param_pasted, &#39;)&#39;);
title({st_title_wth_params, &#39;Simulate One Individual for 1000 Periods&#39;});
% X and Y labels
ylabel({&#39;Log of Income (India)&#39;});
xlabel(&#39;Time Periods&#39;);
grid on;</code></pre>
<p><img src="img/fs_autoregressive_images/figure_1.png" width="500" /></p>
<pre><code>% Set Parameters
mp_cl_mt_xyz_of_s = containers.Map(&#39;KeyType&#39;,&#39;char&#39;, &#39;ValueType&#39;,&#39;any&#39;);
mp_cl_mt_xyz_of_s(&#39;log_income&#39;) = {(ar_series), zeros(1)};
mp_cl_mt_xyz_of_s(&#39;income&#39;) = {exp(ar_series), zeros(1)};
mp_cl_mt_xyz_of_s(&#39;ar_st_y_name&#39;) = [&quot;log_income&quot;, &quot;income&quot;];
% Mass
rng(123);
mt_f_of_s = zeros(size(ar_series)) + 1/numel(ar_series);
mt_f_of_s = mt_f_of_s/sum(mt_f_of_s, &#39;all&#39;);
mp_cl_mt_xyz_of_s_out = ff_simu_stats(mt_f_of_s, mp_cl_mt_xyz_of_s);

xxx tb_outcomes: all stats xxx
    OriginalVariableNames    log_income      income  
    _____________________    __________    __________

    {&#39;mean&#39;             }       11.959      1.946e+05
    {&#39;unweighted_sum&#39;   }        11959      1.946e+08
    {&#39;sd&#39;               }      0.67236     1.4024e+05
    {&#39;coefofvar&#39;        }     0.056222        0.72064
    {&#39;gini&#39;             }     0.031635        0.35645
    {&#39;min&#39;              }       9.8742          19423
    {&#39;max&#39;              }       13.893      1.081e+06
    {&#39;pYis0&#39;            }            0              0
    {&#39;pYls0&#39;            }            0              0
    {&#39;pYgr0&#39;            }            1              1
    {&#39;pYisMINY&#39;         }        0.001          0.001
    {&#39;pYisMAXY&#39;         }        0.001          0.001
    {&#39;p1&#39;               }       10.258          28498
    {&#39;p10&#39;              }       11.087          65316
    {&#39;p25&#39;              }       11.518     1.0049e+05
    {&#39;p50&#39;              }       11.983        1.6e+05
    {&#39;p75&#39;              }        12.42     2.4771e+05
    {&#39;p90&#39;              }       12.761     3.4829e+05
    {&#39;p99&#39;              }       13.479      7.141e+05
    {&#39;fl_cov_log_income&#39;}      0.45207          84333
    {&#39;fl_cor_log_income&#39;}            1        0.89439
    {&#39;fl_cov_income&#39;    }        84333     1.9667e+10
    {&#39;fl_cor_income&#39;    }      0.89439              1
    {&#39;fracByP1&#39;         }    0.0093239      0.0014385
    {&#39;fracByP10&#39;        }     0.089816       0.024687
    {&#39;fracByP25&#39;        }       0.2317       0.088239
    {&#39;fracByP50&#39;        }      0.47761        0.25477
    {&#39;fracByP75&#39;        }      0.73265        0.51224
    {&#39;fracByP90&#39;        }      0.89045        0.73747
    {&#39;fracByP99&#39;        }      0.98852        0.95275</code></pre>

</div>
</div>
<div id="matlab-moving-average-of-time-series" class="section level3" number="3.1.2">
<h3><span class="header-section-number">3.1.2</span> Matlab Moving Average of Time-series</h3>
<blockquote>
<p>Go back to <a href="http://fanwangecon.github.io/">fan</a>’s <a href="https://fanwangecon.github.io/MEconTools/">MEconTools</a> Package, <a href="https://fanwangecon.github.io/M4Econ/">Matlab Code Examples</a> Repository (<a href="https://fanwangecon.github.io/M4Econ/bookdown">bookdown site</a>), or <a href="https://fanwangecon.github.io/Math4Econ/">Math for Econ with Matlab</a> Repository (<a href="https://fanwangecon.github.io/Math4Econ/bookdown">bookdown site</a>).</p>
</blockquote>
<div id="weighted-average-of-neighbors" class="section level4" number="3.1.2.1">
<h4><span class="header-section-number">3.1.2.1</span> Weighted Average of Neighbors</h4>
<p>Not actually a time-series moving average. There is a vector of a
parameter value, this parameter is not been estimated, we estimate all
other parameters while varying this one parameter. At different values
of this parameter, there is a vector of estimates. We have estimated a
model along a equi-distance grid of this exogenous parameter. Now for
each of the estimated parameter, calculate a "moving-average" based on
averaging across estimated neighbor values of this parameter, where
neighbor distance is defined by the fixed exogenous parameter. Why do
this? This can be considered a "smoother" tool, but more importantly,
use the moving averages as new initial parameter guesses for a new round
of estimation at each of the exogenous parameter’s values. For different
starting seeds, use different moving windows.</p>
<p>First, select out all estimates:</p>
<pre><code>% Load in file
srn_excel_exa = &#39;C:\Users\fan\M4Econ\table\_exa\excel_exa.xlsx&#39;;
tb_estimates = readtable(srn_excel_exa);
% columns to select
ar_st_colnames = tb_estimates.Properties.VariableNames;
ar_st_colnames_sel = [&quot;mean_h_sd&quot;, ar_st_colnames(endsWith(ar_st_colnames, &#39;_esti&#39;))];
% Select all estimates columns and the exogenous parameter column
mt_estimates_sel = tb_estimates{:, ar_st_colnames_sel};
% sort by the first column
mt_estimates_sel = sortrows(mt_estimates_sel, 1);
disp(mt_estimates_sel(1:10,:));

    0.0500   -3.4978   -2.6181   -2.7631   -0.9659   -0.4155   -3.1664   -4.4143
    0.1000   -3.5013   -2.6949   -2.8498   -0.9718   -0.4155   -3.1579   -4.4355
    0.1500   -3.4849   -2.8976   -3.0884   -0.9737   -0.4155   -3.1566   -4.4783
    0.2000   -3.4633   -2.7626   -2.9237   -0.9746   -0.4155   -3.1552   -4.5471
    0.2500   -3.3769   -1.4130   -1.4498   -0.9752   -0.4155   -3.1545   -4.7172
    0.3000   -3.3928   -2.7294   -2.8764   -0.9737   -0.4155   -3.1544   -4.7274
    0.3500   -3.3356   -2.5737   -2.6928   -0.9711   -0.4155   -3.1550   -4.8517
    0.4000   -3.1298   -1.7669   -1.8096   -0.9509   -0.4155   -3.1538   -5.8944
    0.4500   -3.1357   -2.2754   -2.3482   -0.9509   -0.4155   -3.1537   -6.0055
    0.5000   -3.1579   -2.6960   -2.8119   -0.9513   -0.4155   -3.1553   -6.0710

% show size
disp(size(mt_estimates_sel));

    82     8</code></pre>
<p>Second, calculate moving aveage with
<a href="https://www.mathworks.com/help/matlab/ref/movmean.html#bu6jxup">movmean</a>,
take the mean of up to 33 surrounding values, 66 and 99. Note that there
is only 82 elements of the array. But the movmean function’s window
parameter will divide the window left and right.</p>
<pre><code>mt_estimates_mov33 = movmean(mt_estimates_sel, 33);
mt_estimates_mov66 = movmean(mt_estimates_sel, 66);
mt_estimates_movflat = movmean(mt_estimates_sel, size(mt_estimates_sel,1)*2);</code></pre>
<p>Visualize using the
<a href="https://fanwangecon.github.io/MEconTools/MEconTools/doc/graph/htmlpdfm/fx_graph_grid.html">ff_graph_grid</a>
function from <a href="https://fanwangecon.github.io/MEconTools/">MEconTools</a>
moving average for one parameter, with different windows. Note that with
a moving window of 82*2, the moving average becomes flat, because there
are 82 elements of the underlying "time-series", so the window needs
to be 82*2 for the moving average to be fully flat.</p>
<pre><code>% Generate some Data
ar_row_grid = [&quot;actual&quot;, &quot;moving avg widow=33&quot;,&quot;mov window=66&quot;,&quot;mov window=82*2&quot;];
ar_exo_param_grid = mt_estimates_sel(:, 1);
it_col = 4;
mt_mov_value = [mt_estimates_sel(:,it_col), ...
    mt_estimates_mov33(:,it_col), ...
    mt_estimates_mov66(:,it_col), ...
    mt_estimates_movflat(:,it_col)]&#39;; 
% container map settings
mp_support_graph = containers.Map(&#39;KeyType&#39;, &#39;char&#39;, &#39;ValueType&#39;, &#39;any&#39;);
mp_support_graph(&#39;cl_st_graph_title&#39;) = {&#39;Moving Average with Widening Sliding Windows&#39;};
mp_support_graph(&#39;cl_st_ytitle&#39;) = {&#39;Parameter Estimates Moving Average&#39;};
mp_support_graph(&#39;cl_st_xtitle&#39;) = {&#39;Exogenous Parameter (not estimated)&#39;};
mp_support_graph(&#39;st_legend_loc&#39;) = &#39;best&#39;;
mp_support_graph(&#39;bl_graph_logy&#39;) = false;
mp_support_graph(&#39;it_legend_select&#39;) = 4; % how many shock legends to show
mp_support_graph(&#39;st_rounding&#39;) = &#39;6.2f&#39;; % format shock legend
mp_support_graph(&#39;cl_scatter_shapes&#39;) = {&#39;s&#39;, &#39;o&#39;, &#39;*&#39;, &#39;x&#39;};
mp_support_graph(&#39;cl_colors&#39;) = &#39;lines&#39;;
% Call function
ff_graph_grid(mt_mov_value, ar_row_grid, ar_exo_param_grid, mp_support_graph);</code></pre>
<p><img src="img/fs_movingaverage_images/figure_0.png" width="500" /></p>

</div>
</div>
</div>
<div id="cross-sectional-data" class="section level2" number="3.2">
<h2><span class="header-section-number">3.2</span> Cross-sectional Data</h2>

<div id="matlab-mincer-wage-earnings-equation-with-experience-education-and-gamma-shocks" class="section level3" number="3.2.1">
<h3><span class="header-section-number">3.2.1</span> Matlab Mincer Wage Earnings Equation with Experience, Education and Gamma Shocks</h3>
<blockquote>
<p>Go back to <a href="http://fanwangecon.github.io/">fan</a>’s <a href="https://fanwangecon.github.io/MEconTools/">MEconTools</a> Package, <a href="https://fanwangecon.github.io/M4Econ/">Matlab Code Examples</a> Repository (<a href="https://fanwangecon.github.io/M4Econ/bookdown">bookdown site</a>), or <a href="https://fanwangecon.github.io/Math4Econ/">Math for Econ with Matlab</a> Repository (<a href="https://fanwangecon.github.io/Math4Econ/bookdown">bookdown site</a>).</p>
</blockquote>
<div id="define-a-wage-equation-with-partial-income-for-part-time-workss-1" class="section level4" number="3.2.1.1">
<h4><span class="header-section-number">3.2.1.1</span> Define a Wage Equation with Partial Income for Part-time Workss</h4>
<p>Individuals might work part or full time. Define a mincer wage equation
that is a function of experienc, education and other individual
characteristics. This is partly based on the wage equation from <a href="https://www.sciencedirect.com/science/article/abs/pii/S1094202517300029">Hai and
Heckman
(2017)</a>. <span class="citation">(<a href="index-and-code-links.html#ref-HaiHeckman2017" role="doc-biblioref">Hai and Heckman 2017</a>)</span></p>
<p>First define parameters.</p>
<pre><code>% cognitive and non-cognitive latent types
theta_cogntv = 0.1;
theta_noncog = 0.1;
% parameters mapping latent types to wage
COEF_alpha_cog_wage_hsh = 0.0529;
COEF_alpha_cog_wage_clg = 0.0529;
COEF_alpha_cog_wage_grd = 0.1433;
COEF_alpha_ncg_wage_hsh = 0.0275;
COEF_alpha_ncg_wage_clg = 0.0512;
COEF_alpha_ncg_wage_grd = 0.0892;
% Experience
COEF_beta_psi_0 = 1.8884;
COEF_beta_psi_k = 0.0767;
COEF_beta_psi_kk = -0.2683;
% Education
COEF_beta_psi_e0 = 0.0465;
COEF_beta_w_e_1 = 0.1432;
COEF_beta_w_e_2 = 0.1435;
COEF_beta_w_e_3 = 0.2806;
% for part time
COEF_beta_w_part_0 = -0.0082;
COEF_beta_w_part_1 = -0.4863;</code></pre>
<p>Second define the log wage equation. This wage equation is a function of
the parameters defined above, and also Education (ED), experience (EX)
and the wage shcok (EPS_w).</p>
<pre><code>% Log of wage
f_log_psi = @(ED, EX, EPS_w) ...
    ((COEF_alpha_cog_wage_hsh.*theta_cogntv + COEF_alpha_ncg_wage_hsh.*theta_noncog).*(ED &lt; 12) ...
    + (COEF_alpha_cog_wage_clg.*theta_cogntv + COEF_alpha_ncg_wage_clg.*theta_noncog).*(ED &gt;= 12).*(ED &lt; 16) ...
    + (COEF_alpha_cog_wage_grd.*theta_cogntv + COEF_alpha_ncg_wage_grd.*theta_noncog).*(ED &gt;= 16) ...
    + COEF_beta_psi_0 ...
    + COEF_beta_psi_k.*EX ...
    + COEF_beta_psi_kk.*(EX.^2/100) ...
    + COEF_beta_psi_e0.*(ED - 12) ...
    + COEF_beta_w_e_1.*(ED == 12) ...
    + COEF_beta_w_e_2.*(ED &gt; 12).*(ED &lt; 16) ...
    + COEF_beta_w_e_3.*(ED &gt;= 16) ...
    + EPS_w);</code></pre>
<p>Third, define wage, which might differ depending on work status as well
as schooling status. D_e is schooling or not, which can take values of 0
or 1. D_k is work status, which can take values or 0, 0.5 (part-time
work) and 1 (full-time work).</p>
<pre><code>% Per hour wage considering part time, part time wage differ if also schooling
f_hr_wage = @(D_e, D_k, ED, EX, EPS_w) ...
    exp(f_log_psi(ED, EX, EPS_w)).*exp((D_k==0.5).*(COEF_beta_w_part_0 + COEF_beta_w_part_1.*D_e));
% Total wage
f_wage = @(D_e, D_k, ED, EX, EPS_w) ...
    f_hr_wage(D_e, D_k, ED, EX, EPS_w).*(2080.*(D_k == 1) + 1040.*(D_k == 0.5) + 0.*(D_k == 0));</code></pre>
<p>Fourth, test the wage equation by calling it with different work and
schooling choices, along with different education, experience, and shock
levels.</p>
<pre><code>% no experience, education, not school, not work
disp([&#39;f_wage(0,0,0,0,0)=&#39; num2str(f_wage(0,0,0,0,0))]);

f_wage(0,0,0,0,0)=0

% no experience, education, part-time
disp([&#39;f_wage(0,0.5,0,0,0)=&#39; num2str(f_wage(0,0.5,0,0,0))]);

f_wage(0,0.5,0,0,0)=3933.229

% no experience, education, full-time
disp([&#39;f_wage(0,1,0,0,0)=&#39; num2str(f_wage(0,1,0,0,0))]);

f_wage(0,1,0,0,0)=7931.2281</code></pre>
<p>With the anonymous function defined, we can supply a vector of education
values (as a column), and a vector of experience levles (as a row), and
generate a matrix of wages for full-time workers, simulated at one
particular shock level. Graph using
<a href="https://fanwangecon.github.io/MEconTools/MEconTools/doc/graph/htmlpdfm/fx_graph_grid.html">FF_GRAPH_GRID</a>
from <a href="https://fanwangecon.github.io/MEconTools/">MEconTools</a>.</p>
<p>The graph shows that higher education corresponds to higher wages, there
are different levels by education tiers, and there is a quadratic
structure to experience</p>
<pre><code>% 1 to 16 years of educations
ar_edu = 1:1:20;
% 1 to 20 years of experiences
ar_exp = 1:1:20;
% broadcast evaluate
mt_wages = f_wage(0,1,ar_edu&#39;,ar_exp,0);
% graph using MEconTools
mp_support_graph = containers.Map(&#39;KeyType&#39;, &#39;char&#39;, &#39;ValueType&#39;, &#39;any&#39;);
mp_support_graph(&#39;cl_st_graph_title&#39;) = {&#39;wages(edu, exp, shk=0), exp=x, education=color&#39;};
mp_support_graph(&#39;cl_st_ytitle&#39;) = {&#39;wages(edu,exp)&#39;};
mp_support_graph(&#39;cl_st_xtitle&#39;) = {&#39;experience levels&#39;};
mp_support_graph(&#39;bl_graph_logy&#39;) = false; % do not log
mp_support_graph(&#39;st_rowvar_name&#39;) = &#39;edu=&#39;;
mp_support_graph(&#39;it_legend_select&#39;) = 10; % how many shock legends to show
mp_support_graph(&#39;st_rounding&#39;) = &#39;3.0f&#39;; % format shock legend
mp_support_graph(&#39;cl_colors&#39;) = &#39;copper&#39;; % any predefined matlab colormap
% Call function
ff_graph_grid(mt_wages, ar_edu, ar_exp, mp_support_graph);</code></pre>
<p><img src="img/fs_wage_equation_images/figure_0.png" width="500" /></p>
<p>Draw the shock term from gamma distribution, distribution of wages at a
particular experience and education combination with many shocks.</p>
<pre><code>% Gamma distribution parameters from Hai and Heckman
% E(epsilon) = a*b, var(epsion) = a*b^2.
a0 = 15.3558; % shape
b0 = 0.1388; % scale
% use gamrnd
it_draws = 10000;
ar_gamma_draws = gamrnd(a0, b0, [it_draws, 1]);
% Evaluate with 12 years of education and 10 years of experience with
% different shocks
ar_wages_e16_x10 = f_wage(0,1,16,10,ar_gamma_draws);
ar_wages_e12_x5 = f_wage(0,1,12,5,ar_gamma_draws);</code></pre>
<p>Draw a histogram of the wage distribution. <a href="https://www.mathworks.com/help/matlab/ref/matlab.graphics.chart.primitive.histogram.html">Multiple histograms in
matlab</a>.</p>
<pre><code>figure();
h1 = histogram(log(ar_wages_e16_x10), 20);
hold on;
h2 = histogram(log(ar_wages_e12_x5), 20);
grid on;
h1.Normalization = &#39;probability&#39;;
h2.Normalization = &#39;probability&#39;;
% Put up legend.
legend1 = sprintf(&#39;Log wage dist edu=16 and exp=10&#39;);
legend2 = sprintf(&#39;Log wage dist edu=12 and exp=5&#39;);
legend({legend1, legend2});</code></pre>
<p><img src="img/fs_wage_equation_images/figure_1.png" width="500" /></p>
<p>Generate distributional statistics using
<a href="https://fanwangecon.github.io/MEconTools/MEconTools/doc/stats/htmlpdfm/fx_simu_stats.html">FF_SIMU_STATS</a>
from <a href="https://fanwangecon.github.io/MEconTools/">MEconTools</a>. Given that
the shocks are the same, the distributional statistics in terms of gini,
and shares of wages held by different percentiles are the same. However,</p>
<pre><code>% Set Parameters
mp_cl_mt_xyz_of_s = containers.Map(&#39;KeyType&#39;,&#39;char&#39;, &#39;ValueType&#39;,&#39;any&#39;);
mp_cl_mt_xyz_of_s(&#39;cl_wages_e16_x10&#39;) = {ar_wages_e16_x10, zeros(1)};
mp_cl_mt_xyz_of_s(&#39;cl_ar_wages_e12_x5&#39;) = {ar_wages_e12_x5, zeros(1)};
mp_cl_mt_xyz_of_s(&#39;ar_st_y_name&#39;) = [&quot;cl_wages_e16_x10&quot;, &quot;cl_ar_wages_e12_x5&quot;];
% Mass
rng(123);
mt_f_of_s = 1/it_draws + zeros(size(ar_wages_e16_x10));
% Call Function
mp_cl_mt_xyz_of_s_out = ff_simu_stats(mt_f_of_s, mp_cl_mt_xyz_of_s);

xxx tb_outcomes: all stats xxx
        OriginalVariableNames        cl_wages_e16_x10    cl_ar_wages_e12_x5
    _____________________________    ________________    __________________

    {&#39;mean&#39;                     }       3.7009e+05           2.2035e+05
    {&#39;unweighted_sum&#39;           }       3.7009e+09           2.2035e+09
    {&#39;sd&#39;                       }       2.5548e+05           1.5212e+05
    {&#39;coefofvar&#39;                }          0.69034              0.69034
    {&#39;gini&#39;                     }          0.31929              0.31929
    {&#39;min&#39;                      }            72823                43359
    {&#39;max&#39;                      }       4.1108e+06           2.4476e+06
    {&#39;pYis0&#39;                    }                0                    0
    {&#39;pYls0&#39;                    }                0                    0
    {&#39;pYgr0&#39;                    }                1                    1
    {&#39;pYisMINY&#39;                 }           0.0001               0.0001
    {&#39;pYisMAXY&#39;                 }           0.0001               0.0001
    {&#39;p1&#39;                       }       1.0651e+05                63414
    {&#39;p10&#39;                      }       1.6176e+05                96313
    {&#39;p25&#39;                      }       2.1211e+05           1.2629e+05
    {&#39;p50&#39;                      }       3.0077e+05           1.7908e+05
    {&#39;p75&#39;                      }       4.4013e+05           2.6205e+05
    {&#39;p90&#39;                      }       6.5011e+05           3.8708e+05
    {&#39;p99&#39;                      }       1.3542e+06           8.0632e+05
    {&#39;fl_cov_cl_wages_e16_x10&#39;  }       6.5273e+10           3.8864e+10
    {&#39;fl_cor_cl_wages_e16_x10&#39;  }                1                    1
    {&#39;fl_cov_cl_ar_wages_e12_x5&#39;}       3.8864e+10            2.314e+10
    {&#39;fl_cor_cl_ar_wages_e12_x5&#39;}                1                    1
    {&#39;fracByP1&#39;                 }         0.002641             0.002641
    {&#39;fracByP10&#39;                }         0.036428             0.036428
    {&#39;fracByP25&#39;                }          0.11277              0.11277
    {&#39;fracByP50&#39;                }          0.28486              0.28486
    {&#39;fracByP75&#39;                }           0.5298               0.5298
    {&#39;fracByP90&#39;                }          0.74277              0.74277
    {&#39;fracByP99&#39;                }          0.95264              0.95264</code></pre>

</div>
</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="functions.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="simulation.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": [["Data-Structures-and-Dynamic-Optimization-with-Matlab.pdf", "PDF"]],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
