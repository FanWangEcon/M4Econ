<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 4 Simulation | Data Structures and Dynamic Optimization with Matlab</title>
  <meta name="description" content="<p>Append columns to existing table. Stack tables vertically and horizontally.
Simulate a model, column combine simulation parameters with multi-row simulation results. Then row stack results from multiple simulations together.</p>" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 4 Simulation | Data Structures and Dynamic Optimization with Matlab" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="<p>Append columns to existing table. Stack tables vertically and horizontally.
Simulate a model, column combine simulation parameters with multi-row simulation results. Then row stack results from multiple simulations together.</p>" />
  <meta name="github-repo" content="fanwangecon/M4Econ" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 4 Simulation | Data Structures and Dynamic Optimization with Matlab" />
  
  <meta name="twitter:description" content="<p>Append columns to existing table. Stack tables vertically and horizontally.
Simulate a model, column combine simulation parameters with multi-row simulation results. Then row stack results from multiple simulations together.</p>" />
  

<meta name="author" content="Fan Wang" />


<meta name="date" content="2020-12-26" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="distributional-processes.html"/>
<link rel="next" href="graphs.html"/>
<script src="libs/header-attrs-2.5/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.0/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0/anchor-sections.js"></script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-92953468-6"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-92953468-6');
</script>



<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Data Structures and Dynamic Optimization with Matlab</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="data-structures.html"><a href="data-structures.html"><i class="fa fa-check"></i><b>1</b> Data Structures</a>
<ul>
<li class="chapter" data-level="1.1" data-path="data-structures.html"><a href="data-structures.html#matrices-and-arrays"><i class="fa fa-check"></i><b>1.1</b> Matrices and Arrays</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="data-structures.html"><a href="data-structures.html#array-reshape-repeat-and-expand-examples"><i class="fa fa-check"></i><b>1.1.1</b> Array Reshape, Repeat and Expand Examples</a></li>
<li class="chapter" data-level="1.1.2" data-path="data-structures.html"><a href="data-structures.html#array-index-slicing-and-subsetting-to-replace-and-expand"><i class="fa fa-check"></i><b>1.1.2</b> Array Index Slicing and Subsetting to Replace and Expand</a></li>
<li class="chapter" data-level="1.1.3" data-path="data-structures.html"><a href="data-structures.html#maximum-of-matrix-columns-sort-matrix-columns"><i class="fa fa-check"></i><b>1.1.3</b> Maximum of Matrix Columns, Sort Matrix Columns</a></li>
<li class="chapter" data-level="1.1.4" data-path="data-structures.html"><a href="data-structures.html#array-broadcast-and-expansion-examples"><i class="fa fa-check"></i><b>1.1.4</b> Array Broadcast and Expansion Examples</a></li>
<li class="chapter" data-level="1.1.5" data-path="data-structures.html"><a href="data-structures.html#grid-states-choices-and-optimal-choices-example"><i class="fa fa-check"></i><b>1.1.5</b> Grid States, Choices and Optimal Choices Example</a></li>
<li class="chapter" data-level="1.1.6" data-path="data-structures.html"><a href="data-structures.html#accumarray-examples"><i class="fa fa-check"></i><b>1.1.6</b> Accumarray Examples</a></li>
<li class="chapter" data-level="1.1.7" data-path="data-structures.html"><a href="data-structures.html#array-draw-random-index-and-find-combinations-or-permuations"><i class="fa fa-check"></i><b>1.1.7</b> Array Draw Random Index and Find Combinations or Permuations</a></li>
<li class="chapter" data-level="1.1.8" data-path="data-structures.html"><a href="data-structures.html#matlab-array-basics-and-miscellaneous"><i class="fa fa-check"></i><b>1.1.8</b> Matlab Array Basics and Miscellaneous</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="data-structures.html"><a href="data-structures.html#nd-dimensional-arrays"><i class="fa fa-check"></i><b>1.2</b> ND Dimensional Arrays</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="data-structures.html"><a href="data-structures.html#d-4d-nd-arrays-reshape-and-rearrange-dimensions"><i class="fa fa-check"></i><b>1.2.1</b> 3D, 4D, ND Arrays Reshape and Rearrange Dimensions</a></li>
<li class="chapter" data-level="1.2.2" data-path="data-structures.html"><a href="data-structures.html#multidimensional-nd-array-to-2d-matrix-with-wide-to-long"><i class="fa fa-check"></i><b>1.2.2</b> Multidimensional ND Array to 2D Matrix with Wide to Long</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="data-structures.html"><a href="data-structures.html#cells"><i class="fa fa-check"></i><b>1.3</b> Cells</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="data-structures.html"><a href="data-structures.html#list-comprehension-with-cells"><i class="fa fa-check"></i><b>1.3.1</b> List Comprehension with Cells</a></li>
<li class="chapter" data-level="1.3.2" data-path="data-structures.html"><a href="data-structures.html#all-possible-combinations-of-multiple-arrays"><i class="fa fa-check"></i><b>1.3.2</b> All Possible Combinations of Multiple Arrays</a></li>
<li class="chapter" data-level="1.3.3" data-path="data-structures.html"><a href="data-structures.html#combine-cells-together"><i class="fa fa-check"></i><b>1.3.3</b> Combine Cells Together</a></li>
<li class="chapter" data-level="1.3.4" data-path="data-structures.html"><a href="data-structures.html#nested-cells"><i class="fa fa-check"></i><b>1.3.4</b> Nested Cells</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="data-structures.html"><a href="data-structures.html#characters-and-strings"><i class="fa fa-check"></i><b>1.4</b> Characters and Strings</a>
<ul>
<li class="chapter" data-level="1.4.1" data-path="data-structures.html"><a href="data-structures.html#basic-string-operations"><i class="fa fa-check"></i><b>1.4.1</b> Basic String Operations</a></li>
<li class="chapter" data-level="1.4.2" data-path="data-structures.html"><a href="data-structures.html#string-manipulations-with-arrays"><i class="fa fa-check"></i><b>1.4.2</b> String Manipulations with Arrays</a></li>
<li class="chapter" data-level="1.4.3" data-path="data-structures.html"><a href="data-structures.html#convert-and-concatenate-strings-arrays-with-numbers-and-number-arrays-with-strings"><i class="fa fa-check"></i><b>1.4.3</b> Convert and Concatenate Strings Arrays with Numbers and Number Arrays with Strings</a></li>
</ul></li>
<li class="chapter" data-level="1.5" data-path="data-structures.html"><a href="data-structures.html#map-containers"><i class="fa fa-check"></i><b>1.5</b> Map Containers</a>
<ul>
<li class="chapter" data-level="1.5.1" data-path="data-structures.html"><a href="data-structures.html#container-map-basics"><i class="fa fa-check"></i><b>1.5.1</b> Container Map Basics</a></li>
<li class="chapter" data-level="1.5.2" data-path="data-structures.html"><a href="data-structures.html#container-map-display-swtich-key-and-values-and-subseting"><i class="fa fa-check"></i><b>1.5.2</b> Container Map Display Swtich Key and Values and Subseting</a></li>
<li class="chapter" data-level="1.5.3" data-path="data-structures.html"><a href="data-structures.html#container-map-example-overriding"><i class="fa fa-check"></i><b>1.5.3</b> Container Map Example Overriding</a></li>
</ul></li>
<li class="chapter" data-level="1.6" data-path="data-structures.html"><a href="data-structures.html#map-structure-array"><i class="fa fa-check"></i><b>1.6</b> Map Structure Array</a>
<ul>
<li class="chapter" data-level="1.6.1" data-path="data-structures.html"><a href="data-structures.html#maplab-nested-container-map-with-struct"><i class="fa fa-check"></i><b>1.6.1</b> Maplab Nested Container Map with Struct</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="functions.html"><a href="functions.html"><i class="fa fa-check"></i><b>2</b> Functions</a>
<ul>
<li class="chapter" data-level="2.1" data-path="functions.html"><a href="functions.html#varargin-default-parameters"><i class="fa fa-check"></i><b>2.1</b> varargin Default Parameters</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="functions.html"><a href="functions.html#varargin-as-a-function-parameter"><i class="fa fa-check"></i><b>2.1.1</b> varargin as a Function Parameter</a></li>
<li class="chapter" data-level="2.1.2" data-path="functions.html"><a href="functions.html#map-based-default-parameter-structure-with-varargin"><i class="fa fa-check"></i><b>2.1.2</b> Map Based Default Parameter Structure with varargin</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="functions.html"><a href="functions.html#anonymous-functions"><i class="fa fa-check"></i><b>2.2</b> Anonymous Functions</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="functions.html"><a href="functions.html#anonymous-function-in-matlab"><i class="fa fa-check"></i><b>2.2.1</b> Anonymous Function in Matlab</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="distributional-processes.html"><a href="distributional-processes.html"><i class="fa fa-check"></i><b>3</b> Distributional Processes</a>
<ul>
<li class="chapter" data-level="3.1" data-path="distributional-processes.html"><a href="distributional-processes.html#time-series"><i class="fa fa-check"></i><b>3.1</b> Time Series</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="distributional-processes.html"><a href="distributional-processes.html#simulate-ar1-autoregressive-processes"><i class="fa fa-check"></i><b>3.1.1</b> Simulate AR(1) Autoregressive Processes</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="distributional-processes.html"><a href="distributional-processes.html#cross-sectional-data"><i class="fa fa-check"></i><b>3.2</b> Cross-sectional Data</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="distributional-processes.html"><a href="distributional-processes.html#matlab-mincer-wage-earnings-equation-with-experience-education-and-gamma-shocks"><i class="fa fa-check"></i><b>3.2.1</b> Matlab Mincer Wage Earnings Equation with Experience, Education and Gamma Shocks</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="simulation.html"><a href="simulation.html"><i class="fa fa-check"></i><b>4</b> Simulation</a>
<ul>
<li class="chapter" data-level="4.1" data-path="simulation.html"><a href="simulation.html#normal-distribution"><i class="fa fa-check"></i><b>4.1</b> Normal Distribution</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="simulation.html"><a href="simulation.html#compute-cdf-for-normal-and-bivariate-normal-distributions"><i class="fa fa-check"></i><b>4.1.1</b> Compute CDF for Normal and Bivariate Normal Distributions</a></li>
<li class="chapter" data-level="4.1.2" data-path="simulation.html"><a href="simulation.html#cholesky-decomposition-correlated-bivariate-normal-from-iid-random-draws"><i class="fa fa-check"></i><b>4.1.2</b> Cholesky Decomposition Correlated Bivariate Normal from IID Random Draws</a></li>
<li class="chapter" data-level="4.1.3" data-path="simulation.html"><a href="simulation.html#cholesky-decomposition-correlated-five-dimensional-multivariate-normal-shock"><i class="fa fa-check"></i><b>4.1.3</b> Cholesky Decomposition Correlated Five Dimensional Multivariate Normal Shock</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="graphs.html"><a href="graphs.html"><i class="fa fa-check"></i><b>5</b> Graphs</a>
<ul>
<li class="chapter" data-level="5.1" data-path="graphs.html"><a href="graphs.html#figure-components"><i class="fa fa-check"></i><b>5.1</b> Figure Components</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="graphs.html"><a href="graphs.html#matlab-graph-safe-colors-for-web-presentation-and-publications-examples"><i class="fa fa-check"></i><b>5.1.1</b> Matlab Graph Safe Colors for Web, Presentation and Publications Examples</a></li>
<li class="chapter" data-level="5.1.2" data-path="graphs.html"><a href="graphs.html#matlab-graph-titling-labels-and-legends-examples"><i class="fa fa-check"></i><b>5.1.2</b> Matlab Graph Titling, Labels and Legends Examples</a></li>
<li class="chapter" data-level="5.1.3" data-path="graphs.html"><a href="graphs.html#matlab-graph-matrix-with-jet-spectrum-color-label-a-subset-examples"><i class="fa fa-check"></i><b>5.1.3</b> Matlab Graph Matrix with Jet Spectrum Color, Label a Subset Examples</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="graphs.html"><a href="graphs.html#basic-figure-types"><i class="fa fa-check"></i><b>5.2</b> Basic Figure Types</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="graphs.html"><a href="graphs.html#matlab-graph-scatter-plot-examples"><i class="fa fa-check"></i><b>5.2.1</b> Matlab Graph Scatter Plot Examples</a></li>
<li class="chapter" data-level="5.2.2" data-path="graphs.html"><a href="graphs.html#matlab-line-and-scatter-plot-with-multiple-lines-and-axis-lines"><i class="fa fa-check"></i><b>5.2.2</b> Matlab Line and Scatter Plot with Multiple Lines and Axis Lines</a></li>
<li class="chapter" data-level="5.2.3" data-path="graphs.html"><a href="graphs.html#matlab-graph-scatter-and-line-spectrum-with-three-variables"><i class="fa fa-check"></i><b>5.2.3</b> Matlab Graph Scatter and Line Spectrum with Three Variables</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="graphs.html"><a href="graphs.html#write-and-read-plots"><i class="fa fa-check"></i><b>5.3</b> Write and Read Plots</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="graphs.html"><a href="graphs.html#matlab-graph-generate-eps-postscript-figures-in-matlab"><i class="fa fa-check"></i><b>5.3.1</b> Matlab Graph Generate EPS postscript figures in matlab</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="tables.html"><a href="tables.html"><i class="fa fa-check"></i><b>6</b> Tables</a>
<ul>
<li class="chapter" data-level="6.1" data-path="tables.html"><a href="tables.html#basic-table-generation"><i class="fa fa-check"></i><b>6.1</b> Basic Table Generation</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="tables.html"><a href="tables.html#named-tables-with-random-data"><i class="fa fa-check"></i><b>6.1.1</b> Named Tables with Random Data</a></li>
<li class="chapter" data-level="6.1.2" data-path="tables.html"><a href="tables.html#tables-order-sort-add-rename-and-drop-columns"><i class="fa fa-check"></i><b>6.1.2</b> Tables Order, Sort, Add, Rename and Drop Columns</a></li>
<li class="chapter" data-level="6.1.3" data-path="tables.html"><a href="tables.html#row-and-column-names-for-table-based-on-arrays"><i class="fa fa-check"></i><b>6.1.3</b> Row and Column Names for Table based on Arrays</a></li>
<li class="chapter" data-level="6.1.4" data-path="tables.html"><a href="tables.html#select-subset-of-rows-and-columns"><i class="fa fa-check"></i><b>6.1.4</b> Select Subset of Rows and Columns</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="tables.html"><a href="tables.html#table-joining"><i class="fa fa-check"></i><b>6.2</b> Table Joining</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="tables.html"><a href="tables.html#row-and-column-combine-stack-tables-and-matrices"><i class="fa fa-check"></i><b>6.2.1</b> Row and Column Combine Stack Tables and Matrices</a></li>
</ul></li>
</ul></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="index-and-code-links.html"><a href="index-and-code-links.html"><i class="fa fa-check"></i><b>A</b> Index and Code Links</a>
<ul>
<li class="chapter" data-level="A.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#data-structures-links"><i class="fa fa-check"></i><b>A.1</b> Data Structures links</a>
<ul>
<li class="chapter" data-level="A.1.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-1.1-matrices-and-arraysmatrices-and-arrays-links"><i class="fa fa-check"></i><b>A.1.1</b> <span>Section 1.1 Matrices and Arrays</span> links</a></li>
<li class="chapter" data-level="A.1.2" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-1.2-nd-dimensional-arraysnd-dimensional-arrays-links"><i class="fa fa-check"></i><b>A.1.2</b> <span>Section 1.2 ND Dimensional Arrays</span> links</a></li>
<li class="chapter" data-level="A.1.3" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-1.3-cellscells-links"><i class="fa fa-check"></i><b>A.1.3</b> <span>Section 1.3 Cells</span> links</a></li>
<li class="chapter" data-level="A.1.4" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-1.4-characters-and-stringscharacters-and-strings-links"><i class="fa fa-check"></i><b>A.1.4</b> <span>Section 1.4 Characters and Strings</span> links</a></li>
<li class="chapter" data-level="A.1.5" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-1.5-map-containersmap-containers-links"><i class="fa fa-check"></i><b>A.1.5</b> <span>Section 1.5 Map Containers</span> links</a></li>
<li class="chapter" data-level="A.1.6" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-1.6-map-structure-arraymap-structure-array-links"><i class="fa fa-check"></i><b>A.1.6</b> <span>Section 1.6 Map Structure Array</span> links</a></li>
</ul></li>
<li class="chapter" data-level="A.2" data-path="index-and-code-links.html"><a href="index-and-code-links.html#functions-links"><i class="fa fa-check"></i><b>A.2</b> Functions links</a>
<ul>
<li class="chapter" data-level="A.2.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-2.1-varargin-default-parametersvarargin-default-parameters-links"><i class="fa fa-check"></i><b>A.2.1</b> <span>Section 2.1 varargin Default Parameters</span> links</a></li>
<li class="chapter" data-level="A.2.2" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-2.2-anonymous-functionsanonymous-functions-links"><i class="fa fa-check"></i><b>A.2.2</b> <span>Section 2.2 Anonymous Functions</span> links</a></li>
</ul></li>
<li class="chapter" data-level="A.3" data-path="index-and-code-links.html"><a href="index-and-code-links.html#distributional-processes-links"><i class="fa fa-check"></i><b>A.3</b> Distributional Processes links</a>
<ul>
<li class="chapter" data-level="A.3.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-3.1-time-seriestime-series-links"><i class="fa fa-check"></i><b>A.3.1</b> <span>Section 3.1 Time Series</span> links</a></li>
<li class="chapter" data-level="A.3.2" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-3.2-cross-sectional-datacross-sectional-data-links"><i class="fa fa-check"></i><b>A.3.2</b> <span>Section 3.2 Cross-sectional Data</span> links</a></li>
</ul></li>
<li class="chapter" data-level="A.4" data-path="index-and-code-links.html"><a href="index-and-code-links.html#simulation-links"><i class="fa fa-check"></i><b>A.4</b> Simulation links</a>
<ul>
<li class="chapter" data-level="A.4.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-4.1-normal-distributionnormal-distribution-links"><i class="fa fa-check"></i><b>A.4.1</b> <span>Section 4.1 Normal Distribution</span> links</a></li>
</ul></li>
<li class="chapter" data-level="A.5" data-path="index-and-code-links.html"><a href="index-and-code-links.html#graphs-links"><i class="fa fa-check"></i><b>A.5</b> Graphs links</a>
<ul>
<li class="chapter" data-level="A.5.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-5.1-figure-componentsfigure-components-links"><i class="fa fa-check"></i><b>A.5.1</b> <span>Section 5.1 Figure Components</span> links</a></li>
<li class="chapter" data-level="A.5.2" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-5.2-basic-figure-typesbasic-figure-types-links"><i class="fa fa-check"></i><b>A.5.2</b> <span>Section 5.2 Basic Figure Types</span> links</a></li>
<li class="chapter" data-level="A.5.3" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-5.3-write-and-read-plotswrite-and-read-plots-links"><i class="fa fa-check"></i><b>A.5.3</b> <span>Section 5.3 Write and Read Plots</span> links</a></li>
</ul></li>
<li class="chapter" data-level="A.6" data-path="index-and-code-links.html"><a href="index-and-code-links.html#tables-links"><i class="fa fa-check"></i><b>A.6</b> Tables links</a>
<ul>
<li class="chapter" data-level="A.6.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-6.1-basic-table-generationbasic-table-generation-links"><i class="fa fa-check"></i><b>A.6.1</b> <span>Section 6.1 Basic Table Generation</span> links</a></li>
<li class="chapter" data-level="A.6.2" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-6.2-table-joiningtable-joining-links"><i class="fa fa-check"></i><b>A.6.2</b> <span>Section 6.2 Table Joining</span> links</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://fanwangecon.github.io/M4Econ/bookdown/index.html" target="blank">M4Econ Bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Data Structures and Dynamic Optimization with Matlab</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="simulation" class="section level1" number="4">
<h1><span class="header-section-number">Chapter 4</span> Simulation</h1>

<div id="normal-distribution" class="section level2" number="4.1">
<h2><span class="header-section-number">4.1</span> Normal Distribution</h2>

<div id="compute-cdf-for-normal-and-bivariate-normal-distributions" class="section level3" number="4.1.1">
<h3><span class="header-section-number">4.1.1</span> Compute CDF for Normal and Bivariate Normal Distributions</h3>
<blockquote>
<p>Go back to <a href="http://fanwangecon.github.io/">fan</a>’s <a href="https://fanwangecon.github.io/MEconTools/">MEconTools</a> Package, <a href="https://fanwangecon.github.io/M4Econ/">Matlab Code Examples</a> Repository (<a href="https://fanwangecon.github.io/M4Econ/bookdown">bookdown site</a>), or <a href="https://fanwangecon.github.io/Math4Econ/">Math for Econ with Matlab</a> Repository (<a href="https://fanwangecon.github.io/Math4Econ/bookdown">bookdown site</a>).</p>
</blockquote>
<p>CDF for normal random variable through simulation and with NORMCDF
function. CDF for bivariate normal random variables through simulation
and with NORMCDF function.</p>
<ul>
<li><p><a href="https://fanwangecon.github.io/M4Econ/simulation/normal/htmlpdfm/fs_cholesky_decomposition.html">fs_cholesky_decomposition</a></p></li>
<li><p><a href="https://fanwangecon.github.io/M4Econ/simulation/normal/htmlpdfm/fs_cholesky_decomposition_d5.html">fs_cholesky_decomposition_d5</a></p></li>
<li><p><a href="https://fanwangecon.github.io/M4Econ/simulation/normal/htmlpdfm/fs_bivariate_normal.html">fs_bivariate_normal</a></p></li>
</ul>
<div id="simulate-normal-distribution-probability-with-uniform-draws" class="section level4" number="4.1.1.1">
<h4><span class="header-section-number">4.1.1.1</span> Simulate Normal Distribution Probability with Uniform Draws</h4>
<p>Mean score is 0, standard deviation is 1, we want to know what is the
chance that children score less than -2, -1, 0, 1, and 2 respectively.
We have a solution to the normal CDF cumulative distribution problem, it
is:</p>
<pre><code>mu = 0;
sigma = 1;
ar_x = [-2,-1,0,1,2];
for x=ar_x
    cdf_x = normcdf(x, mu, sigma);
    disp([strjoin(...
        [&quot;CDF with normcdf&quot;, ...
        [&#39;x=&#39; num2str(x)] ...
        [&#39;cdf_x=&#39; num2str(cdf_x)] ...
        ], &quot;;&quot;)]);
end

CDF with normcdf;x=-2;cdf_x=0.02275
CDF with normcdf;x=-1;cdf_x=0.15866
CDF with normcdf;x=0;cdf_x=0.5
CDF with normcdf;x=1;cdf_x=0.84134
CDF with normcdf;x=2;cdf_x=0.97725</code></pre>
<p>We can also approximate the probabilities above, by drawing many points
from a unifom:</p>
<ol style="list-style-type: decimal">
<li><p>Draw from uniform distribution 0 to 1, N times.</p></li>
<li><p>Invert these using invnorm. This means our uniform draws are now
effectively drawn from the normal distribution.</p></li>
<li><p>Check if each draw inverted is below the x threshold or above, count
fractions.</p></li>
</ol>
<p>We should get very similar results as in the example above (especially
if N is large)</p>
<pre><code>% set seed
rng(123);
% generate random numbers
N = 10000;
ar_unif_draws = rand(1,N);
% invert
ar_normal_draws = norminv(ar_unif_draws);
% loop over different x values
for x=ar_x
    % index if draws below x
    ar_it_idx_below_x = (ar_normal_draws &lt; x);
    fl_frac_below_x = (sum(ar_it_idx_below_x))/N;
    disp([strjoin(...
        [&quot;CDF with normcdf&quot;, ...
        [&#39;x=&#39; num2str(x)] ...
        [&#39;fl_frac_below_x=&#39; num2str(fl_frac_below_x)] ...
        ], &quot;;&quot;)]);
end

CDF with normcdf;x=-2;fl_frac_below_x=0.023
CDF with normcdf;x=-1;fl_frac_below_x=0.1612
CDF with normcdf;x=0;fl_frac_below_x=0.4965
CDF with normcdf;x=1;fl_frac_below_x=0.847
CDF with normcdf;x=2;fl_frac_below_x=0.9789</code></pre>
</div>
<div id="simulate-bivariate-normal-distribution-probability-with-uniform-draws" class="section level4" number="4.1.1.2">
<h4><span class="header-section-number">4.1.1.2</span> Simulate Bivariate-Normal Distribution Probability with Uniform Draws</h4>
<p>There are two tests now, a math test and an English test. Student test
scores are correlated with correlation 0.5 from the two tests, mean and
standard deviations are 0 and 1 for both tests. What is the chance that
a student scores below -2 and -2 for both, below -2 and 0 for math and
English, below 2 and 1 for math and English, etc?</p>
<pre><code>% timer
tm_start_mvncdf = tic;
% mean, and varcov
ar_mu = [0,0];
mt_varcov = [1,0.5;0.5,1];
ar_x = linspace(-3,3,101);
% initialize storage
mt_prob_math_eng = zeros([length(ar_x), length(ar_x)]);
% loop over math and english score thresholds
it_math = 0;
for math=ar_x
    it_math = it_math + 1;
    it_eng = 0;
    for eng=ar_x
        it_eng = it_eng + 1;
        % points below which to compute probability 
        ar_scores = [math, eng];
        % volumn of a mountain to the southwest of north-south and east-west cuts
        cdf_x = mvncdf(ar_scores, ar_mu, mt_varcov);
        mt_prob_math_eng(it_math, it_eng) = cdf_x;
    end
end
% end timer
tm_end_mvncdf = toc(tm_start_mvncdf);
st_complete = strjoin(...
    [&quot;MVNCDF Completed CDF computes&quot;, ...
     [&#39;number of points=&#39; num2str(numel(mt_prob_math_eng))] ...
     [&#39;time=&#39; num2str(tm_end_mvncdf)] ...
    ], &quot;;&quot;);
disp(st_complete);

MVNCDF Completed CDF computes;number of points=10201;time=1.1957

% show results
tb_prob_math_eng = array2table(round(mt_prob_math_eng, 4));
cl_col_names_a = strcat(&#39;english &lt;=&#39;, string(ar_x&#39;));
cl_row_names_a = strcat(&#39;math &lt;=&#39;, string(ar_x&#39;));
tb_prob_math_eng.Properties.VariableNames = cl_col_names_a;
tb_prob_math_eng.Properties.RowNames = cl_row_names_a;
% subsetting function
% https://fanwangecon.github.io/M4Econ/amto/array/htmlpdfm/fs_slicing.html#19_Given_Array_of_size_M,_Select_N_somewhat_equi-distance_elements
f_subset = @(it_subset_n, it_ar_n) unique(round(((0:1:(it_subset_n-1))/(it_subset_n-1))*(it_ar_n-1)+1));
disp(tb_prob_math_eng(f_subset(7, length(ar_x)), f_subset(7, length(ar_x))));

                    english &lt;=-3    english &lt;=-1.98    english &lt;=-1.02    english &lt;=0    english &lt;=1.02    english &lt;=1.98    english &lt;=3
                    ____________    _______________    _______________    ___________    ______________    ______________    ___________

    math &lt;=-3          0.0001           0.0005              0.001           0.0013           0.0013            0.0013          0.0013   
    math &lt;=-1.98       0.0005           0.0043             0.0136           0.0217           0.0237            0.0238          0.0239   
    math &lt;=-1.02        0.001           0.0136             0.0598           0.1239           0.1505            0.1537          0.1539   
    math &lt;=0           0.0013           0.0217             0.1239           0.3333           0.4701            0.4978             0.5   
    math &lt;=1.02        0.0013           0.0237             0.1505           0.4701           0.7521            0.8359          0.8458   
    math &lt;=1.98        0.0013           0.0238             0.1537           0.4978           0.8359            0.9566          0.9753   
    math &lt;=3           0.0013           0.0239             0.1539              0.5           0.8458            0.9753          0.9974   </code></pre>
<p>We can also approximate the probabilities above, by drawing many points
from two iid uniforms, and translating them to correlated normal using
cholesky decomposition:</p>
<ol style="list-style-type: decimal">
<li><p>Draw from two random uniform distribution 0 to 1, N times each</p></li>
<li><p>Invert these using invnorm for both iid vectors from unifom draws to
normal draws</p></li>
<li><p>Choleskey decompose and multiplication</p></li>
</ol>
<p>This method below is faster than the method above when the number of
points where we have to evaluat probabilities is large.</p>
<p>Generate randomly drawn scores:</p>
<pre><code>% timer
tm_start_chol = tic;
% Draws uniform and invert to standard normal draws
N = 10000;
rng(123);
ar_unif_draws = rand(1,N*2);
ar_normal_draws = norminv(ar_unif_draws);
ar_draws_eta_1 = ar_normal_draws(1:N);
ar_draws_eta_2 = ar_normal_draws((N+1):N*2);

% Choesley decompose the variance covariance matrix
mt_varcov_chol = chol(mt_varcov, &#39;lower&#39;);

% Generate correlated random normals
mt_scores_chol = ar_mu&#39; + mt_varcov_chol*([ar_draws_eta_1; ar_draws_eta_2]);
ar_math_scores = mt_scores_chol(1,:)&#39;;
ar_eng_scores = mt_scores_chol(2,:)&#39;;</code></pre>
<p>Approximate probabilities from randomly drawn scores:</p>
<pre><code>% initialize storage
mt_prob_math_eng_approx = zeros([length(ar_x), length(ar_x)]);
% loop over math and english score thresholds
it_math = 0;
for math=ar_x
    it_math = it_math + 1;
    it_eng = 0;
    for eng=ar_x
        it_eng = it_eng + 1;
        
        % points below which to compute probability 
        % index if draws below x
        ar_it_idx_below_x_math = (ar_math_scores &lt; math);
        ar_it_idx_below_x_eng = (ar_eng_scores &lt; eng);
        ar_it_idx_below_x_joint = ar_it_idx_below_x_math.*ar_it_idx_below_x_eng;
        fl_frac_below_x_approx = (sum(ar_it_idx_below_x_joint))/N;
        
        % volumn of a mountain to the southwest of north-south and east-west cuts
        mt_prob_math_eng_approx(it_math, it_eng) = fl_frac_below_x_approx;
    end
end
% end timer
tm_end_chol = toc(tm_start_chol);
st_complete = strjoin(...
    [&quot;UNIF+CHOL Completed CDF computes&quot;, ...
     [&#39;number of points=&#39; num2str(numel(mt_prob_math_eng_approx))] ...
     [&#39;time=&#39; num2str(tm_end_chol)] ...
    ], &quot;;&quot;);
disp(st_complete);

UNIF+CHOL Completed CDF computes;number of points=10201;time=0.28661

% show results
tb_prob_math_eng_approx = array2table(round(mt_prob_math_eng_approx, 4));
cl_col_names_a = strcat(&#39;english &lt;=&#39;, string(ar_x&#39;));
cl_row_names_a = strcat(&#39;math &lt;=&#39;, string(ar_x&#39;));
tb_prob_math_eng_approx.Properties.VariableNames = cl_col_names_a;
tb_prob_math_eng_approx.Properties.RowNames = cl_row_names_a;
disp(tb_prob_math_eng_approx(f_subset(7, length(ar_x)), f_subset(7, length(ar_x))));

                    english &lt;=-3    english &lt;=-1.98    english &lt;=-1.02    english &lt;=0    english &lt;=1.02    english &lt;=1.98    english &lt;=3
                    ____________    _______________    _______________    ___________    ______________    ______________    ___________

    math &lt;=-3          0.0001           0.0005              0.001           0.0016           0.0016            0.0016          0.0016   
    math &lt;=-1.98       0.0003            0.004             0.0132           0.0218           0.0237            0.0239          0.0239   
    math &lt;=-1.02       0.0008           0.0131              0.061           0.1272           0.1529             0.157          0.1571   
    math &lt;=0           0.0009           0.0202             0.1236            0.334           0.4661            0.4946          0.4965   
    math &lt;=1.02        0.0009           0.0215             0.1493           0.4724            0.754            0.8411          0.8511   
    math &lt;=1.98        0.0009           0.0217             0.1526           0.4989           0.8344            0.9591           0.977   
    math &lt;=3           0.0009           0.0217             0.1526           0.5007           0.8425            0.9768          0.9976   </code></pre>

</div>
</div>
<div id="cholesky-decomposition-correlated-bivariate-normal-from-iid-random-draws" class="section level3" number="4.1.2">
<h3><span class="header-section-number">4.1.2</span> Cholesky Decomposition Correlated Bivariate Normal from IID Random Draws</h3>
<blockquote>
<p>Go back to <a href="http://fanwangecon.github.io/">fan</a>’s <a href="https://fanwangecon.github.io/MEconTools/">MEconTools</a> Package, <a href="https://fanwangecon.github.io/M4Econ/">Matlab Code Examples</a> Repository (<a href="https://fanwangecon.github.io/M4Econ/bookdown">bookdown site</a>), or <a href="https://fanwangecon.github.io/Math4Econ/">Math for Econ with Matlab</a> Repository (<a href="https://fanwangecon.github.io/Math4Econ/bookdown">bookdown site</a>).</p>
</blockquote>
<p>Draw two correlated normal shocks using the MVNRND function. Draw two
correlated normal shocks from uniform random variables using Cholesky
Decomposition.</p>
<ul>
<li><p><a href="https://fanwangecon.github.io/M4Econ/simulation/normal/htmlpdfm/fs_cholesky_decomposition.html">fs_cholesky_decomposition</a></p></li>
<li><p><a href="https://fanwangecon.github.io/M4Econ/simulation/normal/htmlpdfm/fs_cholesky_decomposition_d5.html">fs_cholesky_decomposition_d5</a></p></li>
<li><p><a href="https://fanwangecon.github.io/M4Econ/simulation/normal/htmlpdfm/fs_bivariate_normal.html">fs_bivariate_normal</a></p></li>
</ul>
<div id="positively-correlated-scores-mvnrnd" class="section level4" number="4.1.2.1">
<h4><span class="header-section-number">4.1.2.1</span> Positively Correlated Scores MVNRND</h4>
<p>We have English and Math scores, and we draw from a bivariate normal
distribution, assuming the two scores are positively correlatd. These
are <span class="math inline">\(x_1\)</span> and <span class="math inline">\(x_2\)</span>.</p>
<pre><code>% mean, and varcov
ar_mu = [70,80];
mt_varcov = [8,5;5,5];
% Generate Scores
rng(123);
N = 10000;
mt_scores = mvnrnd(ar_mu, mt_varcov, N);
% graph
figure();
scatter(mt_scores(:,1), mt_scores(:,2));
ylabel(&#39;English Scores&#39;);
xlabel(&#39;Math Scores&#39;)
grid on;</code></pre>
<p><img src="img/fs_cholesky_decomposition_images/figure_0.png" width="500" /></p>
<p>What are the covariance and correlation statistics?</p>
<pre><code>disp([num2str(cov(mt_scores(:,1), mt_scores(:,2)))]);

8.0557      5.0738
5.0738      5.0638

disp([num2str(corrcoef(mt_scores(:,1), mt_scores(:,2)))]);

      1     0.79441
0.79441           1</code></pre>
</div>
<div id="bivariate-normal-from-uncorrelated-draws-via-cholesky-decomposition" class="section level4" number="4.1.2.2">
<h4><span class="header-section-number">4.1.2.2</span> Bivariate Normal from Uncorrelated Draws via Cholesky Decomposition</h4>
<p>We can get the same results as above, without having to explicitly draw
from a multivariate distribution by (For more details see <a href="https://eml.berkeley.edu/~train/distant.html">Train
(2009)</a>):</p>
<ol style="list-style-type: decimal">
<li><p>Draw 2 uniform random iid vectors.</p></li>
<li><p>Convert to normal iid vectors.</p></li>
<li><p>Generate the test scores as a function of the two random variables,
using Cholesky matrix.</p></li>
</ol>
<p><u><strong><em>First</em></strong></u>, draw two uncorrelated normal random variables, with
mean 0, sd 1, <span class="math inline">\(\eta_1\)</span> and <span class="math inline">\(\eta_2\)</span>.</p>
<pre><code>% Draw Two Uncorrelated Normal Random Variables
% use the same N as above
rng(123);
% uniform draws, uncorrelated
ar_unif_draws = rand(1,N*2);
% normal draws, english and math are uncorreated
% ar_draws_eta_1 and ar_draws_eta_2 are uncorrelated by construction
ar_normal_draws = norminv(ar_unif_draws);
ar_draws_eta_1 = ar_normal_draws(1:N);
ar_draws_eta_2 = ar_normal_draws((N+1):N*2);
% graph
figure();
scatter(ar_draws_eta_1, ar_draws_eta_2);
ylabel(&#39;iid eta 1 draws&#39;);
xlabel(&#39;iid eta 2 draws&#39;)
grid on;</code></pre>
<p><img src="img/fs_cholesky_decomposition_images/figure_1.png" width="500" /></p>
<pre><code>% Show Mean 1, cov = 0
disp([num2str(cov(ar_draws_eta_1, ar_draws_eta_2))]);

  0.99075   0.0056929
0.0056929     0.98517

disp([num2str(corrcoef(ar_draws_eta_1, ar_draws_eta_2))]);

        1   0.0057623
0.0057623           1</code></pre>
<p><u><strong><em>Second</em></strong></u>, now using the variance-covariance we already have,
decompose it, we will have:</p>
<ul>
<li><span class="math inline">\(\displaystyle \begin{array}{l} c_{aa} \,,\,\,0\\ c_{ab} \,,\,\,c_{bb} \end{array}\)</span></li>
</ul>
<!-- -->
<pre><code>% Choesley decompose the variance covariance matrix
mt_varcov_chol = chol(mt_varcov, &#39;lower&#39;);
disp([num2str(mt_varcov_chol)]);

2.8284           0
1.7678      1.3693

% The cholesky decomposed matrix factorizes the original varcov matrix
disp([num2str(mt_varcov_chol*mt_varcov_chol&#39;)]);

8           5
5           5</code></pre>
<p><u><strong><em>Third</em></strong></u>, We can get back to the original <span class="math inline">\(x_1\)</span> and <span class="math inline">\(x_2\)</span>
variables:</p>
<ul>
<li><p><span class="math inline">\(\displaystyle x_1 =\mu_1 +c_{aa} *\eta_1\)</span></p></li>
<li><p><span class="math inline">\(\displaystyle x_2 =\mu_2 +c_{ab} *\eta_1 +c_{bb} *\eta_2\)</span></p></li>
</ul>
<!-- -->
<pre><code>% multiple the cholesky matrix by the eta draws
mt_scores_chol = ar_mu&#39; + mt_varcov_chol*([ar_draws_eta_1; ar_draws_eta_2]);
mt_scores_chol = mt_scores_chol&#39;;
% graph
figure();
scatter(mt_scores_chol(:,1), mt_scores_chol(:,2));
ylabel(&#39;English Scores Chol from iid Draws = m1 + c\_aa*eta\_1&#39;);
xlabel(&#39;Math Scores Chol from iid Draws = m2 + c\_ab*eta\_1 + c\_bb*eta\_2&#39;)
grid on;</code></pre>
<p><img src="img/fs_cholesky_decomposition_images/figure_2.png" width="500" /></p>
<pre><code>disp([num2str(cov(mt_scores_chol(:,1), mt_scores_chol(:,2)))]);

 7.926      4.9758
4.9758      4.9708

disp([num2str(corrcoef(mt_scores_chol(:,1), mt_scores_chol(:,2)))]);

      1     0.79272
0.79272           1</code></pre>

</div>
</div>
<div id="cholesky-decomposition-correlated-five-dimensional-multivariate-normal-shock" class="section level3" number="4.1.3">
<h3><span class="header-section-number">4.1.3</span> Cholesky Decomposition Correlated Five Dimensional Multivariate Normal Shock</h3>
<blockquote>
<p>Go back to <a href="http://fanwangecon.github.io/">fan</a>’s <a href="https://fanwangecon.github.io/MEconTools/">MEconTools</a> Package, <a href="https://fanwangecon.github.io/M4Econ/">Matlab Code Examples</a> Repository (<a href="https://fanwangecon.github.io/M4Econ/bookdown">bookdown site</a>), or <a href="https://fanwangecon.github.io/Math4Econ/">Math for Econ with Matlab</a> Repository (<a href="https://fanwangecon.github.io/Math4Econ/bookdown">bookdown site</a>).</p>
</blockquote>
<p>Generate variance-covariance matrix from correlation and standard
deviation. Draw five correlated normal shocks using the MVNRND function.
Draw five correlated normal shocks from uniform random variables using
Cholesky Decomposition.</p>
<ul>
<li><p><a href="https://fanwangecon.github.io/M4Econ/simulation/normal/htmlpdfm/fs_cholesky_decomposition.html">fs_cholesky_decomposition</a></p></li>
<li><p><a href="https://fanwangecon.github.io/M4Econ/simulation/normal/htmlpdfm/fs_cholesky_decomposition_d5.html">fs_cholesky_decomposition_d5</a></p></li>
<li><p><a href="https://fanwangecon.github.io/M4Econ/simulation/normal/htmlpdfm/fs_bivariate_normal.html">fs_bivariate_normal</a></p></li>
</ul>
<div id="correlation-and-standard-deviations-to-variance-covariance-matrix" class="section level4" number="4.1.3.1">
<h4><span class="header-section-number">4.1.3.1</span> Correlation and Standard Deviations to Variance Covariance Matrix</h4>
<p>Given correlations and standard deviations, what is the variance and
covariance matrix? Assume mean 0. The first three variables are
correlated, the final two are iid.</p>
<p>First the ingredients:</p>
<pre><code>% mean array
ar_mu = [0,0,0,0,0];
% standard deviations
ar_sd = [0.3301, 0.3329, 0.3308, 2312, 13394];
% correlations 
mt_cor = ...
    [1,0.1226,0.0182,0,0;...
     0.1226,1,0.4727,0,0;...
     0.0182,0.4727,1,0,0;...
     0,0,0,1,0;...
     0,0,0,0,1];
% show
disp(mt_cor);

    1.0000    0.1226    0.0182         0         0
    0.1226    1.0000    0.4727         0         0
    0.0182    0.4727    1.0000         0         0
         0         0         0    1.0000         0
         0         0         0         0    1.0000</code></pre>
<p>Second, we know that variance is the square of standard deviation. And
we know the formula for covariance, which is variance divided by two
standard deviations. So for the example here, we have:</p>
<pre><code>% initialize
mt_varcov = zeros([5,5]);
% variance
mt_varcov(eye(5)==1) = ar_sd.^2;
% covariance
mt_varcov(1,2) = mt_cor(1,2)*ar_sd(1)*ar_sd(2);
mt_varcov(2,1) = mt_varcov(1,2);
mt_varcov(1,3) = mt_cor(1,3)*ar_sd(1)*ar_sd(3);
mt_varcov(3,1) = mt_varcov(1,3);
mt_varcov(2,3) = mt_cor(2,3)*ar_sd(2)*ar_sd(3);
mt_varcov(3,2) = mt_varcov(2,3);
% show
disp(mt_varcov(1:3,1:3));

    0.1090    0.0135    0.0020
    0.0135    0.1108    0.0521
    0.0020    0.0521    0.1094

disp(mt_varcov(4:5,4:5));

     5345344           0
           0   179399236</code></pre>
</div>
<div id="draw-five-correlated-shocks-using-mvnrnd" class="section level4" number="4.1.3.2">
<h4><span class="header-section-number">4.1.3.2</span> Draw Five Correlated Shocks Using MVNRND</h4>
<p>Generate N5 correlated shock structure</p>
<pre><code>% Generate Scores
rng(123);
N = 50000;
mt_kw97_eps = mvnrnd(ar_mu, mt_varcov, N);
% graph
figure();
% subfigure 1
subplot(2,2,1);
scatter(mt_kw97_eps(:,1), mt_kw97_eps(:,2));
ylabel(&#39;White Collar Wage Shock&#39;);
xlabel(&#39;Blue Collar Wage Shock&#39;)
grid on;
% subfigure 2
subplot(2,2,2);
scatter(mt_kw97_eps(:,1), mt_kw97_eps(:,3));
ylabel(&#39;White Collar Wage Shock&#39;);
xlabel(&#39;Military Wage Shock&#39;)
grid on;
% subfigure 3
subplot(2,2,3);
scatter(mt_kw97_eps(:,3), mt_kw97_eps(:,2));
ylabel(&#39;Military Wage Shock&#39;);
xlabel(&#39;Blue Collar Wage Shock&#39;)
grid on;
% subfigure 4
subplot(2,2,4);
scatter(mt_kw97_eps(:,1), mt_kw97_eps(:,4));
ylabel(&#39;White Collar Wage Shock&#39;);
xlabel(&#39;School Shock&#39;)
grid on;</code></pre>
<p><img src="img/fs_cholesky_decomposition_d5_images/figure_0.png" width="500" /></p>
<p>What are the covariance and correlation statistics?</p>
<pre><code>disp([num2str(round(corrcoef(mt_kw97_eps),3))]);

     1       0.119       0.016       0.002      -0.003
 0.119           1       0.468      -0.003       0.004
 0.016       0.468           1      -0.003       0.001
 0.002      -0.003      -0.003           1      -0.005
-0.003       0.004       0.001      -0.005           1

disp([num2str(round(corrcoef(mt_kw97_eps),2))]);

   1        0.12        0.02           0           0
0.12           1        0.47           0           0
0.02        0.47           1           0           0
   0           0           0           1       -0.01
   0           0           0       -0.01           1</code></pre>
</div>
<div id="draw-five-correlated-shocks-using-cholesky-decomposition" class="section level4" number="4.1.3.3">
<h4><span class="header-section-number">4.1.3.3</span> Draw Five Correlated Shocks Using Cholesky Decomposition</h4>
<p>Following what we did for bivariate normal distribution, we can now do
the same for five different shocks at the same time (For more details
see <a href="https://eml.berkeley.edu/~train/distant.html">Train (2009)</a>):</p>
<ol style="list-style-type: decimal">
<li><p>Draw 5 normal random variables that are uncorrelated</p></li>
<li><p>Generate 5 correlated shocks</p></li>
</ol>
<p>Draw the shocks</p>
<pre><code>% Draws uniform and invert to standard normal draws
rng(123);
ar_unif_draws = rand(1,N*5);
ar_normal_draws = norminv(ar_unif_draws);
ar_draws_eta_1 = ar_normal_draws((N*0+1):N*1);
ar_draws_eta_2 = ar_normal_draws((N*1+1):N*2);
ar_draws_eta_3 = ar_normal_draws((N*2+1):N*3);
ar_draws_eta_4 = ar_normal_draws((N*3+1):N*4);
ar_draws_eta_5 = ar_normal_draws((N*4+1):N*5);

% Choesley decompose the variance covariance matrix
mt_varcov_chol = chol(mt_varcov, &#39;lower&#39;);

% Generate correlated random normals
mt_kp97_eps_chol = ar_mu&#39; + mt_varcov_chol*([...
    ar_draws_eta_1; ar_draws_eta_2; ar_draws_eta_3; ar_draws_eta_4; ar_draws_eta_5]);
mt_kp97_eps_chol = mt_kp97_eps_chol&#39;;</code></pre>
<p>Graph:</p>
<pre><code>% graph
figure();
% subfigure 1
subplot(2,2,1);
scatter(mt_kp97_eps_chol(:,1), mt_kp97_eps_chol(:,2));
ylabel(&#39;CHOL White Collar Wage Shock&#39;);
xlabel(&#39;CHOL Blue Collar Wage Shock&#39;)
grid on;
% subfigure 2
subplot(2,2,2);
scatter(mt_kp97_eps_chol(:,1), mt_kp97_eps_chol(:,3));
ylabel(&#39;CHOL White Collar Wage Shock&#39;);
xlabel(&#39;CHOL Military Wage Shock&#39;)
grid on;
% subfigure 3
subplot(2,2,3);
scatter(mt_kp97_eps_chol(:,3), mt_kp97_eps_chol(:,2));
ylabel(&#39;CHOL Military Wage Shock&#39;);
xlabel(&#39;CHOL Blue Collar Wage Shock&#39;)
grid on;
% subfigure 4
subplot(2,2,4);
scatter(mt_kp97_eps_chol(:,1), mt_kp97_eps_chol(:,4));
ylabel(&#39;CHOL White Collar Wage Shock&#39;);
xlabel(&#39;CHOL School Shock&#39;)
grid on;</code></pre>
<p><img src="img/fs_cholesky_decomposition_d5_images/figure_1.png" width="500" /></p>
<p>What are the covariance and correlation statistics?</p>
<pre><code>disp([num2str(round(corrcoef(mt_kp97_eps_chol),3))]);

     1       0.119       0.021       0.008      -0.003
 0.119           1       0.479       0.008      -0.003
 0.021       0.479           1       0.002           0
 0.008       0.008       0.002           1      -0.004
-0.003      -0.003           0      -0.004           1

disp([num2str(round(corrcoef(mt_kp97_eps_chol),2))]);

   1        0.12        0.02        0.01           0
0.12           1        0.48        0.01           0
0.02        0.48           1           0           0
0.01        0.01           0           1           0
   0           0           0           0           1</code></pre>

</div>
</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="distributional-processes.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="graphs.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": [["Data-Structures-and-Dynamic-Optimization-with-Matlab.pdf", "PDF"]],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
