<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 7 Tables | Data Structures and Dynamic Optimization with Matlab</title>
  <meta name="description" content="Group table by one or several group variables, and aggregate over another numerical variable within group." />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 7 Tables | Data Structures and Dynamic Optimization with Matlab" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Group table by one or several group variables, and aggregate over another numerical variable within group." />
  <meta name="github-repo" content="fanwangecon/M4Econ" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 7 Tables | Data Structures and Dynamic Optimization with Matlab" />
  
  <meta name="twitter:description" content="Group table by one or several group variables, and aggregate over another numerical variable within group." />
  

<meta name="author" content="Fan Wang" />


<meta name="date" content="2021-07-01" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="graphs.html"/>
<link rel="next" href="index-and-code-links.html"/>
<script src="libs/header-attrs-2.5/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.0/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0/anchor-sections.js"></script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-92953468-6"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-92953468-6');
</script>



<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Data Structures and Dynamic Optimization with Matlab</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="data-structures.html"><a href="data-structures.html"><i class="fa fa-check"></i><b>1</b> Data Structures</a>
<ul>
<li class="chapter" data-level="1.1" data-path="data-structures.html"><a href="data-structures.html#matrices-and-arrays"><i class="fa fa-check"></i><b>1.1</b> Matrices and Arrays</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="data-structures.html"><a href="data-structures.html#array-reshape-repeat-and-expand-examples"><i class="fa fa-check"></i><b>1.1.1</b> Array Reshape, Repeat and Expand Examples</a></li>
<li class="chapter" data-level="1.1.2" data-path="data-structures.html"><a href="data-structures.html#array-index-slicing-and-subsetting-to-replace-and-expand"><i class="fa fa-check"></i><b>1.1.2</b> Array Index Slicing and Subsetting to Replace and Expand</a></li>
<li class="chapter" data-level="1.1.3" data-path="data-structures.html"><a href="data-structures.html#maximum-of-matrix-columns-sort-matrix-columns"><i class="fa fa-check"></i><b>1.1.3</b> Maximum of Matrix Columns, Sort Matrix Columns</a></li>
<li class="chapter" data-level="1.1.4" data-path="data-structures.html"><a href="data-structures.html#array-broadcast-and-expansion-examples"><i class="fa fa-check"></i><b>1.1.4</b> Array Broadcast and Expansion Examples</a></li>
<li class="chapter" data-level="1.1.5" data-path="data-structures.html"><a href="data-structures.html#grid-states-choices-and-optimal-choices-example"><i class="fa fa-check"></i><b>1.1.5</b> Grid States, Choices and Optimal Choices Example</a></li>
<li class="chapter" data-level="1.1.6" data-path="data-structures.html"><a href="data-structures.html#accumarray-examples"><i class="fa fa-check"></i><b>1.1.6</b> Accumarray Examples</a></li>
<li class="chapter" data-level="1.1.7" data-path="data-structures.html"><a href="data-structures.html#matlab-miscellaneous-and-basic-numeric-and-array-operations"><i class="fa fa-check"></i><b>1.1.7</b> Matlab Miscellaneous and Basic Numeric and Array Operations</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="data-structures.html"><a href="data-structures.html#nd-dimensional-arrays"><i class="fa fa-check"></i><b>1.2</b> ND Dimensional Arrays</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="data-structures.html"><a href="data-structures.html#joint-arrays-all-combinations-and-by-random-subset"><i class="fa fa-check"></i><b>1.2.1</b> Joint Arrays All Combinations and by Random Subset</a></li>
<li class="chapter" data-level="1.2.2" data-path="data-structures.html"><a href="data-structures.html#d-4d-nd-arrays-reshape-and-rearrange-dimensions"><i class="fa fa-check"></i><b>1.2.2</b> 3D, 4D, ND Arrays Reshape and Rearrange Dimensions</a></li>
<li class="chapter" data-level="1.2.3" data-path="data-structures.html"><a href="data-structures.html#multidimensional-nd-array-to-2d-matrix-with-wide-to-long"><i class="fa fa-check"></i><b>1.2.3</b> Multidimensional ND Array to 2D Matrix with Wide to Long</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="data-structures.html"><a href="data-structures.html#cells"><i class="fa fa-check"></i><b>1.3</b> Cells</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="data-structures.html"><a href="data-structures.html#matlab-cell-array-basic-operations"><i class="fa fa-check"></i><b>1.3.1</b> Matlab Cell Array Basic Operations</a></li>
<li class="chapter" data-level="1.3.2" data-path="data-structures.html"><a href="data-structures.html#matlab-list-comprehension-with-cells"><i class="fa fa-check"></i><b>1.3.2</b> Matlab List Comprehension with Cells</a></li>
<li class="chapter" data-level="1.3.3" data-path="data-structures.html"><a href="data-structures.html#all-possible-combinations-of-multiple-arrays"><i class="fa fa-check"></i><b>1.3.3</b> All Possible Combinations of Multiple Arrays</a></li>
<li class="chapter" data-level="1.3.4" data-path="data-structures.html"><a href="data-structures.html#nested-cells"><i class="fa fa-check"></i><b>1.3.4</b> Nested Cells</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="data-structures.html"><a href="data-structures.html#characters-and-strings"><i class="fa fa-check"></i><b>1.4</b> Characters and Strings</a>
<ul>
<li class="chapter" data-level="1.4.1" data-path="data-structures.html"><a href="data-structures.html#basic-string-operations-display-search-join-and-split"><i class="fa fa-check"></i><b>1.4.1</b> Basic String Operations, Display, Search, Join and Split</a></li>
<li class="chapter" data-level="1.4.2" data-path="data-structures.html"><a href="data-structures.html#string-array-manipulations-join-find-replace-and-the-alphabet"><i class="fa fa-check"></i><b>1.4.2</b> String Array Manipulations, Join, Find, Replace and the Alphabet</a></li>
<li class="chapter" data-level="1.4.3" data-path="data-structures.html"><a href="data-structures.html#convert-and-concatenate-strings-arrays-with-numbers-and-number-arrays-with-strings"><i class="fa fa-check"></i><b>1.4.3</b> Convert and Concatenate Strings Arrays with Numbers and Number Arrays with Strings</a></li>
</ul></li>
<li class="chapter" data-level="1.5" data-path="data-structures.html"><a href="data-structures.html#map-containers"><i class="fa fa-check"></i><b>1.5</b> Map Containers</a>
<ul>
<li class="chapter" data-level="1.5.1" data-path="data-structures.html"><a href="data-structures.html#container-map-basics"><i class="fa fa-check"></i><b>1.5.1</b> Container Map Basics</a></li>
<li class="chapter" data-level="1.5.2" data-path="data-structures.html"><a href="data-structures.html#container-map-display-swtich-key-and-values-and-subseting"><i class="fa fa-check"></i><b>1.5.2</b> Container Map Display Swtich Key and Values and Subseting</a></li>
<li class="chapter" data-level="1.5.3" data-path="data-structures.html"><a href="data-structures.html#container-map-example-overriding"><i class="fa fa-check"></i><b>1.5.3</b> Container Map Example Overriding</a></li>
</ul></li>
<li class="chapter" data-level="1.6" data-path="data-structures.html"><a href="data-structures.html#map-structure-array"><i class="fa fa-check"></i><b>1.6</b> Map Structure Array</a>
<ul>
<li class="chapter" data-level="1.6.1" data-path="data-structures.html"><a href="data-structures.html#maplab-nested-container-map-with-struct"><i class="fa fa-check"></i><b>1.6.1</b> Maplab Nested Container Map with Struct</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="functions-and-programming.html"><a href="functions-and-programming.html"><i class="fa fa-check"></i><b>2</b> Functions and Programming</a>
<ul>
<li class="chapter" data-level="2.1" data-path="functions-and-programming.html"><a href="functions-and-programming.html#development-and-debugging"><i class="fa fa-check"></i><b>2.1</b> Development and Debugging</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="functions-and-programming.html"><a href="functions-and-programming.html#matlab-error-and-warning-handling"><i class="fa fa-check"></i><b>2.1.1</b> Matlab Error and Warning Handling</a></li>
<li class="chapter" data-level="2.1.2" data-path="functions-and-programming.html"><a href="functions-and-programming.html#matlab-profiler-save-to-html"><i class="fa fa-check"></i><b>2.1.2</b> Matlab Profiler Save to HTML</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="functions-and-programming.html"><a href="functions-and-programming.html#varargin-default-parameters"><i class="fa fa-check"></i><b>2.2</b> varargin Default Parameters</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="functions-and-programming.html"><a href="functions-and-programming.html#varargin-as-a-function-parameter"><i class="fa fa-check"></i><b>2.2.1</b> varargin as a Function Parameter</a></li>
<li class="chapter" data-level="2.2.2" data-path="functions-and-programming.html"><a href="functions-and-programming.html#container-default-parameter-with-varargin"><i class="fa fa-check"></i><b>2.2.2</b> Container Default Parameter with varargin</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="functions-and-programming.html"><a href="functions-and-programming.html#dynamic-functions"><i class="fa fa-check"></i><b>2.3</b> Dynamic Functions</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="functions-and-programming.html"><a href="functions-and-programming.html#anonymous-function-in-matlab"><i class="fa fa-check"></i><b>2.3.1</b> Anonymous Function in Matlab</a></li>
<li class="chapter" data-level="2.3.2" data-path="functions-and-programming.html"><a href="functions-and-programming.html#dynamically-generate-m-files"><i class="fa fa-check"></i><b>2.3.2</b> Dynamically Generate M Files</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="distributional-processes.html"><a href="distributional-processes.html"><i class="fa fa-check"></i><b>3</b> Distributional Processes</a>
<ul>
<li class="chapter" data-level="3.1" data-path="distributional-processes.html"><a href="distributional-processes.html#time-series"><i class="fa fa-check"></i><b>3.1</b> Time Series</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="distributional-processes.html"><a href="distributional-processes.html#simulate-ar1-autoregressive-processes"><i class="fa fa-check"></i><b>3.1.1</b> Simulate AR(1) Autoregressive Processes</a></li>
<li class="chapter" data-level="3.1.2" data-path="distributional-processes.html"><a href="distributional-processes.html#matlab-moving-average-of-time-series"><i class="fa fa-check"></i><b>3.1.2</b> Matlab Moving Average of Time-series</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="distributional-processes.html"><a href="distributional-processes.html#cross-sectional-data"><i class="fa fa-check"></i><b>3.2</b> Cross-sectional Data</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="distributional-processes.html"><a href="distributional-processes.html#matlab-mincer-wage-earnings-equation-with-experience-education-and-gamma-shocks"><i class="fa fa-check"></i><b>3.2.1</b> Matlab Mincer Wage Earnings Equation with Experience, Education and Gamma Shocks</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="simulation.html"><a href="simulation.html"><i class="fa fa-check"></i><b>4</b> Simulation</a>
<ul>
<li class="chapter" data-level="4.1" data-path="simulation.html"><a href="simulation.html#normal-distribution"><i class="fa fa-check"></i><b>4.1</b> Normal Distribution</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="simulation.html"><a href="simulation.html#compute-cdf-for-normal-and-bivariate-normal-distributions"><i class="fa fa-check"></i><b>4.1.1</b> Compute CDF for Normal and Bivariate Normal Distributions</a></li>
<li class="chapter" data-level="4.1.2" data-path="simulation.html"><a href="simulation.html#cholesky-decomposition-correlated-bivariate-normal-from-iid-random-draws"><i class="fa fa-check"></i><b>4.1.2</b> Cholesky Decomposition Correlated Bivariate Normal from IID Random Draws</a></li>
<li class="chapter" data-level="4.1.3" data-path="simulation.html"><a href="simulation.html#cholesky-decomposition-correlated-five-dimensional-multivariate-normal-shock"><i class="fa fa-check"></i><b>4.1.3</b> Cholesky Decomposition Correlated Five Dimensional Multivariate Normal Shock</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="estimation.html"><a href="estimation.html"><i class="fa fa-check"></i><b>5</b> Estimation</a>
<ul>
<li class="chapter" data-level="5.1" data-path="estimation.html"><a href="estimation.html#linear-estimation"><i class="fa fa-check"></i><b>5.1</b> Linear Estimation</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="estimation.html"><a href="estimation.html#linear-ols-regression"><i class="fa fa-check"></i><b>5.1.1</b> Linear OLS Regression</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="estimation.html"><a href="estimation.html#nonlinear-estimation"><i class="fa fa-check"></i><b>5.2</b> Nonlinear Estimation</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="estimation.html"><a href="estimation.html#nonlinear-estimation-with-fminunc"><i class="fa fa-check"></i><b>5.2.1</b> Nonlinear Estimation with Fminunc</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="graphs.html"><a href="graphs.html"><i class="fa fa-check"></i><b>6</b> Graphs</a>
<ul>
<li class="chapter" data-level="6.1" data-path="graphs.html"><a href="graphs.html#figure-components"><i class="fa fa-check"></i><b>6.1</b> Figure Components</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="graphs.html"><a href="graphs.html#matlab-graph-safe-colors-for-web-presentation-and-publications-examples"><i class="fa fa-check"></i><b>6.1.1</b> Matlab Graph Safe Colors for Web, Presentation and Publications Examples</a></li>
<li class="chapter" data-level="6.1.2" data-path="graphs.html"><a href="graphs.html#matlab-graph-titling-labels-and-legends-examples"><i class="fa fa-check"></i><b>6.1.2</b> Matlab Graph Titling, Labels and Legends Examples</a></li>
<li class="chapter" data-level="6.1.3" data-path="graphs.html"><a href="graphs.html#matlab-graph-matrix-with-jet-spectrum-color-label-a-subset-examples"><i class="fa fa-check"></i><b>6.1.3</b> Matlab Graph Matrix with Jet Spectrum Color, Label a Subset Examples</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="graphs.html"><a href="graphs.html#basic-figure-types"><i class="fa fa-check"></i><b>6.2</b> Basic Figure Types</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="graphs.html"><a href="graphs.html#matlab-graph-scatter-plot-examples"><i class="fa fa-check"></i><b>6.2.1</b> Matlab Graph Scatter Plot Examples</a></li>
<li class="chapter" data-level="6.2.2" data-path="graphs.html"><a href="graphs.html#matlab-line-and-scatter-plot-with-multiple-lines-and-axis-lines"><i class="fa fa-check"></i><b>6.2.2</b> Matlab Line and Scatter Plot with Multiple Lines and Axis Lines</a></li>
<li class="chapter" data-level="6.2.3" data-path="graphs.html"><a href="graphs.html#matlab-graph-scatter-and-line-spectrum-with-three-variables"><i class="fa fa-check"></i><b>6.2.3</b> Matlab Graph Scatter and Line Spectrum with Three Variables</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="graphs.html"><a href="graphs.html#graph-functions"><i class="fa fa-check"></i><b>6.3</b> Graph Functions</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="graphs.html"><a href="graphs.html#matlab-graph-one-variable-function"><i class="fa fa-check"></i><b>6.3.1</b> Matlab Graph One Variable Function</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="graphs.html"><a href="graphs.html#write-and-read-plots"><i class="fa fa-check"></i><b>6.4</b> Write and Read Plots</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="graphs.html"><a href="graphs.html#matlab-graph-generate-eps-postscript-figures-in-matlab"><i class="fa fa-check"></i><b>6.4.1</b> Matlab Graph Generate EPS postscript figures in matlab</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="tables.html"><a href="tables.html"><i class="fa fa-check"></i><b>7</b> Tables</a>
<ul>
<li class="chapter" data-level="7.1" data-path="tables.html"><a href="tables.html#basic-table-generation"><i class="fa fa-check"></i><b>7.1</b> Basic Table Generation</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="tables.html"><a href="tables.html#generate-a-table-and-fill-with-data-row-by-row-or-random-data"><i class="fa fa-check"></i><b>7.1.1</b> Generate a Table and Fill with Data Row by Row or Random Data</a></li>
<li class="chapter" data-level="7.1.2" data-path="tables.html"><a href="tables.html#tables-order-sort-add-rename-and-drop-columns"><i class="fa fa-check"></i><b>7.1.2</b> Tables Order, Sort, Add, Rename and Drop Columns</a></li>
<li class="chapter" data-level="7.1.3" data-path="tables.html"><a href="tables.html#row-and-column-names-for-table-based-on-arrays"><i class="fa fa-check"></i><b>7.1.3</b> Row and Column Names for Table based on Arrays</a></li>
<li class="chapter" data-level="7.1.4" data-path="tables.html"><a href="tables.html#select-subset-of-rows-and-columns"><i class="fa fa-check"></i><b>7.1.4</b> Select Subset of Rows and Columns</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="tables.html"><a href="tables.html#table-joining"><i class="fa fa-check"></i><b>7.2</b> Table Joining</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="tables.html"><a href="tables.html#matlab-join-tables-by-keys"><i class="fa fa-check"></i><b>7.2.1</b> Matlab Join Tables by Keys</a></li>
<li class="chapter" data-level="7.2.2" data-path="tables.html"><a href="tables.html#row-and-column-combine-stack-tables-and-matrices"><i class="fa fa-check"></i><b>7.2.2</b> Row and Column Combine Stack Tables and Matrices</a></li>
<li class="chapter" data-level="7.2.3" data-path="tables.html"><a href="tables.html#matlab-table-stack-and-join-estimation-and-simulation-results"><i class="fa fa-check"></i><b>7.2.3</b> Matlab Table Stack and Join Estimation and Simulation Results</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="tables.html"><a href="tables.html#summarize"><i class="fa fa-check"></i><b>7.3</b> Summarize</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="tables.html"><a href="tables.html#matlab-table-summarize-and-aggregate-by-groups"><i class="fa fa-check"></i><b>7.3.1</b> Matlab Table Summarize and Aggregate by Groups</a></li>
</ul></li>
</ul></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="index-and-code-links.html"><a href="index-and-code-links.html"><i class="fa fa-check"></i><b>A</b> Index and Code Links</a>
<ul>
<li class="chapter" data-level="A.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#data-structures-links"><i class="fa fa-check"></i><b>A.1</b> Data Structures links</a>
<ul>
<li class="chapter" data-level="A.1.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-1.1-matrices-and-arraysmatrices-and-arrays-links"><i class="fa fa-check"></i><b>A.1.1</b> <span>Section 1.1 Matrices and Arrays</span> links</a></li>
<li class="chapter" data-level="A.1.2" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-1.2-nd-dimensional-arraysnd-dimensional-arrays-links"><i class="fa fa-check"></i><b>A.1.2</b> <span>Section 1.2 ND Dimensional Arrays</span> links</a></li>
<li class="chapter" data-level="A.1.3" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-1.3-cellscells-links"><i class="fa fa-check"></i><b>A.1.3</b> <span>Section 1.3 Cells</span> links</a></li>
<li class="chapter" data-level="A.1.4" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-1.4-characters-and-stringscharacters-and-strings-links"><i class="fa fa-check"></i><b>A.1.4</b> <span>Section 1.4 Characters and Strings</span> links</a></li>
<li class="chapter" data-level="A.1.5" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-1.5-map-containersmap-containers-links"><i class="fa fa-check"></i><b>A.1.5</b> <span>Section 1.5 Map Containers</span> links</a></li>
<li class="chapter" data-level="A.1.6" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-1.6-map-structure-arraymap-structure-array-links"><i class="fa fa-check"></i><b>A.1.6</b> <span>Section 1.6 Map Structure Array</span> links</a></li>
</ul></li>
<li class="chapter" data-level="A.2" data-path="index-and-code-links.html"><a href="index-and-code-links.html#functions-and-programming-links"><i class="fa fa-check"></i><b>A.2</b> Functions and Programming links</a>
<ul>
<li class="chapter" data-level="A.2.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-2.1-development-and-debuggingdevelopment-and-debugging-links"><i class="fa fa-check"></i><b>A.2.1</b> <span>Section 2.1 Development and Debugging</span> links</a></li>
<li class="chapter" data-level="A.2.2" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-2.2-varargin-default-parametersvarargin-default-parameters-links"><i class="fa fa-check"></i><b>A.2.2</b> <span>Section 2.2 varargin Default Parameters</span> links</a></li>
<li class="chapter" data-level="A.2.3" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-2.3-dynamic-functionsdynamic-functions-links"><i class="fa fa-check"></i><b>A.2.3</b> <span>Section 2.3 Dynamic Functions</span> links</a></li>
</ul></li>
<li class="chapter" data-level="A.3" data-path="index-and-code-links.html"><a href="index-and-code-links.html#distributional-processes-links"><i class="fa fa-check"></i><b>A.3</b> Distributional Processes links</a>
<ul>
<li class="chapter" data-level="A.3.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-3.1-time-seriestime-series-links"><i class="fa fa-check"></i><b>A.3.1</b> <span>Section 3.1 Time Series</span> links</a></li>
<li class="chapter" data-level="A.3.2" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-3.2-cross-sectional-datacross-sectional-data-links"><i class="fa fa-check"></i><b>A.3.2</b> <span>Section 3.2 Cross-sectional Data</span> links</a></li>
</ul></li>
<li class="chapter" data-level="A.4" data-path="index-and-code-links.html"><a href="index-and-code-links.html#simulation-links"><i class="fa fa-check"></i><b>A.4</b> Simulation links</a>
<ul>
<li class="chapter" data-level="A.4.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-4.1-normal-distributionnormal-distribution-links"><i class="fa fa-check"></i><b>A.4.1</b> <span>Section 4.1 Normal Distribution</span> links</a></li>
</ul></li>
<li class="chapter" data-level="A.5" data-path="index-and-code-links.html"><a href="index-and-code-links.html#estimation-links"><i class="fa fa-check"></i><b>A.5</b> Estimation links</a>
<ul>
<li class="chapter" data-level="A.5.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-5.1-linear-estimationlinear-estimation-links"><i class="fa fa-check"></i><b>A.5.1</b> <span>Section 5.1 Linear Estimation</span> links</a></li>
<li class="chapter" data-level="A.5.2" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-5.2-nonlinear-estimationnonlinear-estimation-links"><i class="fa fa-check"></i><b>A.5.2</b> <span>Section 5.2 Nonlinear Estimation</span> links</a></li>
</ul></li>
<li class="chapter" data-level="A.6" data-path="index-and-code-links.html"><a href="index-and-code-links.html#graphs-links"><i class="fa fa-check"></i><b>A.6</b> Graphs links</a>
<ul>
<li class="chapter" data-level="A.6.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-6.1-figure-componentsfigure-components-links"><i class="fa fa-check"></i><b>A.6.1</b> <span>Section 6.1 Figure Components</span> links</a></li>
<li class="chapter" data-level="A.6.2" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-6.2-basic-figure-typesbasic-figure-types-links"><i class="fa fa-check"></i><b>A.6.2</b> <span>Section 6.2 Basic Figure Types</span> links</a></li>
<li class="chapter" data-level="A.6.3" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-6.3-graph-functionsgraph-functions-links"><i class="fa fa-check"></i><b>A.6.3</b> <span>Section 6.3 Graph Functions</span> links</a></li>
<li class="chapter" data-level="A.6.4" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-6.4-write-and-read-plotswrite-and-read-plots-links"><i class="fa fa-check"></i><b>A.6.4</b> <span>Section 6.4 Write and Read Plots</span> links</a></li>
</ul></li>
<li class="chapter" data-level="A.7" data-path="index-and-code-links.html"><a href="index-and-code-links.html#tables-links"><i class="fa fa-check"></i><b>A.7</b> Tables links</a>
<ul>
<li class="chapter" data-level="A.7.1" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-7.1-basic-table-generationbasic-table-generation-links"><i class="fa fa-check"></i><b>A.7.1</b> <span>Section 7.1 Basic Table Generation</span> links</a></li>
<li class="chapter" data-level="A.7.2" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-7.2-table-joiningtable-joining-links"><i class="fa fa-check"></i><b>A.7.2</b> <span>Section 7.2 Table Joining</span> links</a></li>
<li class="chapter" data-level="A.7.3" data-path="index-and-code-links.html"><a href="index-and-code-links.html#section-7.3-summarizesummarize-links"><i class="fa fa-check"></i><b>A.7.3</b> <span>Section 7.3 Summarize</span> links</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://fanwangecon.github.io/M4Econ/bookdown/index.html" target="blank">M4Econ Bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Data Structures and Dynamic Optimization with Matlab</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="tables" class="section level1" number="7">
<h1><span class="header-section-number">Chapter 7</span> Tables</h1>

<div id="basic-table-generation" class="section level2" number="7.1">
<h2><span class="header-section-number">7.1</span> Basic Table Generation</h2>

<div id="generate-a-table-and-fill-with-data-row-by-row-or-random-data" class="section level3" number="7.1.1">
<h3><span class="header-section-number">7.1.1</span> Generate a Table and Fill with Data Row by Row or Random Data</h3>
<blockquote>
<p>Go back to <a href="http://fanwangecon.github.io/">fan</a>’s <a href="https://fanwangecon.github.io/MEconTools/">MEconTools</a> Package, <a href="https://fanwangecon.github.io/M4Econ/">Matlab Code Examples</a> Repository (<a href="https://fanwangecon.github.io/M4Econ/bookdown">bookdown site</a>), or <a href="https://fanwangecon.github.io/Math4Econ/">Math for Econ with Matlab</a> Repository (<a href="https://fanwangecon.github.io/Math4Econ/bookdown">bookdown site</a>).</p>
</blockquote>
<div id="an-empty-table-filled-with-loop-row-by-row" class="section level4" number="7.1.1.1">
<h4><span class="header-section-number">7.1.1.1</span> An Empty Table, Filled with Loop Row by Row</h4>
<p>First, generate <a href="https://www.mathworks.com/matlabcentral/answers/244084-is-there-a-simpler-way-to-create-an-empty-table-with-a-list-of-variablenames#answer_422250">an empty
table</a>.</p>
<pre><code>% Make N by 2 matrix of fieldname + value type
mt_st_variable_names_types = [[&quot;category&quot;, &quot;string&quot;]; ...
    [&quot;wage&quot;, &quot;double&quot;]; ...
    [&quot;skilled&quot;, &quot;logical&quot;]; ...
    [&quot;labdemand&quot;, &quot;double&quot;]; ...
    [&quot;labsupply&quot;, &quot;double&quot;]; ...
    [&quot;labsupplyprob&quot;, &quot;string&quot;]; ...
    [&quot;rho_manual&quot;, &quot;double&quot;]; ...
    [&quot;rho_routine&quot;, &quot;double&quot;]; ...
    [&quot;rho_analytical&quot;, &quot;double&quot;]; ...
    ];
% Make table using fieldnames &amp; value types from above
tb_equilibrium = table(&#39;Size&#39;,[0,size(mt_st_variable_names_types,1)],... 
    &#39;VariableNames&#39;, mt_st_variable_names_types(:,1),...
    &#39;VariableTypes&#39;, mt_st_variable_names_types(:,2));
% display table
disp(size(tb_equilibrium));

     0     9</code></pre>
<p>Second, over a loop, fill the table with values row by row.</p>
<pre><code>for it_rho_set=[1,2,3]
    if (it_rho_set == 1)
        cl_data_row = {&#39;C001&#39;,1,  true,1,1,0.5,0.5,0.5,0.5};
    elseif (it_rho_set == 2)
        cl_data_row = {&#39;C002&#39;,1,  0   ,1.2,0.6,0.5,0.45,0.5,0.5};
    elseif (it_rho_set == 3)
        cl_data_row = {&#39;C011&#39;,1.1,false,1.2,0.6,0.5,0.45,0.45,0.45};
    end
    tb_equilibrium = [tb_equilibrium; cl_data_row];
end
disp(tb_equilibrium);

    category    wage    skilled    labdemand    labsupply    labsupplyprob    rho_manual    rho_routine    rho_analytical
    ________    ____    _______    _________    _________    _____________    __________    ___________    ______________

     &quot;C001&quot;       1        1            1            1           &quot;0.5&quot;            0.5           0.5              0.5     
     &quot;C002&quot;       1        0          1.2          0.6           &quot;0.5&quot;           0.45           0.5              0.5     
     &quot;123&quot;      1.1        0          1.2          0.6           &quot;0.5&quot;           0.45          0.45             0.45     </code></pre>
</div>
<div id="generate-a-table-with-m-variables-of-random-data" class="section level4" number="7.1.1.2">
<h4><span class="header-section-number">7.1.1.2</span> Generate a Table with M Variables of Random Data</h4>
<p>Generate a numeric table with random varlues and a string column</p>
<pre><code>% Numeric Matrix
it_num_cols = 4;
it_num_rows = 5;
mt_data = rand([it_num_rows, it_num_cols]);

% Generate Table
tb_test = array2table(mt_data);

% Generate Row and Column Names
cl_col_names = strcat(&#39;col_&#39;, string((1:it_num_cols)));
cl_row_names = strcat(&#39;row_&#39;, string((1:it_num_rows)));

tb_test.Properties.VariableNames = matlab.lang.makeValidName(cl_col_names);
tb_test.Properties.RowNames = matlab.lang.makeValidName(cl_row_names);

% Generate two string variable
rng(456);
cl_st_var1 = strcat(&#39;data=&#39;, string(rand([it_num_rows,1])));
cl_st_var2 = strcat(&#39;data=&#39;, string(rand([it_num_rows,1])));
tb_test = addvars(tb_test, cl_st_var1, cl_st_var2);

% Display Table
disp(tb_test);

              col_1      col_2       col_3       col_4       cl_st_var1        cl_st_var2  
             _______    _______    _________    _______    ______________    ______________

    row_1    0.43568     0.4688      0.18092    0.14604    &quot;data=0.24876&quot;    &quot;data=0.60411&quot;
    row_2    0.38527       0.57      0.11816    0.54272    &quot;data=0.16307&quot;    &quot;data=0.8857&quot; 
    row_3    0.57571     0.6457      0.24273     0.8571    &quot;data=0.78364&quot;    &quot;data=0.75912&quot;
    row_4    0.14609    0.72334    0.0081834    0.20021    &quot;data=0.80852&quot;    &quot;data=0.18111&quot;
    row_5    0.68659    0.68067      0.36007    0.13463    &quot;data=0.62563&quot;    &quot;data=0.15017&quot;</code></pre>

</div>
</div>
<div id="tables-order-sort-add-rename-and-drop-columns" class="section level3" number="7.1.2">
<h3><span class="header-section-number">7.1.2</span> Tables Order, Sort, Add, Rename and Drop Columns</h3>
<blockquote>
<p>Go back to <a href="http://fanwangecon.github.io/">fan</a>’s <a href="https://fanwangecon.github.io/MEconTools/">MEconTools</a> Package, <a href="https://fanwangecon.github.io/M4Econ/">Matlab Code Examples</a> Repository (<a href="https://fanwangecon.github.io/M4Econ/bookdown">bookdown site</a>), or <a href="https://fanwangecon.github.io/Math4Econ/">Math for Econ with Matlab</a> Repository (<a href="https://fanwangecon.github.io/Math4Econ/bookdown">bookdown site</a>).</p>
</blockquote>
<div id="given-table-show-some-columns-first" class="section level4" number="7.1.2.1">
<h4><span class="header-section-number">7.1.2.1</span> Given Table, Show Some Columns First</h4>
<pre><code>% Generate Table
it_num_cols = 4;
it_num_rows = 5;
mt_data = rand([it_num_rows, it_num_cols]);
tb_test = array2table(mt_data);
cl_col_names = strcat(&#39;col_&#39;, string((1:it_num_cols)));
cl_row_names = strcat(&#39;row_&#39;, string((1:it_num_rows)));
tb_test.Properties.VariableNames = matlab.lang.makeValidName(cl_col_names);
tb_test.Properties.RowNames = matlab.lang.makeValidName(cl_row_names);

rng(123);
mean = strcat(&#39;data=&#39;, string(rand([it_num_rows,1])));
sd = strcat(&#39;data=&#39;, string(rand([it_num_rows,1])));
tb_test_ori = addvars(tb_test, mean, sd);

% Move Variable
tb_test_varmove = movevars(tb_test_ori, {&#39;mean&#39;, &#39;sd&#39;}, &#39;Before&#39;, &#39;col_1&#39;);

% Display
disp(tb_test_ori);

              col_1       col_2      col_3      col_4          mean               sd      
             ________    _______    _______    _______    ______________    ______________

    row_1     0.34318      0.738     0.6344    0.32296    &quot;data=0.69647&quot;    &quot;data=0.42311&quot;
    row_2     0.72905    0.18249    0.84943    0.36179    &quot;data=0.28614&quot;    &quot;data=0.98076&quot;
    row_3     0.43857    0.17545    0.72446    0.22826    &quot;data=0.22685&quot;    &quot;data=0.68483&quot;
    row_4    0.059678    0.53155    0.61102    0.29371    &quot;data=0.55131&quot;    &quot;data=0.48093&quot;
    row_5     0.39804    0.53183    0.72244    0.63098    &quot;data=0.71947&quot;    &quot;data=0.39212&quot;

disp(tb_test_varmove);

                  mean               sd           col_1       col_2      col_3      col_4 
             ______________    ______________    ________    _______    _______    _______

    row_1    &quot;data=0.69647&quot;    &quot;data=0.42311&quot;     0.34318      0.738     0.6344    0.32296
    row_2    &quot;data=0.28614&quot;    &quot;data=0.98076&quot;     0.72905    0.18249    0.84943    0.36179
    row_3    &quot;data=0.22685&quot;    &quot;data=0.68483&quot;     0.43857    0.17545    0.72446    0.22826
    row_4    &quot;data=0.55131&quot;    &quot;data=0.48093&quot;    0.059678    0.53155    0.61102    0.29371
    row_5    &quot;data=0.71947&quot;    &quot;data=0.39212&quot;     0.39804    0.53183    0.72244    0.63098</code></pre>
</div>
<div id="rename-table-columns" class="section level4" number="7.1.2.2">
<h4><span class="header-section-number">7.1.2.2</span> Rename Table Columns</h4>
<p>Rename the first Column, rename the ‘sd’ column, then rename the 3rd and
4th Columns. Note for multiple column renaming, use parenthesis, but for
single column renaming, use bracket.</p>
<pre><code>tb_test_varmove.Properties.VariableNames{1} = &#39;RenameMean&#39;;
tb_test_varmove.Properties.VariableNames{&#39;sd&#39;} = &#39;RenameSDCol&#39;;
tb_test_varmove.Properties.VariableNames([3 4]) = {&#39;3rd&#39; &#39;4th&#39;};
disp(tb_test_varmove);

               RenameMean       RenameSDCol        3rd         4th       col_3      col_4 
             ______________    ______________    ________    _______    _______    _______

    row_1    &quot;data=0.69647&quot;    &quot;data=0.42311&quot;     0.34318      0.738     0.6344    0.32296
    row_2    &quot;data=0.28614&quot;    &quot;data=0.98076&quot;     0.72905    0.18249    0.84943    0.36179
    row_3    &quot;data=0.22685&quot;    &quot;data=0.68483&quot;     0.43857    0.17545    0.72446    0.22826
    row_4    &quot;data=0.55131&quot;    &quot;data=0.48093&quot;    0.059678    0.53155    0.61102    0.29371
    row_5    &quot;data=0.71947&quot;    &quot;data=0.39212&quot;     0.39804    0.53183    0.72244    0.63098</code></pre>
</div>
<div id="remove-table-column" class="section level4" number="7.1.2.3">
<h4><span class="header-section-number">7.1.2.3</span> <code>Remove Table Column</code></h4>
<p><code>Remove columns from the Table</code></p>
<pre><code>tb_test_varmove_drop = removevars(tb_test_varmove, {&#39;3rd&#39;, &#39;col_3&#39;});
disp(tb_test_varmove_drop);

               RenameMean       RenameSDCol        4th       col_4 
             ______________    ______________    _______    _______

    row_1    &quot;data=0.69647&quot;    &quot;data=0.42311&quot;      0.738    0.32296
    row_2    &quot;data=0.28614&quot;    &quot;data=0.98076&quot;    0.18249    0.36179
    row_3    &quot;data=0.22685&quot;    &quot;data=0.68483&quot;    0.17545    0.22826
    row_4    &quot;data=0.55131&quot;    &quot;data=0.48093&quot;    0.53155    0.29371
    row_5    &quot;data=0.71947&quot;    &quot;data=0.39212&quot;    0.53183    0.63098</code></pre>

</div>
</div>
<div id="row-and-column-names-for-table-based-on-arrays" class="section level3" number="7.1.3">
<h3><span class="header-section-number">7.1.3</span> Row and Column Names for Table based on Arrays</h3>
<blockquote>
<p>Go back to <a href="http://fanwangecon.github.io/">fan</a>’s <a href="https://fanwangecon.github.io/MEconTools/">MEconTools</a> Package, <a href="https://fanwangecon.github.io/M4Econ/">Matlab Code Examples</a> Repository (<a href="https://fanwangecon.github.io/M4Econ/bookdown">bookdown site</a>), or <a href="https://fanwangecon.github.io/Math4Econ/">Math for Econ with Matlab</a> Repository (<a href="https://fanwangecon.github.io/Math4Econ/bookdown">bookdown site</a>).</p>
</blockquote>
<div id="generate-table-with-row-and-column-names-based-on-multiple-numeric-array" class="section level4" number="7.1.3.1">
<h4><span class="header-section-number">7.1.3.1</span> Generate Table with Row and Column Names based on Multiple Numeric Array</h4>
<p>Two numeric arrays describe the column names, combine numeric arrays
together to form string array which becomes table variable/column names.</p>
<pre><code>close all;

% Generate Table 1
ar_fl_abc1 = [0.4 0.1 0.25 0.3 0.4];
ar_fl_abc2 = [0.4 0.1 0.2 0.3 0.4];
number1 = &#39;123&#39;;
number2 = &#39;456&#39;;
mt_data_a = [ar_fl_abc1&#39; ar_fl_abc2&#39;];

tb_test_a = array2table(mt_data_a);
cl_col_names_a = {[&#39;col&#39; num2str(number1)], [&#39;col&#39; num2str(number2)]};
cl_row_names_a = strcat(&#39;rowA=&#39;, string((1:size(mt_data_a,1))));

tb_test_a.Properties.VariableNames = cl_col_names_a;
tb_test_a.Properties.RowNames = cl_row_names_a;
disp(tb_test_a);

              col123    col456
              ______    ______

    rowA=1      0.4      0.4  
    rowA=2      0.1      0.1  
    rowA=3     0.25      0.2  
    rowA=4      0.3      0.3  
    rowA=5      0.4      0.4  </code></pre>
</div>
<div id="include-row-names-as-a-a-string-cell-variable" class="section level4" number="7.1.3.2">
<h4><span class="header-section-number">7.1.3.2</span> Include Row Names as a a String Cell Variable</h4>
<pre><code>% a and b must have the same row names
cl_st_varrownames = tb_test_a.Properties.RowNames;
tb_test_a = addvars(tb_test_a, cl_st_varrownames, &#39;Before&#39;, 1);

disp(tb_test_a);

              cl_st_varrownames    col123    col456
              _________________    ______    ______

    rowA=1       {&#39;rowA=1&#39;}          0.4      0.4  
    rowA=2       {&#39;rowA=2&#39;}          0.1      0.1  
    rowA=3       {&#39;rowA=3&#39;}         0.25      0.2  
    rowA=4       {&#39;rowA=4&#39;}          0.3      0.3  
    rowA=5       {&#39;rowA=5&#39;}          0.4      0.4  </code></pre>
</div>
<div id="include-row-names-as-a-string-variable" class="section level4" number="7.1.3.3">
<h4><span class="header-section-number">7.1.3.3</span> Include Row Names as a String Variable</h4>
<pre><code>% a and b must have the same row names
st_varrownames = string(cl_st_varrownames);
tb_test_a = addvars(tb_test_a, st_varrownames, &#39;Before&#39;, 1);
disp(tb_test_a);

              st_varrownames    cl_st_varrownames    col123    col456
              ______________    _________________    ______    ______

    rowA=1       &quot;rowA=1&quot;          {&#39;rowA=1&#39;}          0.4      0.4  
    rowA=2       &quot;rowA=2&quot;          {&#39;rowA=2&#39;}          0.1      0.1  
    rowA=3       &quot;rowA=3&quot;          {&#39;rowA=3&#39;}         0.25      0.2  
    rowA=4       &quot;rowA=4&quot;          {&#39;rowA=4&#39;}          0.3      0.3  
    rowA=5       &quot;rowA=5&quot;          {&#39;rowA=5&#39;}          0.4      0.4  </code></pre>
</div>
<div id="remove-row-names" class="section level4" number="7.1.3.4">
<h4><span class="header-section-number">7.1.3.4</span> Remove Row Names</h4>
<p>Remove row names</p>
<pre><code>tb_test_a.Properties.RowNames = {};
disp(tb_test_a);

    st_varrownames    cl_st_varrownames    col123    col456
    ______________    _________________    ______    ______

       &quot;rowA=1&quot;          {&#39;rowA=1&#39;}          0.4      0.4  
       &quot;rowA=2&quot;          {&#39;rowA=2&#39;}          0.1      0.1  
       &quot;rowA=3&quot;          {&#39;rowA=3&#39;}         0.25      0.2  
       &quot;rowA=4&quot;          {&#39;rowA=4&#39;}          0.3      0.3  
       &quot;rowA=5&quot;          {&#39;rowA=5&#39;}          0.4      0.4  </code></pre>
</div>
<div id="generate-string-based-on-row-values-and-column-names" class="section level4" number="7.1.3.5">
<h4><span class="header-section-number">7.1.3.5</span> Generate String Based on Row Values and Column Names</h4>
<p>Suppose we are looping over meshed grid of parameter values, want to
generate a KEY that is based on three of the parameters, but not the
remaining parameter. One strategy is to use the current values of the
three parameters, combine them with the string column names, and
concatenate together. This generate a string key.</p>
<pre><code>cl_ar_identifier = cell([size(tb_test_a,1), 1]);
for esti_row_idx=1:size(tb_test_a,1)
    
    % Get the current row, 3rd and 4th columns
    ar_fl_colvals = tb_test_a{esti_row_idx,[3,4]};
    ar_st_colnames = tb_test_a.Properties.VariableNames([3,4]);
    ar_st_colvals = cellfun(@(x) strtrim(x), cellstr(num2str(ar_fl_colvals&#39;)), &#39;UniformOutput&#39;, false);
    ar_st_identifier = strcat(ar_st_colnames&#39;, &#39;=&#39;, ar_st_colvals);
    esti_identifier = strjoin(ar_st_identifier, &quot;#&quot;);
    
    % add to cell
    cl_ar_identifier{esti_row_idx} = esti_identifier;
end
% this is a group identifier
ar_st_identifier = string(cl_ar_identifier);
tb_test_a = addvars(tb_test_a, cl_ar_identifier, &#39;Before&#39;, 1);
tb_test_a = addvars(tb_test_a, ar_st_identifier, &#39;Before&#39;, 1);
disp(tb_test_a);

        ar_st_identifier             cl_ar_identifier         st_varrownames    cl_st_varrownames    col123    col456
    ________________________    __________________________    ______________    _________________    ______    ______

    &quot;col123=0.4#col456=0.4&quot;     {&#39;col123=0.4#col456=0.4&#39; }       &quot;rowA=1&quot;          {&#39;rowA=1&#39;}          0.4      0.4  
    &quot;col123=0.1#col456=0.1&quot;     {&#39;col123=0.1#col456=0.1&#39; }       &quot;rowA=2&quot;          {&#39;rowA=2&#39;}          0.1      0.1  
    &quot;col123=0.25#col456=0.2&quot;    {&#39;col123=0.25#col456=0.2&#39;}       &quot;rowA=3&quot;          {&#39;rowA=3&#39;}         0.25      0.2  
    &quot;col123=0.3#col456=0.3&quot;     {&#39;col123=0.3#col456=0.3&#39; }       &quot;rowA=4&quot;          {&#39;rowA=4&#39;}          0.3      0.3  
    &quot;col123=0.4#col456=0.4&quot;     {&#39;col123=0.4#col456=0.4&#39; }       &quot;rowA=5&quot;          {&#39;rowA=5&#39;}          0.4      0.4  </code></pre>

</div>
</div>
<div id="select-subset-of-rows-and-columns" class="section level3" number="7.1.4">
<h3><span class="header-section-number">7.1.4</span> Select Subset of Rows and Columns</h3>
<blockquote>
<p>Go back to <a href="http://fanwangecon.github.io/">fan</a>’s <a href="https://fanwangecon.github.io/MEconTools/">MEconTools</a> Package, <a href="https://fanwangecon.github.io/M4Econ/">Matlab Code Examples</a> Repository (<a href="https://fanwangecon.github.io/M4Econ/bookdown">bookdown site</a>), or <a href="https://fanwangecon.github.io/Math4Econ/">Math for Econ with Matlab</a> Repository (<a href="https://fanwangecon.github.io/Math4Econ/bookdown">bookdown site</a>).</p>
</blockquote>
<div id="generate-a-table" class="section level4" number="7.1.4.1">
<h4><span class="header-section-number">7.1.4.1</span> Generate a Table</h4>
<pre><code>close all;
% Generate Table 1
ar_fl_abc1 = [0.4 0.1 0.25 0.3 0.4 1 1.1];
ar_fl_abc2 = [0.4 0.1 0.2 0.3 0.4  2 2.2];
number1 = &#39;123&#39;;
number2 = &#39;456&#39;;
mt_data_a = [ar_fl_abc1&#39; ar_fl_abc2&#39;];
tb_test_a = array2table(mt_data_a);
cl_col_names_a = {[&#39;col&#39; num2str(number1)], [&#39;col&#39; num2str(number2)]};
cl_row_names_a = strcat(&#39;rowA=&#39;, string((1:size(mt_data_a,1))));
tb_test_a.Properties.VariableNames = cl_col_names_a;
tb_test_a.Properties.RowNames = cl_row_names_a;
% a and b must have the same row names
cl_st_varrownames = tb_test_a.Properties.RowNames;
tb_test_a = addvars(tb_test_a, cl_st_varrownames, &#39;Before&#39;, 1);
% a and b must have the same row names
st_varrownames = string(cl_st_varrownames);
tb_test_a = addvars(tb_test_a, st_varrownames, &#39;Before&#39;, 1);
tb_test_a = addvars(tb_test_a, [&quot;a&quot;, &quot;b&quot;, &quot;cc&quot;, &quot;aa&quot;, &quot;b&quot;, &quot;z&quot;, &quot;zz&quot;]&#39;, &#39;Before&#39;, 1);
disp(tb_test_a);

              Var1    st_varrownames    cl_st_varrownames    col123    col456
              ____    ______________    _________________    ______    ______

    rowA=1    &quot;a&quot;        &quot;rowA=1&quot;          {&#39;rowA=1&#39;}          0.4      0.4  
    rowA=2    &quot;b&quot;        &quot;rowA=2&quot;          {&#39;rowA=2&#39;}          0.1      0.1  
    rowA=3    &quot;cc&quot;       &quot;rowA=3&quot;          {&#39;rowA=3&#39;}         0.25      0.2  
    rowA=4    &quot;aa&quot;       &quot;rowA=4&quot;          {&#39;rowA=4&#39;}          0.3      0.3  
    rowA=5    &quot;b&quot;        &quot;rowA=5&quot;          {&#39;rowA=5&#39;}          0.4      0.4  
    rowA=6    &quot;z&quot;        &quot;rowA=6&quot;          {&#39;rowA=6&#39;}            1        2  
    rowA=7    &quot;zz&quot;       &quot;rowA=7&quot;          {&#39;rowA=7&#39;}          1.1      2.2  </code></pre>
</div>
<div id="select-rows-if-colx-is-equal-to-something" class="section level4" number="7.1.4.2">
<h4><span class="header-section-number">7.1.4.2</span> Select Rows if ColX is Equal to Something</h4>
<p>Select a subset of rows based on the variable value in one column</p>
<pre><code>% select the rows where Var1=&quot;b&quot;
disp(tb_test_a(strcmp(tb_test_a.Var1, &quot;b&quot;),:));

              Var1    st_varrownames    cl_st_varrownames    col123    col456
              ____    ______________    _________________    ______    ______

    rowA=2    &quot;b&quot;        &quot;rowA=2&quot;          {&#39;rowA=2&#39;}         0.1       0.1  
    rowA=5    &quot;b&quot;        &quot;rowA=5&quot;          {&#39;rowA=5&#39;}         0.4       0.4  

% select the rows where col123=0.4
disp(tb_test_a(tb_test_a.col123==0.4,:));

              Var1    st_varrownames    cl_st_varrownames    col123    col456
              ____    ______________    _________________    ______    ______

    rowA=1    &quot;a&quot;        &quot;rowA=1&quot;          {&#39;rowA=1&#39;}         0.4       0.4  
    rowA=5    &quot;b&quot;        &quot;rowA=5&quot;          {&#39;rowA=5&#39;}         0.4       0.4  </code></pre>
</div>
<div id="select-rows-if-colx-is-equal-to-something-or-something-else" class="section level4" number="7.1.4.3">
<h4><span class="header-section-number">7.1.4.3</span> Select Rows if ColX is Equal to Something or Something else</h4>
<p>Select if the value in Var1 is either the string a or the string b,
below, specify these explicitly</p>
<pre><code>% select the rows where Var1=&quot;b&quot; or Var1=&quot;a&quot;
disp(tb_test_a(strcmp(tb_test_a.Var1, &quot;b&quot;) | strcmp(tb_test_a.Var1, &quot;a&quot;),:));

              Var1    st_varrownames    cl_st_varrownames    col123    col456
              ____    ______________    _________________    ______    ______

    rowA=1    &quot;a&quot;        &quot;rowA=1&quot;          {&#39;rowA=1&#39;}         0.4       0.4  
    rowA=2    &quot;b&quot;        &quot;rowA=2&quot;          {&#39;rowA=2&#39;}         0.1       0.1  
    rowA=5    &quot;b&quot;        &quot;rowA=5&quot;          {&#39;rowA=5&#39;}         0.4       0.4  </code></pre>
<p>Alternatively, use
<a href="https://www.mathworks.com/help/matlab/ref/matches.html">matches</a>, to
find if the variable is equal to either a or b, the list of potential
match is a string array.</p>
<pre><code>% Using matches
ar_st_potential_matches = [&quot;a&quot;, &quot;b&quot;];
disp(tb_test_a(matches(tb_test_a.Var1, ar_st_potential_matches),:));

              Var1    st_varrownames    cl_st_varrownames    col123    col456
              ____    ______________    _________________    ______    ______

    rowA=1    &quot;a&quot;        &quot;rowA=1&quot;          {&#39;rowA=1&#39;}         0.4       0.4  
    rowA=2    &quot;b&quot;        &quot;rowA=2&quot;          {&#39;rowA=2&#39;}         0.1       0.1  
    rowA=5    &quot;b&quot;        &quot;rowA=5&quot;          {&#39;rowA=5&#39;}         0.4       0.4  </code></pre>
<p>Now match over any a to z letters, picking up any letters a to z if they
appear in column Var1.</p>
<pre><code>% Using matches
ar_st_match_atz = string((&#39;a&#39;:&#39;z&#39;)&#39;)&#39;;
disp(tb_test_a(matches(tb_test_a.Var1, ar_st_match_atz),:));

              Var1    st_varrownames    cl_st_varrownames    col123    col456
              ____    ______________    _________________    ______    ______

    rowA=1    &quot;a&quot;        &quot;rowA=1&quot;          {&#39;rowA=1&#39;}         0.4       0.4  
    rowA=2    &quot;b&quot;        &quot;rowA=2&quot;          {&#39;rowA=2&#39;}         0.1       0.1  
    rowA=5    &quot;b&quot;        &quot;rowA=5&quot;          {&#39;rowA=5&#39;}         0.4       0.4  
    rowA=6    &quot;z&quot;        &quot;rowA=6&quot;          {&#39;rowA=6&#39;}           1         2  </code></pre>
</div>
<div id="read-in-a-table-from-an-excel-file" class="section level4" number="7.1.4.4">
<h4><span class="header-section-number">7.1.4.4</span> Read in a Table from an Excel File</h4>
<p>There are estimates stored in a table. Each row is a different
estimation result, with a different set of estimates, for each row some
fixed (not-estimated) parameter might vary. Each column represents a
different parameter, or the parameter’s state (initial value, estimated
value, standard error, etc).</p>
<p>The estimatetion results file is stored in:
M4Econ\table\_exa\excel_exa.xlsx. We want to load in this file.
Directory is one root up and one root down. The file has multiple
sheets, automatically loads in the first sheet. And print table
variables names, column names.</p>
<pre><code>srn_excel_exa = &#39;C:\Users\fan\M4Econ\table\_exa\excel_exa.xlsx&#39;;
tb_read = readtable(srn_excel_exa);
disp((tb_read.Properties.VariableNames)&#39;);

    {&#39;estimodelctr&#39;       }
    {&#39;Var1&#39;               }
    {&#39;FVAL&#39;               }
    {&#39;EXITFLAG&#39;           }
    {&#39;esti_iterations&#39;    }
    {&#39;esti_funccount&#39;     }
    {&#39;mean_h_sd&#39;          }
    {&#39;NPquad_esti&#39;        }
    {&#39;NPquad_se&#39;          }
    {&#39;NPquad_actl&#39;        }
    {&#39;gamma_esti&#39;         }
    {&#39;gamma_se&#39;           }
    {&#39;gamma_actl&#39;         }
    {&#39;lambda_esti&#39;        }
    {&#39;lambda_se&#39;          }
    {&#39;lambda_actl&#39;        }
    {&#39;msrErrProtSD_esti&#39;  }
    {&#39;msrErrProtSD_se&#39;    }
    {&#39;msrErrProtSD_actl&#39;  }
    {&#39;freePriceFrac_esti&#39; }
    {&#39;freePriceFrac_se&#39;   }
    {&#39;freePriceFrac_actl&#39; }
    {&#39;h_exoshk_sd_esti&#39;   }
    {&#39;h_exoshk_sd_se&#39;     }
    {&#39;h_exoshk_sd_actl&#39;   }
    {&#39;h_endoshk_sd_esti&#39;  }
    {&#39;h_endoshk_sd_se&#39;    }
    {&#39;h_endoshk_sd_actl&#39;  }
    {&#39;parm_sk_mean_init&#39;  }
    {&#39;parm_sk_sd_init&#39;    }
    {&#39;NPquad_init&#39;        }
    {&#39;gamma_init&#39;         }
    {&#39;HAquad_init&#39;        }
    {&#39;theta_init&#39;         }
    {&#39;lambda_init&#39;        }
    {&#39;msrErrProtSD_init&#39;  }
    {&#39;logProt_init&#39;       }
    {&#39;freePriceFrac_init&#39; }
    {&#39;h_exoshk_sd_init&#39;   }
    {&#39;h_endoshk_sd_init&#39;  }
    {&#39;prod_hgt0_coef_init&#39;}
    {&#39;prod_prot_coef_init&#39;}
    {&#39;prod_cons_coef_init&#39;}
    {&#39;prod_male_coef_init&#39;}
    {&#39;prod_wgt0_coef_init&#39;}
    {&#39;endoshkCount&#39;       }
    {&#39;guasshermite&#39;       }
    {&#39;len_curEstiParam&#39;   }
    {&#39;fixedVarIndex&#39;      }
    {&#39;esti_method&#39;        }
    {&#39;esti_option_type&#39;   }
    {&#39;subset_iter_rounds&#39; }
    {&#39;lambda_frac_disc&#39;   }</code></pre>
</div>
<div id="select-table-columns-based-on-column-name-strings" class="section level4" number="7.1.4.5">
<h4><span class="header-section-number">7.1.4.5</span> Select Table Columns based on Column Name Strings</h4>
<p>Given the table that we loaded in above, select only the columns that
start with some string like "gamma", or columns that end with certain
strings, like "_esti".</p>
<p>The
<a href="https://www.mathworks.com/help/matlab/ref/startswith.html">startsWith</a>,
<a href="https://www.mathworks.com/help/matlab/ref/contains.html">contains</a>, and
<a href="https://www.mathworks.com/help/matlab/ref/endswith.html">endsWith</a> are
string functions that generate logical arrays based on which elements of
the tring array satisfies the criteria. So this is not a table function,
it is a string function.</p>
<pre><code>ar_st_col_names = tb_read.Properties.VariableNames;
ar_st_col_names_prod = ar_st_col_names(startsWith(ar_st_col_names, &#39;prod_&#39;));
ar_st_col_names_esti = ar_st_col_names(endsWith(ar_st_col_names, &#39;_esti&#39;));
ar_st_col_names_sd = ar_st_col_names(contains(ar_st_col_names, &#39;_sd_&#39;));
disp(ar_st_col_names_prod&#39;);

    {&#39;prod_hgt0_coef_init&#39;}
    {&#39;prod_prot_coef_init&#39;}
    {&#39;prod_cons_coef_init&#39;}
    {&#39;prod_male_coef_init&#39;}
    {&#39;prod_wgt0_coef_init&#39;}

disp(ar_st_col_names_esti&#39;);

    {&#39;NPquad_esti&#39;       }
    {&#39;gamma_esti&#39;        }
    {&#39;lambda_esti&#39;       }
    {&#39;msrErrProtSD_esti&#39; }
    {&#39;freePriceFrac_esti&#39;}
    {&#39;h_exoshk_sd_esti&#39;  }
    {&#39;h_endoshk_sd_esti&#39; }

disp(ar_st_col_names_sd&#39;);

    {&#39;h_exoshk_sd_esti&#39; }
    {&#39;h_exoshk_sd_se&#39;   }
    {&#39;h_exoshk_sd_actl&#39; }
    {&#39;h_endoshk_sd_esti&#39;}
    {&#39;h_endoshk_sd_se&#39;  }
    {&#39;h_endoshk_sd_actl&#39;}
    {&#39;parm_sk_sd_init&#39;  }
    {&#39;h_exoshk_sd_init&#39; }
    {&#39;h_endoshk_sd_init&#39;}</code></pre>
<p>We can select columns that contain the string <em>sd</em> as well as <em>actl</em> in
them, by considering joint conditions.</p>
<pre><code>ar_it_select = contains(ar_st_col_names, &#39;_sd_&#39;).*endsWith(ar_st_col_names, &#39;_actl&#39;);
ar_st_col_names_selected = ar_st_col_names(ar_it_select==1);
disp(ar_st_col_names_selected&#39;);

    {&#39;h_exoshk_sd_actl&#39; }
    {&#39;h_endoshk_sd_actl&#39;}

% show values from selected columns
disp(tb_read(1:10, ar_st_col_names_selected));

    h_exoshk_sd_actl    h_endoshk_sd_actl
    ________________    _________________

        0.042154             0.012103    
        0.042514             0.011849    
        0.042571             0.011352    
         0.04263             0.010598    
        0.042662            0.0089398    
        0.042664            0.0088495    
        0.042638            0.0078152    
        0.042689            0.0027549    
        0.042692            0.0024652    
        0.042625             0.002309    </code></pre>

</div>
</div>
</div>
<div id="table-joining" class="section level2" number="7.2">
<h2><span class="header-section-number">7.2</span> Table Joining</h2>

<div id="matlab-join-tables-by-keys" class="section level3" number="7.2.1">
<h3><span class="header-section-number">7.2.1</span> Matlab Join Tables by Keys</h3>
<blockquote>
<p>Go back to <a href="http://fanwangecon.github.io/">fan</a>’s <a href="https://fanwangecon.github.io/MEconTools/">MEconTools</a> Package, <a href="https://fanwangecon.github.io/M4Econ/">Matlab Code Examples</a> Repository (<a href="https://fanwangecon.github.io/M4Econ/bookdown">bookdown site</a>), or <a href="https://fanwangecon.github.io/Math4Econ/">Math for Econ with Matlab</a> Repository (<a href="https://fanwangecon.github.io/Math4Econ/bookdown">bookdown site</a>).</p>
</blockquote>
<div id="left-join-two-tables-together" class="section level4" number="7.2.1.1">
<h4><span class="header-section-number">7.2.1.1</span> Left Join Two Tables Together</h4>
<p>There is a table with simulation results, and a table with data
information. Join together with common keys.</p>
<p>First generate the simulation table.</p>
<pre><code>% Make N by 2 matrix of fieldname + value type
mt_st_variable_names_types = [...
    [&quot;year&quot;, &quot;double&quot;];[&quot;category&quot;, &quot;string&quot;];[&quot;rho&quot;, &quot;double&quot;]; ...
    [&quot;numberWorkersSimu&quot;, &quot;logical&quot;]; [&quot;meanWageSimu&quot;, &quot;double&quot;]];
% Make table using fieldnames &amp; value types from above
tb_solution = table(&#39;Size&#39;,[0,size(mt_st_variable_names_types,1)],... 
    &#39;VariableNames&#39;, mt_st_variable_names_types(:,1),...
    &#39;VariableTypes&#39;, mt_st_variable_names_types(:,2));
% Table with data to be merged
tb_solution = [tb_solution;...
    {1, &#39;C001&#39;, 0.50, 5.5, 6.6}; {2, &#39;C002&#39;, 0.50, 3.3, 4.4}; ...
    {1, &#39;C001&#39;, 0.25, 2.5, 3.6}; {2, &#39;C002&#39;, 0.25, 0.3, 1.4}];
disp(tb_solution);

    year    category    rho     numberWorkersSimu    meanWageSimu
    ____    ________    ____    _________________    ____________

     1       &quot;C001&quot;      0.5           5.5               6.6     
     2       &quot;C002&quot;      0.5           3.3               4.4     
     1       &quot;C001&quot;     0.25           2.5               3.6     
     2       &quot;C002&quot;     0.25           0.3               1.4     </code></pre>
<p>Second generate the data table.</p>
<pre><code>% Make N by 2 matrix of fieldname + value type
mt_st_variable_names_types = [...
    [&quot;year&quot;, &quot;double&quot;];[&quot;category&quot;, &quot;string&quot;]; ...
    [&quot;numberWorkersData&quot;, &quot;logical&quot;]; [&quot;meanWageData&quot;, &quot;double&quot;]];
% Make table using fieldnames &amp; value types from above
tb_data = table(&#39;Size&#39;,[0,size(mt_st_variable_names_types,1)],... 
    &#39;VariableNames&#39;, mt_st_variable_names_types(:,1),...
    &#39;VariableTypes&#39;, mt_st_variable_names_types(:,2));
% Table with data to be merged
tb_data = [tb_data; {1, &#39;C001&#39;, 1, 2}; {2, &#39;C002&#39;, 2, 3}];
disp(tb_data);

    year    category    numberWorkersData    meanWageData
    ____    ________    _________________    ____________

     1       &quot;C001&quot;             1                 2      
     2       &quot;C002&quot;             2                 3      </code></pre>
<p>Third merge the tables together with left-join, that will match by all
variables with the same name.</p>
<pre><code>% left-join tables together
tb_solu_joined_data = join(tb_solution, tb_data);
% Rescale a variable
tb_solu_joined_data{:, &quot;numberWorkersData&quot;} = tb_solu_joined_data{:, &quot;numberWorkersData&quot;}*10;
% Display
disp(tb_solu_joined_data);

    year    category    rho     numberWorkersSimu    meanWageSimu    numberWorkersData    meanWageData
    ____    ________    ____    _________________    ____________    _________________    ____________

     1       &quot;C001&quot;      0.5           5.5               6.6                10                 2      
     2       &quot;C002&quot;      0.5           3.3               4.4                20                 3      
     1       &quot;C001&quot;     0.25           2.5               3.6                10                 2      
     2       &quot;C002&quot;     0.25           0.3               1.4                20                 3      </code></pre>

</div>
</div>
<div id="row-and-column-combine-stack-tables-and-matrices" class="section level3" number="7.2.2">
<h3><span class="header-section-number">7.2.2</span> Row and Column Combine Stack Tables and Matrices</h3>
<blockquote>
<p>Go back to <a href="http://fanwangecon.github.io/">fan</a>’s <a href="https://fanwangecon.github.io/MEconTools/">MEconTools</a> Package, <a href="https://fanwangecon.github.io/M4Econ/">Matlab Code Examples</a> Repository (<a href="https://fanwangecon.github.io/M4Econ/bookdown">bookdown site</a>), or <a href="https://fanwangecon.github.io/Math4Econ/">Math for Econ with Matlab</a> Repository (<a href="https://fanwangecon.github.io/Math4Econ/bookdown">bookdown site</a>).</p>
</blockquote>
<div id="generate-some-tables-and-matrixes-for-combination" class="section level4" number="7.2.2.1">
<h4><span class="header-section-number">7.2.2.1</span> Generate Some Tables and Matrixes for Combination</h4>
<pre><code>close all;

% Generate Table 1
ar_fl_abc1 = [0.4 0.1 0.25 0.3 0.4];
ar_fl_abc2 = [0.4 0.1 0.2 0.3 0.4];
number1 = &#39;123&#39;;
number2 = &#39;456&#39;;
mt_data_a = [ar_fl_abc1&#39; ar_fl_abc2&#39;];

tb_test_a = array2table(mt_data_a);
cl_col_names_a = {[&#39;col&#39; num2str(number1)], [&#39;col&#39; num2str(number2)]};
cl_row_names_a = strcat(&#39;rowA=&#39;, string((1:size(mt_data_a,1))));

tb_test_a.Properties.VariableNames = cl_col_names_a;
tb_test_a.Properties.RowNames = cl_row_names_a;
disp(tb_test_a);

              col123    col456
              ______    ______

    rowA=1      0.4      0.4  
    rowA=2      0.1      0.1  
    rowA=3     0.25      0.2  
    rowA=4      0.3      0.3  
    rowA=5      0.4      0.4  

% Generate Table 2
rng(123);
ar_fl_abc3 = rand(size(ar_fl_abc1));
ar_fl_abc4 = rand(size(ar_fl_abc1));
ar_fl_abc5 = rand(size(ar_fl_abc1));

mt_data_b = [ar_fl_abc3&#39; ar_fl_abc4&#39; ar_fl_abc5&#39;];

tb_test_b = array2table(mt_data_b);
cl_col_names_b = {[&#39;col&#39; num2str(33)], [&#39;col&#39; num2str(44)], [&#39;col&#39; num2str(55)]};
cl_row_names_b = strcat(&#39;rowB=&#39;, string((1:size(mt_data_a,1))));

tb_test_b.Properties.VariableNames = cl_col_names_b;
tb_test_b.Properties.RowNames = cl_row_names_b;
disp(tb_test_b);

               col33      col44      col55  
              _______    _______    ________

    rowB=1    0.69647    0.42311     0.34318
    rowB=2    0.28614    0.98076     0.72905
    rowB=3    0.22685    0.68483     0.43857
    rowB=4    0.55131    0.48093    0.059678
    rowB=5    0.71947    0.39212     0.39804</code></pre>
</div>
<div id="combine-tables-together-stack-columns" class="section level4" number="7.2.2.2">
<h4><span class="header-section-number">7.2.2.2</span> Combine Tables Together Stack Columns</h4>
<p>Tables with the same number of rows, add more columns with named
variables</p>
<pre><code>% a and b must have the same row names
tb_test_b_withArownames = tb_test_b;
tb_test_b_withArownames.Properties.RowNames = tb_test_a.Properties.RowNames;
tb_ab_col_stacked = [tb_test_a tb_test_b_withArownames];
disp(tb_ab_col_stacked);

              col123    col456     col33      col44      col55  
              ______    ______    _______    _______    ________

    rowA=1      0.4      0.4      0.69647    0.42311     0.34318
    rowA=2      0.1      0.1      0.28614    0.98076     0.72905
    rowA=3     0.25      0.2      0.22685    0.68483     0.43857
    rowA=4      0.3      0.3      0.55131    0.48093    0.059678
    rowA=5      0.4      0.4      0.71947    0.39212     0.39804</code></pre>
</div>
<div id="combine-tables-together-stack-rows" class="section level4" number="7.2.2.3">
<h4><span class="header-section-number">7.2.2.3</span> Combine Tables Together Stack Rows</h4>
<p>Tables with the same number of columns, dd more rows variables</p>
<pre><code>% Select only 2 columns to match table a column count
tb_test_b_subset = tb_test_b(:,1:2);

% Make Column Names consistent
tb_test_b_subset.Properties.VariableNames = cl_col_names_a;

% Reset Row Names, can not have identical row names
tb_test_a.Properties.RowNames = strcat(&#39;row=&#39;, string((1:size(mt_data_a,1))));
tb_test_b_subset.Properties.RowNames = ...
    strcat(&#39;row=&#39;, string(((size(mt_data_a,1)+1):(size(mt_data_a,1)+size(tb_test_b_subset,1)))));
% tb_test_b_subset.Properties.RowNames =

% Stack Rows
tb_ab_row_stacked = [tb_test_a; tb_test_b_subset];
disp(tb_ab_row_stacked);

              col123     col456 
              _______    _______

    row=1         0.4        0.4
    row=2         0.1        0.1
    row=3        0.25        0.2
    row=4         0.3        0.3
    row=5         0.4        0.4
    row=6     0.69647    0.42311
    row=7     0.28614    0.98076
    row=8     0.22685    0.68483
    row=9     0.55131    0.48093
    row=10    0.71947    0.39212</code></pre>

</div>
</div>
<div id="matlab-table-stack-and-join-estimation-and-simulation-results" class="section level3" number="7.2.3">
<h3><span class="header-section-number">7.2.3</span> Matlab Table Stack and Join Estimation and Simulation Results</h3>
<blockquote>
<p>Go back to <a href="http://fanwangecon.github.io/">fan</a>’s <a href="https://fanwangecon.github.io/MEconTools/">MEconTools</a> Package, <a href="https://fanwangecon.github.io/M4Econ/">Matlab Code Examples</a> Repository (<a href="https://fanwangecon.github.io/M4Econ/bookdown">bookdown site</a>), or <a href="https://fanwangecon.github.io/Math4Econ/">Math for Econ with Matlab</a> Repository (<a href="https://fanwangecon.github.io/Math4Econ/bookdown">bookdown site</a>).</p>
</blockquote>
<div id="combine-tables-together-stack-rows-loop-template-common-columns" class="section level4" number="7.2.3.1">
<h4><span class="header-section-number">7.2.3.1</span> Combine Tables Together Stack Rows Loop Template Common Columns</h4>
<p>There is an estimation routine, each time the routine outputs a table
with a single row, the single row contains estimation outputs including
estiamtes, standard erros, initial parameters etc. We loop over
different estimation routines, with different starting values etc, and
rather than saving many tables, we want to save a joint table with all
rows stacked together.</p>
<p>This simply means that we have a loop, during each iteration, generating
a table, we want to stack things together. For this assume that the
column names are the same.</p>
<pre><code>rng(&quot;default&quot;);
tb_saveCoef_stack = [];
for row_idx=1:5
    % a row of coefficent estimates    
    rng(123+row_idx);
    it_num_cols = 4;
    it_num_rows = 1;
    mt_saveCoef = rand([it_num_rows, it_num_cols]);
    
    % row to table
    ar_st_col_names = [&quot;FVAL&quot;, &quot;EXITFLAG&quot;, &quot;esti_iterations&quot;, &quot;esti_funccount&quot;];        
    tb_saveCoef = array2table(mt_saveCoef);
    tb_saveCoef.Properties.VariableNames = ar_st_col_names;
    
    % Stack all results
    tb_saveCoef_stack = [tb_saveCoef_stack; tb_saveCoef];
end
% Add esti Counter as column
estimodelctr = (1:size(tb_saveCoef_stack,1))&#39;;
tb_saveCoef_stack = addvars(tb_saveCoef_stack, estimodelctr, &#39;Before&#39;, 1);
% Add a row name as a variable
cl_row_names_a = strcat(&#39;esti&#39;, string((1:size(tb_saveCoef_stack,1))));
tb_saveCoef_stack.Properties.RowNames = cl_row_names_a;
% display results
disp(tb_saveCoef_stack);

             estimodelctr     FVAL      EXITFLAG    esti_iterations    esti_funccount
             ____________    _______    ________    _______________    ______________

    esti1         1          0.10606     0.74547        0.57231            0.45824   
    esti2         2          0.50673    0.057531        0.62758            0.13255   
    esti3         3          0.10517     0.12814       0.087406            0.11548   
    esti4         4          0.52383    0.039963        0.18597            0.77279   
    esti5         5          0.86664     0.26314        0.13141           0.041593   </code></pre>
</div>
<div id="combine-tables-together-stack-rows-loop-template-outterjoin" class="section level4" number="7.2.3.2">
<h4><span class="header-section-number">7.2.3.2</span> Combine Tables Together Stack Rows Loop Template Outterjoin</h4>
<p>Similar to the previous estimation problem, however, now during
different iterations, the column names, i.e. the parameters been
estiamted are different. For example, there are 10 parameters, sometimes
we estimate 5 of the 10, sometimes 10 or the 10. Want to stack all
results together similar to above.</p>
<p>This is accomplished in the following example with the <a href="https://www.mathworks.com/help/matlab/ref/outerjoin.html">outerjoin
function</a>.</p>
<pre><code>for row_idx=1:5
    % a row of coefficent estimates
    rng(123+row_idx);
    
    it_num_rows = 1;
    if (row_idx &lt;= 2) 
        it_num_cols = 4;
        mt_saveCoef = rand([it_num_rows, it_num_cols]);    
        % row to table    
        ar_st_col_names = [&quot;FVAL&quot;, &quot;EXITFLAG&quot;, &quot;esti_iterations&quot;, &quot;esti_funccount&quot;];
    elseif (row_idx &lt;= 4) 
        it_num_cols = 2;
        mt_saveCoef = rand([it_num_rows, it_num_cols]);
        % row to table    
        ar_st_col_names = [&quot;FVAL&quot;, &quot;EXITFLAG&quot;];
    else
        it_num_cols = 3;
        mt_saveCoef = rand([it_num_rows, it_num_cols]);
        % row to table    
        ar_st_col_names = [&quot;FVAL&quot;, &quot;esti_iterations&quot;, &quot;esti_funccount&quot;];
    end
    
    tb_saveCoef = array2table(mt_saveCoef);
    tb_saveCoef.Properties.VariableNames = ar_st_col_names;
    tb_saveCoef = addvars(tb_saveCoef, row_idx, &#39;Before&#39;, 1);
    
    % Stack all results
    if(row_idx == 1)
        tb_saveCoef_stack = tb_saveCoef;
    else
        tb_saveCoef_stack = outerjoin(tb_saveCoef_stack, tb_saveCoef, &#39;MergeKeys&#39;, true);
    end
end
% Add esti Counter as column
estimodelctr = (1:size(tb_saveCoef_stack,1))&#39;;
tb_saveCoef_stack = addvars(tb_saveCoef_stack, estimodelctr, &#39;Before&#39;, 1);
% Add a row name as a variable
cl_row_names_a = strcat(&#39;esti&#39;, string((1:size(tb_saveCoef_stack,1))));
tb_saveCoef_stack.Properties.RowNames = cl_row_names_a;
% display results
disp(tb_saveCoef_stack);

             estimodelctr    row_idx     FVAL      EXITFLAG    esti_iterations    esti_funccount
             ____________    _______    _______    ________    _______________    ______________

    esti1         1             1       0.10606     0.74547        0.57231           0.45824    
    esti2         2             2       0.50673    0.057531        0.62758           0.13255    
    esti3         3             3       0.10517     0.12814            NaN               NaN    
    esti4         4             4       0.52383    0.039963            NaN               NaN    
    esti5         5             5       0.86664         NaN        0.26314           0.13141    </code></pre>
</div>
<div id="combine-tables-outterjoin-with-parfor" class="section level4" number="7.2.3.3">
<h4><span class="header-section-number">7.2.3.3</span> Combine Tables Outterjoin with Parfor</h4>
<p>Same as above, but iterate/solve over loops with parfor</p>
<pre><code>% Start cluster
delete(gcp(&#39;nocreate&#39;));
myCluster = parcluster(&#39;local&#39;);
it_workers = 4;
myCluster.NumWorkers = it_workers;
parpool(it_workers);

Starting parallel pool (parpool) using the &#39;local&#39; profile ...
Connected to the parallel pool (number of workers: 4).

% prepare storage
cl_stores = cell([4,1]);
% Loop over
parfor row_idx=1:4
    % a row of coefficent estimates
    rng(123+row_idx);    
    ar_st_col_names = [&quot;FVAL&quot;, &quot;EXITFLAG&quot;, &quot;esti_iterations&quot;, &quot;esti_funccount&quot;];
    it_num_rows = 1;
    it_num_cols = 4;
    mt_saveCoef = rand([it_num_rows, it_num_cols]);        
    tb_saveCoef = array2table(mt_saveCoef);
    tb_saveCoef.Properties.VariableNames = ar_st_col_names;
    tb_saveCoef = addvars(tb_saveCoef, row_idx, &#39;Before&#39;, 1);    
    % Stack all results
    cl_stores{row_idx} = tb_saveCoef;
end
% delete cluster
delete(gcp(&#39;nocreate&#39;));</code></pre>
<p>Stack tables stored in cells together:</p>
<pre><code>% Combine
tb_saveCoef_stack = [];
for row_idx=1:4
    tb_saveCoef_stack = [tb_saveCoef_stack; cl_stores{row_idx}];
end
% display results
disp(tb_saveCoef_stack);

    Var1     FVAL      EXITFLAG    esti_iterations    esti_funccount
    ____    _______    ________    _______________    ______________

     1      0.48946    0.58215          0.2796           0.23945    
     2      0.28746     0.3907         0.12685             0.694    
     3      0.76682    0.48312         0.50655           0.24223    
     4      0.71522    0.15045         0.43025            0.4845    </code></pre>
</div>
<div id="nd-dimensional-parameter-arrays-simulate-model-and-stack-output-tables" class="section level4" number="7.2.3.4">
<h4><span class="header-section-number">7.2.3.4</span> ND Dimensional Parameter Arrays, Simulate Model and Stack Output Tables</h4>
<p>Now we will first column combine matrixes, model parameters and model
outcomes, and then row combine matrixes from different simulations.</p>
<p>A model takes a N parameters, solve the model over M sets of parameters.
Each time when the model is solved, a P by Q table of results is
generated. Each column is a different statistics (mean, std, etc.), and
each row is a different outcome variable (consumption, asset choices,
etc.). Stack these P by Q Tables together, and add in information about
the N parameters, each of the tables been stacked initially had the same
column and row names.</p>
<p>The resulting table should have P times M rows, for M sets of model
simulations each with P rows of results. And there should be N + Q
columns, storing the N parameters as well as the Q columns of different
outcomes.</p>
<pre><code>rng(123);
% Generate A P by Q matrix of random parameter Values
it_param_groups_m = 5; 
it_params_n = 2;
it_outcomes_p = 3;
it_stats_q = 3;

% Parameter Matrix and Names
ar_param_names = strcat(&#39;param_&#39;, string(1:it_params_n));
mt_param_m_by_n = round(rand([it_param_groups_m, it_params_n])*5, 2);

% Loop over the parameters
for it_cur_param_group=1:1:it_param_groups_m
    
    % Current Parameters
    ar_param = mt_param_m_by_n(it_cur_param_group,:);
    
    % Some Model is simulated
    mt_model_simu = normrnd(mean(ar_param), std(ar_param), [it_outcomes_p, it_stats_q]);
    
    % Model Results are Saved As Table With Column and Row Information
    tb_model_simu = array2table(mt_model_simu);
    cl_col_names = strcat(&#39;stats_&#39;, string((1:size(mt_model_simu,2))));
    cl_row_names = strcat(&#39;outvar_&#39;, string((1:size(mt_model_simu,1))));
    tb_model_simu.Properties.VariableNames = cl_col_names;
    tb_model_simu.Properties.RowNames = cl_row_names;    
        
    % Convert Row Variable Names to a Column String
    outvar = string(tb_model_simu.Properties.RowNames);
    tb_model_simu = addvars(tb_model_simu, outvar, &#39;Before&#39;, 1);
    
    % Parameter Information Table that Shares Row Names as Simu Results
    mt_param_info = zeros([it_outcomes_p,it_params_n]) + ar_param;
    tb_param_info = array2table(mt_param_info);
    tb_param_info.Properties.VariableNames = ar_param_names;
    tb_param_info.Properties.RowNames = cl_row_names;
    
    % Combine Parameter Information and Simulation Contents
    tb_model_simu_w_info = [tb_param_info tb_model_simu];
    % Update Row Names based on total row available
    ar_rows_allsimu = (1:it_stats_q)&#39; + (it_cur_param_group-1)*it_stats_q;
    tb_model_simu_w_info.Properties.RowNames = strcat(&#39;row=&#39;, string(ar_rows_allsimu));
    
    % Show One Example Table before Stacking
    if (it_cur_param_group == round(it_param_groups_m/2))
        disp(tb_model_simu);
        disp(tb_param_info);
        disp(tb_model_simu_w_info);
    end
    
    % Stack all results
    if(it_cur_param_group == 1)
        tb_model_allsimu_w_info = tb_model_simu_w_info;
    else
        tb_model_allsimu_w_info = [tb_model_allsimu_w_info; tb_model_simu_w_info];
    end
    
end

                  outvar      stats_1     stats_2    stats_3
                __________    ________    _______    _______

    outvar_1    &quot;outvar_1&quot;    0.056853    2.1703     2.1098 
    outvar_2    &quot;outvar_2&quot;      3.1545    2.0634     0.7798 
    outvar_3    &quot;outvar_3&quot;    -0.49033    2.2566     1.7896 
                param_1    param_2
                _______    _______

    outvar_1     1.13       3.42  
    outvar_2     1.13       3.42  
    outvar_3     1.13       3.42  
             param_1    param_2      outvar      stats_1     stats_2    stats_3
             _______    _______    __________    ________    _______    _______

    row=7     1.13       3.42      &quot;outvar_1&quot;    0.056853    2.1703     2.1098 
    row=8     1.13       3.42      &quot;outvar_2&quot;      3.1545    2.0634     0.7798 
    row=9     1.13       3.42      &quot;outvar_3&quot;    -0.49033    2.2566     1.7896 </code></pre>
<p>Show all Simulation Joint Table Outputs:</p>
<pre><code>disp(tb_model_allsimu_w_info);

              param_1    param_2      outvar      stats_1     stats_2    stats_3
              _______    _______    __________    ________    _______    _______

    row=1      3.48       2.12      &quot;outvar_1&quot;      2.2665    1.1885      1.924 
    row=2      3.48       2.12      &quot;outvar_2&quot;      3.3427    2.4647     2.3548 
    row=3      3.48       2.12      &quot;outvar_3&quot;      2.6714    3.6132      2.918 
    row=4      1.43        4.9      &quot;outvar_1&quot;      3.3859    5.3759     1.5816 
    row=5      1.43        4.9      &quot;outvar_2&quot;      3.9499    3.8698     2.2693 
    row=6      1.43        4.9      &quot;outvar_3&quot;      5.7745    4.6871     1.7334 
    row=7      1.13       3.42      &quot;outvar_1&quot;    0.056853    2.1703     2.1098 
    row=8      1.13       3.42      &quot;outvar_2&quot;      3.1545    2.0634     0.7798 
    row=9      1.13       3.42      &quot;outvar_3&quot;    -0.49033    2.2566     1.7896 
    row=10     2.76        2.4      &quot;outvar_1&quot;      2.9611    2.6847     2.4986 
    row=11     2.76        2.4      &quot;outvar_2&quot;      2.9333    2.3457     3.0629 
    row=12     2.76        2.4      &quot;outvar_3&quot;      2.5814    2.4372     2.4806 
    row=13      3.6       1.96      &quot;outvar_1&quot;      2.7199    3.3129     3.0577 
    row=14      3.6       1.96      &quot;outvar_2&quot;      3.9804    1.4529     2.9285 
    row=15      3.6       1.96      &quot;outvar_3&quot;      2.8445    4.4117     2.6576 </code></pre>

</div>
</div>
</div>
<div id="summarize" class="section level2" number="7.3">
<h2><span class="header-section-number">7.3</span> Summarize</h2>

<div id="matlab-table-summarize-and-aggregate-by-groups" class="section level3" number="7.3.1">
<h3><span class="header-section-number">7.3.1</span> Matlab Table Summarize and Aggregate by Groups</h3>
<blockquote>
<p>Go back to <a href="http://fanwangecon.github.io/">fan</a>’s <a href="https://fanwangecon.github.io/MEconTools/">MEconTools</a> Package, <a href="https://fanwangecon.github.io/M4Econ/">Matlab Code Examples</a> Repository (<a href="https://fanwangecon.github.io/M4Econ/bookdown">bookdown site</a>), or <a href="https://fanwangecon.github.io/Math4Econ/">Math for Econ with Matlab</a> Repository (<a href="https://fanwangecon.github.io/Math4Econ/bookdown">bookdown site</a>).</p>
</blockquote>
<div id="group-table-rows-and-sum-within-group" class="section level4" number="7.3.1.1">
<h4><span class="header-section-number">7.3.1.1</span> Group Table Rows and Sum within Group</h4>
<p>There is a table where subsets of rows belong to different simulations,
with exogenous fixed <span class="math inline">\(\rho\)</span> parameters. For each <span class="math inline">\(\rho\)</span> parameter
combination, there are, stored as different rows, a number of model
predictions and data moments, and corresponding difference. Find the
total difference between model and data for subsets of rows based for
each <span class="math inline">\(\rho\)</span> parameter set.</p>
<p>First, create a table where each <span class="math inline">\(\rho\)</span> group is identified jointly by
<span class="math inline">\(\rho_a\)</span> and <span class="math inline">\(\rho_b\)</span>, stored in the 3rd and 4th rows.</p>
<pre><code>% Make N by 2 matrix of fieldname + value type
mt_st_variable_names_types = [...
    [&quot;year&quot;, &quot;double&quot;];[&quot;category&quot;, &quot;string&quot;];...
    [&quot;rhoa&quot;, &quot;double&quot;];[&quot;rhob&quot;, &quot;double&quot;]; ...
    [&quot;numberWorkersSimu&quot;, &quot;logical&quot;]; [&quot;numberWorkersData&quot;, &quot;double&quot;]];
% Make table using fieldnames &amp; value types from above
tb_agg_exa = table(&#39;Size&#39;,[0,size(mt_st_variable_names_types,1)],... 
    &#39;VariableNames&#39;, mt_st_variable_names_types(:,1),...
    &#39;VariableTypes&#39;, mt_st_variable_names_types(:,2));
% Table with data inputs
tb_agg_exa = [tb_agg_exa;...
    {1, &#39;C001&#39;, 0.50, 0.50, 5.5, 6.05}; {2, &#39;C002&#39;, 0.50, 0.50, 3.7, 4.4}; ...
    {1, &#39;C001&#39;, 0.25, 0.30, 2.5, 3.65}; {2, &#39;C002&#39;, 0.25, 0.30, 0.1, 1.6}; ...
    {3, &#39;C001&#39;, 0.25, 0.50, 0.01, 1.66}];
% Generate model and data difference
tb_agg_exa{:, &quot;diff&quot;} = tb_agg_exa{:, &quot;numberWorkersSimu&quot;} - tb_agg_exa{:, &quot;numberWorkersData&quot;};
% Display
disp(tb_agg_exa);

    year    category    rhoa    rhob    numberWorkersSimu    numberWorkersData    diff 
    ____    ________    ____    ____    _________________    _________________    _____

     1       &quot;C001&quot;      0.5    0.5            5.5                 6.05           -0.55
     2       &quot;C002&quot;      0.5    0.5            3.7                  4.4            -0.7
     1       &quot;C001&quot;     0.25    0.3            2.5                 3.65           -1.15
     2       &quot;C002&quot;     0.25    0.3            0.1                  1.6            -1.5
     3       &quot;C001&quot;     0.25    0.5           0.01                 1.66           -1.65</code></pre>
<p>Second, select the subset of columns that are relevant for aggregation.</p>
<pre><code>% Select
tb_agg_exa = tb_agg_exa(:, [&quot;rhoa&quot;, &quot;rhob&quot;, &quot;diff&quot;]);
% Display
disp(tb_agg_exa);

    rhoa    rhob    diff 
    ____    ____    _____

     0.5    0.5     -0.55
     0.5    0.5      -0.7
    0.25    0.3     -1.15
    0.25    0.3      -1.5
    0.25    0.5     -1.65</code></pre>
<p>Third, group by unique combinations of rhoa, rhob, and aggregate. Then
generate group ID.</p>
<pre><code>% Sum within groupo
tb_groupby_agg_sum = groupsummary(tb_agg_exa, [&quot;rhoa&quot;, &quot;rhob&quot;], &quot;sum&quot;);
% Generate grouping ID
tb_groupby_agg_sum{:, &quot;ID&quot;} = (1:1:size(tb_groupby_agg_sum, 1))&#39;;
tb_groupby_agg_sum = movevars(tb_groupby_agg_sum, &quot;ID&quot;, &quot;Before&quot;, 1);
disp(tb_groupby_agg_sum);

    ID    rhoa    rhob    GroupCount    sum_diff
    __    ____    ____    __________    ________

    1     0.25    0.3         2          -2.65  
    2     0.25    0.5         1          -1.65  
    3      0.5    0.5         2          -1.25  </code></pre>

</div>
</div>
</div>
</div>



            </section>

          </div>
        </div>
      </div>
<a href="graphs.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="index-and-code-links.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": [["Data-Structures-and-Dynamic-Optimization-with-Matlab.pdf", "PDF"]],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
