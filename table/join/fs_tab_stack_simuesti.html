<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,IE=9,chrome=1"><meta name="generator" content="MATLAB 2020b"><title>Matlab Table Stack and Join Estimation and Simulation Results</title><style type="text/css">.rtcContent { padding: 30px; } .S0 { margin: 3px 10px 5px 4px; padding: 0px; line-height: 28.8px; min-height: 0px; white-space: pre-wrap; color: rgb(213, 80, 0); font-family: Helvetica, Arial, sans-serif; font-style: normal; font-size: 24px; font-weight: 400; text-align: left;  }
.S1 { margin: 2px 10px 9px 4px; padding: 0px; line-height: 21px; min-height: 0px; white-space: pre-wrap; color: rgb(0, 0, 0); font-family: Helvetica, Arial, sans-serif; font-style: normal; font-size: 14px; font-weight: 400; text-align: left;  }
.S2 { margin: 3px 10px 5px 4px; padding: 0px; line-height: 20px; min-height: 0px; white-space: pre-wrap; color: rgb(60, 60, 60); font-family: Helvetica, Arial, sans-serif; font-style: normal; font-size: 20px; font-weight: 700; text-align: left;  }
.CodeBlock { background-color: #F7F7F7; margin: 10px 0 10px 0;}
.S3 { border-left: 1px solid rgb(233, 233, 233); border-right: 1px solid rgb(233, 233, 233); border-top: 1px solid rgb(233, 233, 233); border-bottom: 0px none rgb(0, 0, 0); border-radius: 4px 4px 0px 0px; padding: 6px 45px 0px 13px; line-height: 17.234px; min-height: 18px; white-space: nowrap; color: rgb(0, 0, 0); font-family: Menlo, Monaco, Consolas, "Courier New", monospace; font-size: 14px;  }
.S4 { border-left: 1px solid rgb(233, 233, 233); border-right: 1px solid rgb(233, 233, 233); border-top: 0px none rgb(0, 0, 0); border-bottom: 0px none rgb(0, 0, 0); border-radius: 0px; padding: 0px 45px 0px 13px; line-height: 17.234px; min-height: 18px; white-space: nowrap; color: rgb(0, 0, 0); font-family: Menlo, Monaco, Consolas, "Courier New", monospace; font-size: 14px;  }
.S5 { border-left: 1px solid rgb(233, 233, 233); border-right: 1px solid rgb(233, 233, 233); border-top: 0px none rgb(0, 0, 0); border-bottom: 1px solid rgb(233, 233, 233); border-radius: 0px; padding: 0px 45px 4px 13px; line-height: 17.234px; min-height: 18px; white-space: nowrap; color: rgb(0, 0, 0); font-family: Menlo, Monaco, Consolas, "Courier New", monospace; font-size: 14px;  }
.S6 { color: rgb(64, 64, 64); padding: 10px 0px 6px 17px; background: rgb(255, 255, 255) none repeat scroll 0% 0% / auto padding-box border-box; font-family: Menlo, Monaco, Consolas, "Courier New", monospace; font-size: 14px; overflow-x: hidden; line-height: 17.234px;  }
.embeddedOutputsErrorElement {min-height: 18px; max-height: 250px; overflow: auto;}
.embeddedOutputsErrorElement.inlineElement {}
.embeddedOutputsErrorElement.rightPaneElement {}
.embeddedOutputsWarningElement{min-height: 18px; max-height: 250px; overflow: auto;}
.embeddedOutputsWarningElement.inlineElement {}
.embeddedOutputsWarningElement.rightPaneElement {}
.diagnosticMessage-wrapper {font-family: Menlo, Monaco, Consolas, "Courier New", monospace; font-size: 12px;}
.diagnosticMessage-wrapper.diagnosticMessage-warningType {color: rgb(255,100,0);}
.diagnosticMessage-wrapper.diagnosticMessage-warningType a {color: rgb(255,100,0); text-decoration: underline;}
.diagnosticMessage-wrapper.diagnosticMessage-errorType {color: rgb(230,0,0);}
.diagnosticMessage-wrapper.diagnosticMessage-errorType a {color: rgb(230,0,0); text-decoration: underline;}
.diagnosticMessage-wrapper .diagnosticMessage-messagePart,.diagnosticMessage-wrapper .diagnosticMessage-causePart {white-space: pre-wrap;}
.diagnosticMessage-wrapper .diagnosticMessage-stackPart {white-space: pre;}
.embeddedOutputsTextElement,.embeddedOutputsVariableStringElement {white-space: pre; word-wrap: initial; min-height: 18px; max-height: 250px; overflow: auto;}
.textElement,.rtcDataTipElement .textElement {padding-top: 3px;}
.embeddedOutputsTextElement.inlineElement,.embeddedOutputsVariableStringElement.inlineElement {}
.inlineElement .textElement {}
.embeddedOutputsTextElement.rightPaneElement,.embeddedOutputsVariableStringElement.rightPaneElement {min-height: 16px;}
.rightPaneElement .textElement {padding-top: 2px; padding-left: 9px;}
.S7 { border-left: 1px solid rgb(233, 233, 233); border-right: 1px solid rgb(233, 233, 233); border-top: 1px solid rgb(233, 233, 233); border-bottom: 0px none rgb(0, 0, 0); border-radius: 0px; padding: 6px 45px 0px 13px; line-height: 17.234px; min-height: 18px; white-space: nowrap; color: rgb(0, 0, 0); font-family: Menlo, Monaco, Consolas, "Courier New", monospace; font-size: 14px;  }
.S8 { border-left: 1px solid rgb(233, 233, 233); border-right: 1px solid rgb(233, 233, 233); border-top: 0px none rgb(0, 0, 0); border-bottom: 1px solid rgb(233, 233, 233); border-radius: 0px 0px 4px 4px; padding: 0px 45px 4px 13px; line-height: 17.234px; min-height: 18px; white-space: nowrap; color: rgb(0, 0, 0); font-family: Menlo, Monaco, Consolas, "Courier New", monospace; font-size: 14px;  }
.S9 { margin: 10px 10px 9px 4px; padding: 0px; line-height: 21px; min-height: 0px; white-space: pre-wrap; color: rgb(0, 0, 0); font-family: Helvetica, Arial, sans-serif; font-style: normal; font-size: 14px; font-weight: 400; text-align: left;  }
.S10 { border-left: 1px solid rgb(233, 233, 233); border-right: 1px solid rgb(233, 233, 233); border-top: 1px solid rgb(233, 233, 233); border-bottom: 1px solid rgb(233, 233, 233); border-radius: 4px 4px 0px 0px; padding: 6px 45px 4px 13px; line-height: 17.234px; min-height: 18px; white-space: nowrap; color: rgb(0, 0, 0); font-family: Menlo, Monaco, Consolas, "Courier New", monospace; font-size: 14px;  }</style></head><body><div class = rtcContent><h1  class = 'S0'><span>Matlab Table Stack and Join Estimation and Simulation Results</span></h1><div  class = 'S1'><span style=' font-weight: bold;'>back to </span><a href = "https://fanwangecon.github.io"><span style=' font-weight: bold;'>Fan</span></a><span style=' font-weight: bold;'>'s </span><a href = "https://fanwangecon.github.io/Math4Econ/"><span style=' font-weight: bold;'>Intro Math for Econ</span></a><span style=' font-weight: bold;'>,  </span><a href = "https://fanwangecon.github.io/M4Econ/"><span style=' font-weight: bold;'>Matlab Examples</span></a><span style=' font-weight: bold;'>, or </span><a href = "https://fanwangecon.github.io/MEconTools/"><span style=' font-weight: bold;'>MEconTools</span></a><span style=' font-weight: bold;'> Repositories</span></div><h2  class = 'S2'><span>Combine Tables Together Stack Rows Loop Template Common Columns</span></h2><div  class = 'S1'><span>There is an estimation routine, each time the routine outputs a table with a single row, the single row contains estimation outputs including estiamtes, standard erros, initial parameters etc. We loop over different estimation routines, with different starting values etc, and rather than saving many tables, we want to save a joint table with all rows stacked together.</span></div><div  class = 'S1'><span>This simply means that we have a loop, during each iteration, generating a table, we want to stack things together. For this assume that the column names are the same. </span></div><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre;"><span>rng(</span><span style="color: rgb(170, 4, 249);">"default"</span><span>);</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>tb_saveCoef_stack = [];</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span style="color: rgb(14, 0, 255);">for </span><span>row_idx=1:5</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>    </span><span style="color: rgb(2, 128, 9);">% a row of coefficent estimates    </span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>    rng(123+row_idx);</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>    it_num_cols = 4;</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>    it_num_rows = 1;</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>    mt_saveCoef = rand([it_num_rows, it_num_cols]);</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>    </span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>    </span><span style="color: rgb(2, 128, 9);">% row to table</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>    ar_st_col_names = [</span><span style="color: rgb(170, 4, 249);">"FVAL"</span><span>, </span><span style="color: rgb(170, 4, 249);">"EXITFLAG"</span><span>, </span><span style="color: rgb(170, 4, 249);">"esti_iterations"</span><span>, </span><span style="color: rgb(170, 4, 249);">"esti_funccount"</span><span>];        </span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>    tb_saveCoef = array2table(mt_saveCoef);</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>    tb_saveCoef.Properties.VariableNames = ar_st_col_names;</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>    </span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>    </span><span style="color: rgb(2, 128, 9);">% Stack all results</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>    </span><span class="warning_squiggle_rte1865859824">tb_saveCoef_stack</span><span> = [tb_saveCoef_stack; tb_saveCoef];</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span style="color: rgb(14, 0, 255);">end</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span style="color: rgb(2, 128, 9);">% Add esti Counter as column</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>estimodelctr = (1:size(tb_saveCoef_stack,1))';</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>tb_saveCoef_stack = addvars(tb_saveCoef_stack, estimodelctr, </span><span style="color: rgb(170, 4, 249);">'Before'</span><span>, 1);</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span style="color: rgb(2, 128, 9);">% Add a row name as a variable</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>cl_row_names_a = strcat(</span><span style="color: rgb(170, 4, 249);">'esti'</span><span>, string((1:size(tb_saveCoef_stack,1))));</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>tb_saveCoef_stack.Properties.RowNames = cl_row_names_a;</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span style="color: rgb(2, 128, 9);">% display results</span></span></div></div><div class="inlineWrapper outputs"><div  class = 'S5'><span style="white-space: pre;"><span>disp(tb_saveCoef_stack);</span></span></div><div  class = 'S6'><div class="inlineElement eoOutputWrapper embeddedOutputsTextElement" uid="D33D44C4" data-testid="output_0" data-width="1120" data-height="115" data-hashorizontaloverflow="false" style="width: 1150px; max-height: 261px;"><div class="textElement">             <strong>estimodelctr</strong>     <strong>FVAL</strong>      <strong>EXITFLAG</strong>    <strong>esti_iterations</strong>    <strong>esti_funccount</strong>
             <strong>____________</strong>    <strong>_______</strong>    <strong>________</strong>    <strong>_______________</strong>    <strong>______________</strong>

    <strong>esti1</strong>         1          0.10606     0.74547        0.57231            0.45824   
    <strong>esti2</strong>         2          0.50673    0.057531        0.62758            0.13255   
    <strong>esti3</strong>         3          0.10517     0.12814       0.087406            0.11548   
    <strong>esti4</strong>         4          0.52383    0.039963        0.18597            0.77279   
    <strong>esti5</strong>         5          0.86664     0.26314        0.13141           0.041593   </div></div></div></div></div><h2  class = 'S2'><span>Combine Tables Together Stack Rows Loop Template Outterjoin </span></h2><div  class = 'S1'><span>Similar to the previous estimation problem, however, now during different iterations, the column names, i.e. the parameters been estiamted are different. For example, there are 10 parameters, sometimes we estimate 5 of the 10, sometimes 10 or the 10. Want to stack all results together similar to above. </span></div><div  class = 'S1'><span>This is accomplished in the following example with the </span><a href = "https://www.mathworks.com/help/matlab/ref/outerjoin.html"><span>outerjoin function</span></a><span>.</span></div><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre;"><span style="color: rgb(14, 0, 255);">for </span><span>row_idx=1:5</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>    </span><span style="color: rgb(2, 128, 9);">% a row of coefficent estimates</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>    rng(123+row_idx);</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>    </span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>    it_num_rows = 1;</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>    </span><span style="color: rgb(14, 0, 255);">if </span><span>(row_idx &lt;= 2) </span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>        it_num_cols = 4;</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>        mt_saveCoef = rand([it_num_rows, it_num_cols]);    </span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>        </span><span style="color: rgb(2, 128, 9);">% row to table    </span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>        ar_st_col_names = [</span><span style="color: rgb(170, 4, 249);">"FVAL"</span><span>, </span><span style="color: rgb(170, 4, 249);">"EXITFLAG"</span><span>, </span><span style="color: rgb(170, 4, 249);">"esti_iterations"</span><span>, </span><span style="color: rgb(170, 4, 249);">"esti_funccount"</span><span>];</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>    </span><span style="color: rgb(14, 0, 255);">elseif </span><span>(row_idx &lt;= 4) </span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>        it_num_cols = 2;</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>        mt_saveCoef = rand([it_num_rows, it_num_cols]);</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>        </span><span style="color: rgb(2, 128, 9);">% row to table    </span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>        ar_st_col_names = [</span><span style="color: rgb(170, 4, 249);">"FVAL"</span><span>, </span><span style="color: rgb(170, 4, 249);">"EXITFLAG"</span><span>];</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>    </span><span style="color: rgb(14, 0, 255);">else</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>        it_num_cols = 3;</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>        mt_saveCoef = rand([it_num_rows, it_num_cols]);</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>        </span><span style="color: rgb(2, 128, 9);">% row to table    </span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>        ar_st_col_names = [</span><span style="color: rgb(170, 4, 249);">"FVAL"</span><span>, </span><span style="color: rgb(170, 4, 249);">"esti_iterations"</span><span>, </span><span style="color: rgb(170, 4, 249);">"esti_funccount"</span><span>];</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>    </span><span style="color: rgb(14, 0, 255);">end</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>    </span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>    tb_saveCoef = array2table(mt_saveCoef);</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>    tb_saveCoef.Properties.VariableNames = ar_st_col_names;</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>    tb_saveCoef = addvars(tb_saveCoef, row_idx, </span><span style="color: rgb(170, 4, 249);">'Before'</span><span>, 1);</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>    </span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>    </span><span style="color: rgb(2, 128, 9);">% Stack all results</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>    </span><span style="color: rgb(14, 0, 255);">if</span><span>(row_idx == 1)</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>        tb_saveCoef_stack = tb_saveCoef;</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>    </span><span style="color: rgb(14, 0, 255);">else</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>        tb_saveCoef_stack = outerjoin(tb_saveCoef_stack, tb_saveCoef, </span><span style="color: rgb(170, 4, 249);">'MergeKeys'</span><span>, true);</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>    </span><span style="color: rgb(14, 0, 255);">end</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span style="color: rgb(14, 0, 255);">end</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span style="color: rgb(2, 128, 9);">% Add esti Counter as column</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>estimodelctr = (1:size(tb_saveCoef_stack,1))';</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>tb_saveCoef_stack = addvars(tb_saveCoef_stack, estimodelctr, </span><span style="color: rgb(170, 4, 249);">'Before'</span><span>, 1);</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span style="color: rgb(2, 128, 9);">% Add a row name as a variable</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>cl_row_names_a = strcat(</span><span style="color: rgb(170, 4, 249);">'esti'</span><span>, string((1:size(tb_saveCoef_stack,1))));</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>tb_saveCoef_stack.Properties.RowNames = cl_row_names_a;</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span style="color: rgb(2, 128, 9);">% display results</span></span></div></div><div class="inlineWrapper outputs"><div  class = 'S5'><span style="white-space: pre;"><span>disp(tb_saveCoef_stack);</span></span></div><div  class = 'S6'><div class="inlineElement eoOutputWrapper embeddedOutputsTextElement" uid="F5E1A73A" data-testid="output_1" data-width="1120" data-height="115" data-hashorizontaloverflow="false" style="width: 1150px; max-height: 261px;"><div class="textElement">             <strong>estimodelctr</strong>    <strong>row_idx</strong>     <strong>FVAL</strong>      <strong>EXITFLAG</strong>    <strong>esti_iterations</strong>    <strong>esti_funccount</strong>
             <strong>____________</strong>    <strong>_______</strong>    <strong>_______</strong>    <strong>________</strong>    <strong>_______________</strong>    <strong>______________</strong>

    <strong>esti1</strong>         1             1       0.10606     0.74547        0.57231           0.45824    
    <strong>esti2</strong>         2             2       0.50673    0.057531        0.62758           0.13255    
    <strong>esti3</strong>         3             3       0.10517     0.12814            NaN               NaN    
    <strong>esti4</strong>         4             4       0.52383    0.039963            NaN               NaN    
    <strong>esti5</strong>         5             5       0.86664         NaN        0.26314           0.13141    </div></div></div></div></div><h2  class = 'S2'><span>Combine Tables Outterjoin with Parfor</span></h2><div  class = 'S1'><span>Same as above, but iterate/solve over loops with parfor</span></div><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre;"><span style="color: rgb(2, 128, 9);">% Start cluster</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>delete(gcp(</span><span style="color: rgb(170, 4, 249);">'nocreate'</span><span>));</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>myCluster = parcluster(</span><span style="color: rgb(170, 4, 249);">'local'</span><span>);</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>it_workers = 4;</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>myCluster.NumWorkers = it_workers;</span></span></div></div><div class="inlineWrapper outputs"><div  class = 'S5'><span style="white-space: pre;"><span>parpool(it_workers);</span></span></div><div  class = 'S6'><div class="inlineElement eoOutputWrapper embeddedOutputsTextElement" uid="553E70F9" data-testid="output_2" data-width="1120" data-height="31" data-hashorizontaloverflow="false" style="width: 1150px; max-height: 261px;"><div class="textElement">Starting parallel pool (parpool) using the 'local' profile ...
Connected to the parallel pool (number of workers: 4).</div></div></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span style="color: rgb(2, 128, 9);">% prepare storage</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>cl_stores = cell([4,1]);</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span style="color: rgb(2, 128, 9);">% Loop over</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span style="color: rgb(14, 0, 255);">parfor </span><span>row_idx=1:4</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>    </span><span style="color: rgb(2, 128, 9);">% a row of coefficent estimates</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>    rng(123+row_idx);    </span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>    ar_st_col_names = [</span><span style="color: rgb(170, 4, 249);">"FVAL"</span><span>, </span><span style="color: rgb(170, 4, 249);">"EXITFLAG"</span><span>, </span><span style="color: rgb(170, 4, 249);">"esti_iterations"</span><span>, </span><span style="color: rgb(170, 4, 249);">"esti_funccount"</span><span>];</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>    it_num_rows = 1;</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>    it_num_cols = 4;</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>    mt_saveCoef = rand([it_num_rows, it_num_cols]);        </span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>    tb_saveCoef = array2table(mt_saveCoef);</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>    tb_saveCoef.Properties.VariableNames = ar_st_col_names;</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>    tb_saveCoef = addvars(tb_saveCoef, row_idx, </span><span style="color: rgb(170, 4, 249);">'Before'</span><span>, 1);    </span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>    </span><span style="color: rgb(2, 128, 9);">% Stack all results</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>    cl_stores{row_idx} = tb_saveCoef;</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span style="color: rgb(14, 0, 255);">end</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span style="color: rgb(2, 128, 9);">% delete cluster</span></span></div></div><div class="inlineWrapper"><div  class = 'S8'><span style="white-space: pre;"><span>delete(gcp(</span><span style="color: rgb(170, 4, 249);">'nocreate'</span><span>));</span></span></div></div></div><div  class = 'S9'><span>Stack tables stored in cells together:</span></div><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre;"><span style="color: rgb(2, 128, 9);">% Combine</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>tb_saveCoef_stack = [];</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span style="color: rgb(14, 0, 255);">for </span><span>row_idx=1:4</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>    </span><span class="warning_squiggle_rte1865859824">tb_saveCoef_stack</span><span> = [tb_saveCoef_stack; cl_stores{row_idx}];</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span style="color: rgb(14, 0, 255);">end</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span style="color: rgb(2, 128, 9);">% display results</span></span></div></div><div class="inlineWrapper outputs"><div  class = 'S5'><span style="white-space: pre;"><span>disp(tb_saveCoef_stack);</span></span></div><div  class = 'S6'><div class="inlineElement eoOutputWrapper embeddedOutputsTextElement" uid="8E96D71C" data-testid="output_3" data-width="1120" data-height="101" data-hashorizontaloverflow="false" style="width: 1150px; max-height: 261px;"><div class="textElement">    <strong>Var1</strong>     <strong>FVAL</strong>      <strong>EXITFLAG</strong>    <strong>esti_iterations</strong>    <strong>esti_funccount</strong>
    <strong>____</strong>    <strong>_______</strong>    <strong>________</strong>    <strong>_______________</strong>    <strong>______________</strong>

     1      0.48946    0.58215          0.2796           0.23945    
     2      0.28746     0.3907         0.12685             0.694    
     3      0.76682    0.48312         0.50655           0.24223    
     4      0.71522    0.15045         0.43025            0.4845    </div></div></div></div></div><h2  class = 'S2'><span>ND Dimensional Parameter Arrays, Simulate Model and Stack Output Tables</span></h2><div  class = 'S1'><span>Now we will first column combine matrixes, model parameters and model outcomes, and then row combine matrixes from different simulations.</span></div><div  class = 'S1'><span>A model takes a N parameters, solve the model over M sets of parameters. Each time when the model is solved, a P by Q table of results is generated. Each column is a different statistics (mean, std, etc.), and each row is a different outcome variable (consumption, asset choices, etc.). Stack these P by Q Tables together, and add in information about the N parameters, each of the tables been stacked initially had the same column and row names.</span></div><div  class = 'S1'><span>The resulting table should have P times M rows, for M sets of model simulations each with P rows of results. And there should be N + Q columns, storing the N parameters as well as the Q columns of different outcomes. </span></div><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre;"><span>rng(123);</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span style="color: rgb(2, 128, 9);">% Generate A P by Q matrix of random parameter Values</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>it_param_groups_m = 5; </span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>it_params_n = 2;</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>it_outcomes_p = 3;</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>it_stats_q = 3;</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span style="color: rgb(2, 128, 9);">% Parameter Matrix and Names</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>ar_param_names = strcat(</span><span style="color: rgb(170, 4, 249);">'param_'</span><span>, string(1:it_params_n));</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>mt_param_m_by_n = round(rand([it_param_groups_m, it_params_n])*5, 2);</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span style="color: rgb(2, 128, 9);">% Loop over the parameters</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span style="color: rgb(14, 0, 255);">for </span><span>it_cur_param_group=1:1:it_param_groups_m</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>    </span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>    </span><span style="color: rgb(2, 128, 9);">% Current Parameters</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>    ar_param = mt_param_m_by_n(it_cur_param_group,:);</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>    </span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>    </span><span style="color: rgb(2, 128, 9);">% Some Model is simulated</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>    mt_model_simu = normrnd(mean(ar_param), std(ar_param), [it_outcomes_p, it_stats_q]);</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>    </span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>    </span><span style="color: rgb(2, 128, 9);">% Model Results are Saved As Table With Column and Row Information</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>    tb_model_simu = array2table(mt_model_simu);</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>    cl_col_names = strcat(</span><span style="color: rgb(170, 4, 249);">'stats_'</span><span>, string((1:size(mt_model_simu,2))));</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>    cl_row_names = strcat(</span><span style="color: rgb(170, 4, 249);">'outvar_'</span><span>, string((1:size(mt_model_simu,1))));</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>    tb_model_simu.Properties.VariableNames = cl_col_names;</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>    tb_model_simu.Properties.RowNames = cl_row_names;    </span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>        </span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>    </span><span style="color: rgb(2, 128, 9);">% Convert Row Variable Names to a Column String</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>    outvar = string(tb_model_simu.Properties.RowNames);</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>    tb_model_simu = addvars(tb_model_simu, outvar, </span><span style="color: rgb(170, 4, 249);">'Before'</span><span>, 1);</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>    </span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>    </span><span style="color: rgb(2, 128, 9);">% Parameter Information Table that Shares Row Names as Simu Results</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>    mt_param_info = zeros([it_outcomes_p,it_params_n]) + ar_param;</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>    tb_param_info = array2table(mt_param_info);</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>    tb_param_info.Properties.VariableNames = ar_param_names;</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>    tb_param_info.Properties.RowNames = cl_row_names;</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>    </span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>    </span><span style="color: rgb(2, 128, 9);">% Combine Parameter Information and Simulation Contents</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>    tb_model_simu_w_info = [tb_param_info tb_model_simu];</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>    </span><span style="color: rgb(2, 128, 9);">% Update Row Names based on total row available</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>    ar_rows_allsimu = (1:it_stats_q)' + (it_cur_param_group-1)*it_stats_q;</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>    tb_model_simu_w_info.Properties.RowNames = strcat(</span><span style="color: rgb(170, 4, 249);">'row='</span><span>, string(ar_rows_allsimu));</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>    </span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>    </span><span style="color: rgb(2, 128, 9);">% Show One Example Table before Stacking</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>    </span><span style="color: rgb(14, 0, 255);">if </span><span>(it_cur_param_group == round(it_param_groups_m/2))</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>        disp(tb_model_simu);</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>        disp(tb_param_info);</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>        disp(tb_model_simu_w_info);</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>    </span><span style="color: rgb(14, 0, 255);">end</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>    </span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>    </span><span style="color: rgb(2, 128, 9);">% Stack all results</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>    </span><span style="color: rgb(14, 0, 255);">if</span><span>(it_cur_param_group == 1)</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>        tb_model_allsimu_w_info = tb_model_simu_w_info;</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>    </span><span style="color: rgb(14, 0, 255);">else</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>        </span><span class="warning_squiggle_rte1865859824">tb_model_allsimu_w_info</span><span> = [tb_model_allsimu_w_info; tb_model_simu_w_info];</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>    </span><span style="color: rgb(14, 0, 255);">end</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre;"><span>    </span></span></div></div><div class="inlineWrapper outputs"><div  class = 'S5'><span style="white-space: pre;"><span style="color: rgb(14, 0, 255);">end</span></span></div><div  class = 'S6'><div class="inlineElement eoOutputWrapper embeddedOutputsTextElement" uid="F9A2949C" data-testid="output_4" data-width="1120" data-height="87" data-hashorizontaloverflow="false" style="width: 1150px; max-height: 261px;"><div class="textElement">                  <strong>outvar</strong>      <strong>stats_1</strong>     <strong>stats_2</strong>    <strong>stats_3</strong>
                <strong>__________</strong>    <strong>________</strong>    <strong>_______</strong>    <strong>_______</strong>

    <strong>outvar_1</strong>    "outvar_1"    0.056853    2.1703     2.1098 
    <strong>outvar_2</strong>    "outvar_2"      3.1545    2.0634     0.7798 
    <strong>outvar_3</strong>    "outvar_3"    -0.49033    2.2566     1.7896 </div></div><div class="inlineElement eoOutputWrapper embeddedOutputsTextElement" uid="51923FEF" data-testid="output_5" data-width="1120" data-height="87" data-hashorizontaloverflow="false" style="width: 1150px; max-height: 261px;"><div class="textElement">                <strong>param_1</strong>    <strong>param_2</strong>
                <strong>_______</strong>    <strong>_______</strong>

    <strong>outvar_1</strong>     1.13       3.42  
    <strong>outvar_2</strong>     1.13       3.42  
    <strong>outvar_3</strong>     1.13       3.42  </div></div><div class="inlineElement eoOutputWrapper embeddedOutputsTextElement" uid="A88D628F" data-testid="output_6" data-width="1120" data-height="87" data-hashorizontaloverflow="false" style="width: 1150px; max-height: 261px;"><div class="textElement">             <strong>param_1</strong>    <strong>param_2</strong>      <strong>outvar</strong>      <strong>stats_1</strong>     <strong>stats_2</strong>    <strong>stats_3</strong>
             <strong>_______</strong>    <strong>_______</strong>    <strong>__________</strong>    <strong>________</strong>    <strong>_______</strong>    <strong>_______</strong>

    <strong>row=7</strong>     1.13       3.42      "outvar_1"    0.056853    2.1703     2.1098 
    <strong>row=8</strong>     1.13       3.42      "outvar_2"      3.1545    2.0634     0.7798 
    <strong>row=9</strong>     1.13       3.42      "outvar_3"    -0.49033    2.2566     1.7896 </div></div></div></div></div><div  class = 'S9'><span>Show all Simulation Joint Table Outputs:</span></div><div class="CodeBlock"><div class="inlineWrapper outputs"><div  class = 'S10'><span style="white-space: pre;"><span>disp(tb_model_allsimu_w_info);</span></span></div><div  class = 'S6'><div class="inlineElement eoOutputWrapper embeddedOutputsTextElement" uid="E345ADEC" data-testid="output_7" data-width="1120" data-height="255" data-hashorizontaloverflow="false" style="width: 1150px; max-height: 266px;"><div class="textElement">              <strong>param_1</strong>    <strong>param_2</strong>      <strong>outvar</strong>      <strong>stats_1</strong>     <strong>stats_2</strong>    <strong>stats_3</strong>
              <strong>_______</strong>    <strong>_______</strong>    <strong>__________</strong>    <strong>________</strong>    <strong>_______</strong>    <strong>_______</strong>

    <strong>row=1 </strong>     3.48       2.12      "outvar_1"      2.2665    1.1885      1.924 
    <strong>row=2 </strong>     3.48       2.12      "outvar_2"      3.3427    2.4647     2.3548 
    <strong>row=3 </strong>     3.48       2.12      "outvar_3"      2.6714    3.6132      2.918 
    <strong>row=4 </strong>     1.43        4.9      "outvar_1"      3.3859    5.3759     1.5816 
    <strong>row=5 </strong>     1.43        4.9      "outvar_2"      3.9499    3.8698     2.2693 
    <strong>row=6 </strong>     1.43        4.9      "outvar_3"      5.7745    4.6871     1.7334 
    <strong>row=7 </strong>     1.13       3.42      "outvar_1"    0.056853    2.1703     2.1098 
    <strong>row=8 </strong>     1.13       3.42      "outvar_2"      3.1545    2.0634     0.7798 
    <strong>row=9 </strong>     1.13       3.42      "outvar_3"    -0.49033    2.2566     1.7896 
    <strong>row=10</strong>     2.76        2.4      "outvar_1"      2.9611    2.6847     2.4986 
    <strong>row=11</strong>     2.76        2.4      "outvar_2"      2.9333    2.3457     3.0629 
    <strong>row=12</strong>     2.76        2.4      "outvar_3"      2.5814    2.4372     2.4806 
    <strong>row=13</strong>      3.6       1.96      "outvar_1"      2.7199    3.3129     3.0577 
    <strong>row=14</strong>      3.6       1.96      "outvar_2"      3.9804    1.4529     2.9285 
    <strong>row=15</strong>      3.6       1.96      "outvar_3"      2.8445    4.4117     2.6576 </div></div></div></div></div></div>
<br>
<!-- 
##### SOURCE BEGIN #####
%% Matlab Table Stack and Join Estimation and Simulation Results
% *back to* <https://fanwangecon.github.io *Fan*>*'s* <https://fanwangecon.github.io/Math4Econ/ 
% *Intro Math for Econ*>*,*  <https://fanwangecon.github.io/M4Econ/ *Matlab Examples*>*, 
% or* <https://fanwangecon.github.io/MEconTools/ *MEconTools*> *Repositories*
%% Combine Tables Together Stack Rows Loop Template Common Columns
% There is an estimation routine, each time the routine outputs a table with 
% a single row, the single row contains estimation outputs including estiamtes, 
% standard erros, initial parameters etc. We loop over different estimation routines, 
% with different starting values etc, and rather than saving many tables, we want 
% to save a joint table with all rows stacked together.
% 
% This simply means that we have a loop, during each iteration, generating a 
% table, we want to stack things together. For this assume that the column names 
% are the same. 

rng("default");
tb_saveCoef_stack = [];
for row_idx=1:5
    % a row of coefficent estimates    
    rng(123+row_idx);
    it_num_cols = 4;
    it_num_rows = 1;
    mt_saveCoef = rand([it_num_rows, it_num_cols]);
    
    % row to table
    ar_st_col_names = ["FVAL", "EXITFLAG", "esti_iterations", "esti_funccount"];        
    tb_saveCoef = array2table(mt_saveCoef);
    tb_saveCoef.Properties.VariableNames = ar_st_col_names;
    
    % Stack all results
    tb_saveCoef_stack = [tb_saveCoef_stack; tb_saveCoef];
end
% Add esti Counter as column
estimodelctr = (1:size(tb_saveCoef_stack,1))';
tb_saveCoef_stack = addvars(tb_saveCoef_stack, estimodelctr, 'Before', 1);
% Add a row name as a variable
cl_row_names_a = strcat('esti', string((1:size(tb_saveCoef_stack,1))));
tb_saveCoef_stack.Properties.RowNames = cl_row_names_a;
% display results
disp(tb_saveCoef_stack);
%% Combine Tables Together Stack Rows Loop Template Outterjoin 
% Similar to the previous estimation problem, however, now during different 
% iterations, the column names, i.e. the parameters been estiamted are different. 
% For example, there are 10 parameters, sometimes we estimate 5 of the 10, sometimes 
% 10 or the 10. Want to stack all results together similar to above. 
% 
% This is accomplished in the following example with the <https://www.mathworks.com/help/matlab/ref/outerjoin.html 
% outerjoin function>.

for row_idx=1:5
    % a row of coefficent estimates
    rng(123+row_idx);
    
    it_num_rows = 1;
    if (row_idx <= 2) 
        it_num_cols = 4;
        mt_saveCoef = rand([it_num_rows, it_num_cols]);    
        % row to table    
        ar_st_col_names = ["FVAL", "EXITFLAG", "esti_iterations", "esti_funccount"];
    elseif (row_idx <= 4) 
        it_num_cols = 2;
        mt_saveCoef = rand([it_num_rows, it_num_cols]);
        % row to table    
        ar_st_col_names = ["FVAL", "EXITFLAG"];
    else
        it_num_cols = 3;
        mt_saveCoef = rand([it_num_rows, it_num_cols]);
        % row to table    
        ar_st_col_names = ["FVAL", "esti_iterations", "esti_funccount"];
    end
    
    tb_saveCoef = array2table(mt_saveCoef);
    tb_saveCoef.Properties.VariableNames = ar_st_col_names;
    tb_saveCoef = addvars(tb_saveCoef, row_idx, 'Before', 1);
    
    % Stack all results
    if(row_idx == 1)
        tb_saveCoef_stack = tb_saveCoef;
    else
        tb_saveCoef_stack = outerjoin(tb_saveCoef_stack, tb_saveCoef, 'MergeKeys', true);
    end
end
% Add esti Counter as column
estimodelctr = (1:size(tb_saveCoef_stack,1))';
tb_saveCoef_stack = addvars(tb_saveCoef_stack, estimodelctr, 'Before', 1);
% Add a row name as a variable
cl_row_names_a = strcat('esti', string((1:size(tb_saveCoef_stack,1))));
tb_saveCoef_stack.Properties.RowNames = cl_row_names_a;
% display results
disp(tb_saveCoef_stack);
%% Combine Tables Outterjoin with Parfor
% Same as above, but iterate/solve over loops with parfor

% Start cluster
delete(gcp('nocreate'));
myCluster = parcluster('local');
it_workers = 4;
myCluster.NumWorkers = it_workers;
parpool(it_workers);
% prepare storage
cl_stores = cell([4,1]);
% Loop over
parfor row_idx=1:4
    % a row of coefficent estimates
    rng(123+row_idx);    
    ar_st_col_names = ["FVAL", "EXITFLAG", "esti_iterations", "esti_funccount"];
    it_num_rows = 1;
    it_num_cols = 4;
    mt_saveCoef = rand([it_num_rows, it_num_cols]);        
    tb_saveCoef = array2table(mt_saveCoef);
    tb_saveCoef.Properties.VariableNames = ar_st_col_names;
    tb_saveCoef = addvars(tb_saveCoef, row_idx, 'Before', 1);    
    % Stack all results
    cl_stores{row_idx} = tb_saveCoef;
end
% delete cluster
delete(gcp('nocreate'));
%% 
% Stack tables stored in cells together:

% Combine
tb_saveCoef_stack = [];
for row_idx=1:4
    tb_saveCoef_stack = [tb_saveCoef_stack; cl_stores{row_idx}];
end
% display results
disp(tb_saveCoef_stack);
%% ND Dimensional Parameter Arrays, Simulate Model and Stack Output Tables
% Now we will first column combine matrixes, model parameters and model outcomes, 
% and then row combine matrixes from different simulations.
% 
% A model takes a N parameters, solve the model over M sets of parameters. Each 
% time when the model is solved, a P by Q table of results is generated. Each 
% column is a different statistics (mean, std, etc.), and each row is a different 
% outcome variable (consumption, asset choices, etc.). Stack these P by Q Tables 
% together, and add in information about the N parameters, each of the tables 
% been stacked initially had the same column and row names.
% 
% The resulting table should have P times M rows, for M sets of model simulations 
% each with P rows of results. And there should be N + Q columns, storing the 
% N parameters as well as the Q columns of different outcomes. 

rng(123);
% Generate A P by Q matrix of random parameter Values
it_param_groups_m = 5; 
it_params_n = 2;
it_outcomes_p = 3;
it_stats_q = 3;

% Parameter Matrix and Names
ar_param_names = strcat('param_', string(1:it_params_n));
mt_param_m_by_n = round(rand([it_param_groups_m, it_params_n])*5, 2);

% Loop over the parameters
for it_cur_param_group=1:1:it_param_groups_m
    
    % Current Parameters
    ar_param = mt_param_m_by_n(it_cur_param_group,:);
    
    % Some Model is simulated
    mt_model_simu = normrnd(mean(ar_param), std(ar_param), [it_outcomes_p, it_stats_q]);
    
    % Model Results are Saved As Table With Column and Row Information
    tb_model_simu = array2table(mt_model_simu);
    cl_col_names = strcat('stats_', string((1:size(mt_model_simu,2))));
    cl_row_names = strcat('outvar_', string((1:size(mt_model_simu,1))));
    tb_model_simu.Properties.VariableNames = cl_col_names;
    tb_model_simu.Properties.RowNames = cl_row_names;    
        
    % Convert Row Variable Names to a Column String
    outvar = string(tb_model_simu.Properties.RowNames);
    tb_model_simu = addvars(tb_model_simu, outvar, 'Before', 1);
    
    % Parameter Information Table that Shares Row Names as Simu Results
    mt_param_info = zeros([it_outcomes_p,it_params_n]) + ar_param;
    tb_param_info = array2table(mt_param_info);
    tb_param_info.Properties.VariableNames = ar_param_names;
    tb_param_info.Properties.RowNames = cl_row_names;
    
    % Combine Parameter Information and Simulation Contents
    tb_model_simu_w_info = [tb_param_info tb_model_simu];
    % Update Row Names based on total row available
    ar_rows_allsimu = (1:it_stats_q)' + (it_cur_param_group-1)*it_stats_q;
    tb_model_simu_w_info.Properties.RowNames = strcat('row=', string(ar_rows_allsimu));
    
    % Show One Example Table before Stacking
    if (it_cur_param_group == round(it_param_groups_m/2))
        disp(tb_model_simu);
        disp(tb_param_info);
        disp(tb_model_simu_w_info);
    end
    
    % Stack all results
    if(it_cur_param_group == 1)
        tb_model_allsimu_w_info = tb_model_simu_w_info;
    else
        tb_model_allsimu_w_info = [tb_model_allsimu_w_info; tb_model_simu_w_info];
    end
    
end
%% 
% Show all Simulation Joint Table Outputs:

disp(tb_model_allsimu_w_info);
##### SOURCE END #####
--></body></html>